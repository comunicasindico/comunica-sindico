<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Comunica Síndico - Condôminos</title>

<style>
:root{
  --bg:#061726;
  --card:#0e2d4a;
}

*{box-sizing:border-box}
html,body{
  margin:0;
  min-height:100vh;
  font-family:system-ui;
  background:var(--bg);
  color:#fff;
}

/* CAMADA CLIMA */
#weatherEffects{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
}

body.clima-noite{background:linear-gradient(#0f2027,#203a43,#2c5364);}
body.clima-sol{background:linear-gradient(#64b5f6,#bbdefb);}
body.clima-chuva{background:linear-gradient(#1e3c72,#2a5298);}
body.clima-nublado{background:linear-gradient(#78909c,#b0bec5);}

.rain{
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,.3) 0px,
    rgba(255,255,255,.3) 2px,
    transparent 2px,
    transparent 8px
  );
  animation:rain .6s linear infinite;
}
@keyframes rain{
  from{background-position:0 0;}
  to{background-position:0 20px;}
}

.wrapper{
  position:relative;
  z-index:2;
  padding:14px;
  display:grid;
  grid-template-rows:auto 1fr auto;
  gap:12px;
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#10375d;
  padding:16px;
  border-radius:20px;
}

/* MAIN */
.main{
  display:grid;
  grid-template-columns:1.4fr 1.6fr;
  gap:12px;
}

@media(max-width:900px){
  .main{grid-template-columns:1fr}
}

/* AVISOS */
.avisos{
  display:grid;
  grid-template-rows:repeat(3,1fr);
  gap:10px;
}

.aviso-card{
  border-radius:16px;
  padding:16px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.prioridade-alta{background:#e53935;}
.prioridade-media{background:#ffeb3b;color:#000;}
.prioridade-baixa{background:#43a047;}

.aviso-header{font-weight:bold}
.aviso-body{flex:1;margin-top:6px}

/* VIDEO */
.videoWrap{
  position:relative;
  height:260px;
  background:#000;
  border-radius:16px;
  overflow:hidden;
}
.videoWrap video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
}
.videoBg{
  object-fit:cover;
  filter:blur(18px);
  transform:scale(1.1);
  opacity:.6;
}
.videoMain{object-fit:contain}

#videoDescricao{
  margin-top:8px;
  text-align:center;
  font-size:13px;
  font-weight:600;
}

/* MENSAGENS */
.mensagens{
  margin-top:10px;
  background:#0e2d4a;
  padding:10px;
  border-radius:16px;
  max-height:180px;
  overflow-y:auto;
}

/* FOOTER */
.footer{
  background:#0c2a46;
  padding:12px;
  border-radius:16px;
}

/* BARRA TEMP */
.temp-bar{
  height:8px;
  background:#1c3d5a;
  border-radius:6px;
  margin-top:6px;
  position:relative;
}

.temp-bar-fill{
  height:100%;
  background:linear-gradient(90deg,#00c6ff,#ff9800,#e53935);
  width:0%;
}

.temp-marker{
  position:absolute;
  top:-4px;
  width:2px;
  height:16px;
  background:#fff;
}


  /* ===== MARCADOR NUMÉRICO FLUTUANTE ===== */
.temp-value{
  position:absolute;
  top:-26px;
  transform:translateX(-50%);
  background:#000;
  color:#fff;
  font-size:12px;
  padding:2px 6px;
  border-radius:6px;
  font-weight:bold;
  white-space:nowrap;
}

/* ===== ARCO-ÍRIS ===== */
.rainbow{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:80%;
  height:120px;
  background:
    radial-gradient(circle at 50% 100%,
      red 0%, orange 15%, yellow 30%,
      green 45%, blue 60%, indigo 75%, violet 90%, transparent 91%);
  border-radius:50%;
  opacity:.6;
  animation:fadeRainbow 6s ease forwards;
}

@keyframes fadeRainbow{
  0%{opacity:0;}
  30%{opacity:.8;}
  100%{opacity:0;}
}

/* ===== RELÂMPAGO ===== */
.lightning{
  position:absolute;
  inset:0;
  background:white;
  opacity:0;
  animation:flash 2s infinite;
}

@keyframes flash{
  0%,95%,100%{opacity:0;}
  96%{opacity:.8;}
  97%{opacity:0;}
  98%{opacity:.6;}
  99%{opacity:0;}
}

</style>
</head>

<body>

<div id="weatherEffects"></div>

<div class="wrapper">

<div class="header">
  <div>Comunica Síndico - Condôminos</div>
  <div id="clock"></div>
</div>

<div class="main">

<div class="avisos" id="avisosContainer"></div>

<div>
  <div class="videoWrap">
    <video id="adVideoBg" class="videoBg" autoplay muted loop></video>
    <video id="adVideo" class="videoMain" autoplay muted loop></video>
  </div>

  <div id="videoDescricao"></div>

  <div class="mensagens" id="mensagensContainer"></div>
</div>

</div>

<div class="footer">
  <div id="clima"></div>
  <div class="temp-bar">
  <div id="tempBarFill" class="temp-bar-fill"></div>
  <div id="tempMarker" class="temp-marker"></div>
  <div id="tempValue" class="temp-value">--°C</div>
</div>

</div>

</div>

<script>

/* RELÓGIO */
setInterval(()=>{
  document.getElementById("clock").textContent =
    new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
},1000);

/* VIDEO ROTATIVO */
let videoIndex=0;

async function loadData(){
  const r=await fetch("./data.json?ts="+Date.now());
  const d=await r.json();

  /* AVISOS */
  const avisos=d.avisos||[];
  const container=document.getElementById("avisosContainer");
  container.innerHTML="";
  avisos.slice(0,3).forEach(a=>{
    const div=document.createElement("div");
    div.className="aviso-card prioridade-"+(a.prioridade||"media").toLowerCase();
    div.innerHTML=`
      <div class="aviso-header">${a.titulo}</div>
      <div class="aviso-body">${a.descricao}</div>
    `;
    container.appendChild(div);
  });

  /* VIDEO */
  if(d.publicidade?.videos?.length){
    const video=d.publicidade.videos[videoIndex];
    const src=video.arquivo+"?ts="+Date.now();

    const v=document.getElementById("adVideo");
    const bg=document.getElementById("adVideoBg");

    v.src=src;
    bg.src=src;
    v.play().catch(()=>{});
    bg.play().catch(()=>{});

    document.getElementById("videoDescricao").textContent =
      video.anunciante || "";

    videoIndex=(videoIndex+1)%d.publicidade.videos.length;
  }

  /* MENSAGENS */
  const mc=document.getElementById("mensagensContainer");
  mc.innerHTML="";
  (d.mensagens||[]).forEach(m=>{
    const div=document.createElement("div");
    div.textContent=m;
    mc.appendChild(div);
  });

}
setInterval(loadData,15000);
loadData();

/* CLIMA */
async function carregarClima(){

  const rJson=await fetch("./data.json?ts="+Date.now());
  const json=await rJson.json();

  const lat=json.clima?.latitude||-28.4667;
  const lon=json.clima?.longitude||-49.0069;

  const r=await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`
  );

  const d=await r.json();
  const w=d.current_weather;

  const temp=w.temperature;
  const codigo=w.weathercode;
  const cidade=json.clima?.cidade||"Tubarão";

  document.getElementById("clima").textContent=
    `${cidade} • ${temp}°C`;

  /* BARRA */
  const percent=Math.min(100,(temp/40)*100);

  const fill=document.getElementById("tempBarFill");
  const marker=document.getElementById("tempMarker");
  const value=document.getElementById("tempValue");

  fill.style.width=percent+"%";
  marker.style.left=percent+"%";
  value.style.left=percent+"%";
  value.textContent=temp+"°C";

  /* LIMPAR EFEITOS */
  const effects=document.getElementById("weatherEffects");
  effects.innerHTML="";
  effects.className="";

  document.body.className="";

  /* ===== CLIMA DINÂMICO ===== */

  if(codigo>=95){
    /* TEMPESTADE */
    document.body.classList.add("clima-tempestade");

    const lightning=document.createElement("div");
    lightning.className="lightning";
    effects.appendChild(lightning);
  }
  else if(codigo>=61){
    /* CHUVA */
    document.body.classList.add("clima-chuva");
    effects.classList.add("rain");
  }
  else if(codigo<=3){
    /* SOL */
    document.body.classList.add("clima-sol");

    /* SE ANTES ESTAVA CHOVENDO → MOSTRA ARCO-ÍRIS */
    const rainbow=document.createElement("div");
    rainbow.className="rainbow";
    effects.appendChild(rainbow);
  }
  else{
    document.body.classList.add("clima-nublado");
  }
}

carregarClima();
setInterval(carregarClima,600000);

</script>

</body>
</html>
