<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="canonical" href="./">
  <script>
  (function () {
    try {
      const u = new URL(location.href);
      if (u.search) { u.search = ""; location.replace(u.toString()); return; }
      if (u.pathname.endsWith("/index.html")) { location.replace("./"); return; }
    } catch(e){}
  })();
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Cond√¥minos - Comunica S√≠ndico(a)</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#0b223a">

  <style>
    :root{
      --bg1:#061726;
      --bg2:#0b1f33;
      --line:rgba(255,255,255,.10);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.75);
      --shadow: 0 14px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --sat: env(safe-area-inset-top);
      --sar: env(safe-area-inset-right);
      --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left);
    }
    *{box-sizing:border-box}
    html,body{height:100%;width:100%}

    body{
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(16,56,91,0.55), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(11,52,84,0.55), transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      overflow:hidden;
      overscroll-behavior:none;
      touch-action:manipulation;
      min-height:100svh;
      padding-bottom: max(14px, env(safe-area-inset-bottom));
    }

.wrap{
  min-height:100svh;
  width:100%;
  padding:
    calc(14px + var(--sat))
    calc(14px + var(--sar))
    calc(14px + var(--sab))
    calc(14px + var(--sal));
  display:block;
}

.container{
  width:100%;
  min-height:100svh;
  display:flex;
  flex-direction:column;
  gap:12px;
  max-width:none;
}
    /* ===== HEADER ===== */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:16px 18px;
      background:rgba(8,28,46,.60);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      flex:0 0 auto;
      width:100%;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width:0;
      flex:1 1 auto;
    }
    .brand .title{
      margin:0;
      font-size:22px;
      font-weight:900;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      margin:0;
      font-size:12.5px;
      color:var(--muted);
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .condoCenter{
      flex:1 1 auto;
      min-width:0;
      text-align:center;
      font-weight:950;
      letter-spacing:.2px;
      color:rgba(234,242,255,.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      padding:0 8px;
    }

    .rightInfo{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex:0 0 auto;
    }
    .badge{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.55);
      color:var(--muted);font-weight:900;font-size:12px;
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:#ff5a5a}
    #statusJson{font-weight:950;color:rgba(234,242,255,.92)}
    #clock{font-size:22px;font-weight:950;letter-spacing:.6px;color:#fff}
    .btnInstall{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(12,35,56,.55);
      color:rgba(234,242,255,.92);
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      font-size:14px;
      white-space:nowrap;
    }
    .updateBanner{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(120,190,255,.35);
      background:rgba(7,20,34,.28);
      box-shadow:var(--shadow);
      font-weight:900;
      flex:0 0 auto;
      width:100%;
    }

    /* ===== MAIN (TV/PC: 2 COLUNAS) ===== */
    .main{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns: 1.20fr .80fr;
      gap:12px;
      width:100%;
    }

    .panel{
      background:linear-gradient(180deg, rgba(15,43,69,.92), rgba(11,33,55,.92));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      min-height:0;
      overflow:hidden;
    }

    .panelHead{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(7,20,34,.20);
      flex:0 0 auto;
    }
    .panelTitle{
      display:flex;align-items:center;gap:10px;
      font-size:13px;
      font-weight:950;
      letter-spacing:.6px;
      color:rgba(234,242,255,.95);
      text-transform:uppercase;
    }
    .pill{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.35);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
    }

/* ===== AVISOS ‚Äì PREMIUM 3D + ANIMA√á√ïES ===== */
@keyframes avisoIn{
  from{ opacity:0; transform: translateY(10px) scale(.99); }
  to  { opacity:1; transform: translateY(0) scale(1); }
}
@keyframes glowPulseRed{
  0%,100%{ box-shadow: 0 0 14px rgba(255,80,80,.35), inset 0 1px 0 rgba(255,255,255,.15); }
  50%    { box-shadow: 0 0 20px rgba(255,80,80,.55), inset 0 1px 0 rgba(255,255,255,.18); }
}
#avisos.fade-out{ opacity:0; transition: opacity .22s ease; }
#avisos.fade-in { opacity:1; transition: opacity .22s ease; }

/* >>> Ajuste principal: 4 avisos por vez, sem rolagem (cabendo) <<< */
.avisos{
  padding:14px;
  min-height:0;
  overflow:hidden;                 /* evita ‚Äúestourar‚Äù */
  display:grid;                    /* garante 4 slots */
  grid-template-rows: repeat(4, minmax(0, 1fr));
  gap:12px;
  scroll-behavior:smooth;
}

.aviso{
  min-height:0;
  padding:16px;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(20,60,95,.88), rgba(10,30,50,.88));
  display:flex;
  flex-direction:column;
  gap:10px;
  border:1px solid rgba(140,200,255,.22);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.14),
    inset 0 -14px 22px rgba(0,0,0,.28),
    0 14px 34px rgba(0,0,0,.55);
  transition: transform .22s ease, box-shadow .22s ease, filter .22s ease;
  animation: avisoIn .28s ease both;
  will-change: transform, opacity;
  position:relative;
  padding-left:18px;
  overflow:hidden;                 /* importante para clamps */
}

.aviso:hover{
  transform: translateY(-2px);
  filter: saturate(1.05);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.16),
    0 10px 28px rgba(0,0,0,.62);
}
.aviso:active{ transform: translateY(0); }

.aviso::before{
  content:"";
  position:absolute;
  inset:10px auto 10px 10px;
  width:6px;
  border-radius:999px;
  background:rgba(255,255,255,.15);
}

.aviso.alta{
  border:1px solid rgba(255,90,90,.9);
  background:linear-gradient(180deg, rgba(255,80,80,.28), rgba(12,30,50,.92));
  animation: avisoIn .28s ease both, glowPulseRed 2.2s ease-in-out infinite;
}
.aviso.alta::before{ background:linear-gradient(180deg,#ff5a5a,#c0392b); }

.aviso.media{
  border:1px solid rgba(255,179,71,.85);
  background:linear-gradient(180deg, rgba(255,180,70,.25), rgba(12,30,50,.92));
}
.aviso.media::before{ background:linear-gradient(180deg,#ffb347,#e67e22); }

.aviso.baixa{
  border:1px solid rgba(77,166,255,.85);
  background:linear-gradient(180deg, rgba(100,170,255,.25), rgba(12,30,50,.92));
}
.aviso.baixa::before{ background:linear-gradient(180deg,#6fb6ff,#2980b9); }

.aviso .t{
  margin:0;
  font-weight:900;
  font-size:clamp(16px, 2.0vw, 20px);
  letter-spacing:.3px;
  color:#fff;
  text-shadow:0 1px 2px rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  gap:10px;
  line-height:1.15;
  /* no m√°ximo 2 linhas */
  display:-webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow:hidden;
}
.aviso.alta  .t::before{ content:"‚ö†Ô∏è"; }
.aviso.media .t::before{ content:"üî∂"; }
.aviso.baixa .t::before{ content:"‚ÑπÔ∏è"; }

.aviso .d{
  margin:0;
  color:#e0ecff;
  line-height:1.35;
  font-size:clamp(14px, 1.7vw, 17px);  /* leitura melhor */
  /* no m√°ximo 4 linhas */
  display:-webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow:hidden;
}

.metaLine{
  margin-top:auto;                 /* empurra meta para baixo */
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  color:rgba(234,242,255,.92);
  font-size:clamp(12px, 1.5vw, 14px);
  font-weight:900;
}
.metaItem{
  display:inline-flex;
  align-items:center;
  gap:8px;
  opacity:.95;
}
.metaItem b{
  font-weight:950;
  color:#fff;
}
.metaSep{
  opacity:.35;
  font-weight:900;
}
/* ===== BADGE 3D (BISEL) PARA PRIORIDADE ===== */
.prioBadge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 10px;
  border-radius:999px;
  font-weight:950;
  letter-spacing:.4px;
  text-transform:uppercase;
  font-size:12px;
  line-height:1;

  border:1px solid rgba(255,255,255,.22);
  background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.08));
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.35),
    inset 0 -2px 6px rgba(0,0,0,.35),
    0 6px 14px rgba(0,0,0,.35);
}
.prioBadge.alta{
  border-color: rgba(255,90,90,.80);
  background: linear-gradient(180deg, rgba(255,120,120,.50), rgba(160,0,0,.35));
  text-shadow: 0 1px 0 rgba(0,0,0,.55);
}
.prioBadge.media{
  border-color: rgba(255,179,71,.75);
  background: linear-gradient(180deg, rgba(255,210,120,.55), rgba(160,90,0,.35));
  text-shadow: 0 1px 0 rgba(0,0,0,.50);
}
.prioBadge.baixa{
  border-color: rgba(120,190,255,.70);
  background: linear-gradient(180deg, rgba(160,210,255,.55), rgba(0,80,160,.32));
  text-shadow: 0 1px 0 rgba(0,0,0,.45);
}

/* ===== AD ===== */
.adBody{
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
  min-height:0;
  overflow:auto;
}
.adCard{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(7,20,34,.18);
  border-radius:14px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-height:0;
}
.adLabel{
  padding:10px 12px;
  font-weight:950;
  border-bottom:1px solid rgba(255,255,255,.10);
  color:rgba(234,242,255,.92);
  background:rgba(12,35,56,.35);
}
.videoWrap{
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;

  flex:0 0 auto;
  max-height: 38vh;
  overflow:hidden;
  border-radius: 12px;
}
video{
  width:100%;
  height:100%;
  display:block;
  object-fit:cover;
  object-position:center;
  background:#000;
}
video.fit-contain{ object-fit:contain; }

/* ===== FOOTER (VERS√çCULO + DATA + TEMPO/VENTO) ===== */
.ticker{
  flex:0 0 auto;
  width:100%;
  padding:10px 12px;
  border-radius:var(--radius);
  border:1px solid var(--line);
  background:rgba(8,28,46,.60);
  box-shadow:var(--shadow);
  backdrop-filter: blur(8px);
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:6px;
  margin-bottom: max(14px, env(safe-area-inset-bottom));
}

.tickerLine1{
  width:100%;
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
  overflow:hidden;
}

    /* clima na mesma linha do vers√≠culo */
.tickerLine1{
  flex-wrap: wrap;
}

.wxInline{
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 900;
  color: rgba(234,242,255,.92);
  font-size: clamp(12px, 1.6vw, 15px);
  white-space: nowrap;
}

/* TV / desktop: esconde a linha de baixo */
@media (min-width: 981px){
  .tickerLine2{ display:none; }
  .wxInline{ display:flex; }
}

/* Mobile: mant√©m como estava */
@media (max-width: 980px){
  .wxInline{ display:none; }
  .tickerLine2{ display:flex; }
}

.tickerIcon{
  font-size:clamp(22px, 3.1vw, 28px);
  opacity:.95;
  flex:0 0 auto;
}

#dataBiblica{
  font-weight:950;
  white-space:nowrap;
  color:rgba(234,242,255,.95);
  font-size:clamp(13px, 1.8vw, 16px);
  flex:0 0 auto;
}

#ref{
  color:rgba(234,242,255,.88);
  font-weight:850;
  font-size:clamp(13px, 1.8vw, 16px);
  flex:1 1 auto;
  min-width:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.tickerLine2{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

.wxMini, .dtMini{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:900;
  color:rgba(234,242,255,.92);
  white-space:nowrap;
  font-size:clamp(12px, 1.7vw, 15px);
}

.dtMini{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(12,35,56,.25);
  padding:6px 10px;
  border-radius:999px;
}

@media (max-width: 520px){
  .wxMini, .dtMini{ white-space:normal; }
}

/* ===== MOBILE: scroll + v√≠deo embaixo ===== */
@media (max-width: 980px){
  body{
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 0;
  }

  .container{ min-height:auto; }

  .topbar{ flex-wrap:wrap; }

  .condoCenter{
    order:3;
    width:100%;
    text-align:left;
    padding:0;
  }

  .main{
    display:flex;
    flex-direction:column;
  }

  section.panel{ order:1; }
  #adBox{ order:2; min-height:0; }

  .panel{ min-height:auto; }

  /* no mobile, deixa o painel de avisos respirar */
  .avisos{
    grid-template-rows: repeat(4, minmax(0, 1fr));
    overflow:hidden;
  }

  .ticker{
    position:sticky;
    bottom:0;
    z-index:50;
    margin-bottom: 0;
    padding-bottom: max(12px, env(safe-area-inset-bottom));
  }

  .tickerLine1{ flex-wrap: wrap; }
  #dataBiblica{ white-space: normal; }
  #ref{
    white-space: normal;
    overflow: visible;
    text-overflow: unset;
    line-height: 1.3;
  }
}

/* ===== TV / TELAS GRANDES ===== */
@media (min-width: 1400px){
  .aviso{ padding:22px; gap:12px; border-radius:20px; }
  .aviso .t{ font-size:24px; }
  .aviso .d{ font-size:18px; line-height:1.45; }
  .metaLine{ font-size:16px; gap:14px; }
  .panelTitle{ font-size:16px; }
  .pill{ font-size:14px; }
  .brand .title{ font-size:26px; }
  .brand .sub{ font-size:14px; }
  #clock{ font-size:26px; }
}
@media (min-width: 1900px){
  .aviso .t{ font-size:28px; }
  .aviso .d{ font-size:20px; }
  .metaLine{ font-size:17px; }
  .panelTitle{ font-size:18px; }
}

/* ===== NEWS (Mensagens da Cidade) ===== */
.newsBox{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(7,20,34,.18);
  border-radius:14px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  min-height:0;
}

.newsHead{
  padding:10px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  border-bottom:1px solid rgba(255,255,255,.10);
  background:rgba(12,35,56,.35);
}

.newsTitle{
  font-weight:950;
  color:rgba(234,242,255,.92);
}

.newsBody{
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow:auto;
  max-height: 32vh;
}

.newsItem{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(7,20,34,.22);
  border-radius:12px;
  padding:10px 10px;
}

.newsItem .h{
  margin:0 0 6px 0;
  font-weight:950;
  color:#fff;
  font-size:14px;
  line-height:1.25;
}

.newsItem .p{
  margin:0;
  color:rgba(234,242,255,.88);
  font-weight:700;
  font-size:13px;
  line-height:1.35;
}

.newsItem a{
  color:rgba(180,220,255,.95);
  text-decoration:none;
  font-weight:900;
}
.newsItem a:hover{ text-decoration:underline; }

/* ===========================
   PREMIUM ‚Äî Mensagens da Cidade
   =========================== */
:root{
  --font-ui: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  --font-soft: ui-rounded, "SF Pro Rounded", "Segoe UI", var(--font-ui);

  --news-bg: rgba(8, 24, 40, .62);
  --news-border: rgba(255,255,255,.12);
  --news-shadow: 0 18px 40px rgba(0,0,0,.38);

  --news-title: rgba(234,242,255,.96);
  --news-text: rgba(234,242,255,.78);
  --news-muted: rgba(234,242,255,.62);

  --news-chip-bg: rgba(255,255,255,.10);
  --news-chip-border: rgba(255,255,255,.14);
}

#newsBox{
  background: var(--news-bg);
  border: 1px solid var(--news-border);
  box-shadow: var(--news-shadow);
  border-radius: 18px;
  overflow: hidden;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

#newsPill{
  font-family: var(--font-ui);
  font-weight: 800;
  font-size: 12px;
  color: var(--news-title);
  background: var(--news-chip-bg);
  border: 1px solid var(--news-chip-border);
  padding: 6px 10px;
  border-radius: 999px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
}

#newsBody{
  padding: 12px 14px 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 34vh;
  overflow: auto;
  overscroll-behavior: contain;
  scrollbar-width: thin;
}

#newsBody::-webkit-scrollbar{ width: 10px; }
#newsBody::-webkit-scrollbar-track{ background: transparent; }
#newsBody::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.18);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
}

.newsItem{
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  padding: 12px 12px 10px;
  transition: transform .12s ease, border-color .12s ease, background .12s ease;
}

.newsItem:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,.16);
  background: rgba(0,0,0,.22);
}

.newsItem .h{
  font-family: var(--font-soft);
  font-weight: 900;
  font-size: 14px;
  line-height: 1.2;
  letter-spacing: .2px;
  color: var(--news-title);
  margin: 0 0 6px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.newsItem .p{
  font-family: var(--font-ui);
  font-weight: 600;
  font-size: 13px;
  line-height: 1.35;
  color: var(--news-text);
  margin: 0;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.newsItem .p .muted,
.newsItem .p small{
  color: var(--news-muted);
  font-weight: 700;
}

@media (max-width: 520px){
  #newsBody{ max-height: 30vh; padding: 10px 12px 12px; }
  .newsItem{ padding: 10px 10px 9px; border-radius: 12px; }
  .newsItem .h{ font-size: 13.5px; }
  .newsItem .p{ font-size: 12.5px; }
}
/* Remove os 2 "Atualizado" extras, deixando s√≥ o do topo */
   #refPill, #adPill, #newsPill { display:none !important; }
 
  .newsMeta{
  font-size: 11px;
  opacity: 0.7;
  text-align: left;
  margin-bottom: 4px;
  font-weight: 700;
}

  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <div class="topbar">
        <div class="brand">
          <div class="title" id="titulo">Comunica S√≠ndico ‚Äî Cond√¥minos</div>
          <div class="sub" id="subtitulo">Painel informativo</div>
        </div>

        <div class="condoCenter" id="condoCenter">Condom√≠nio</div>

        <div class="rightInfo">
          <div class="badge" title="Status do painel">
            <span class="dot" id="dotOnline"></span>
            <span id="statusJson">Carregando...</span>
          </div>

          <div class="badge" title="Hora e Clima">
            <span id="wxIconTop">üå¶Ô∏è</span>
            <span id="clock">--:--</span>
          </div>

          <button id="btnInstalarApp" class="btnInstall" onclick="instalarApp()" style="display:none">‚¨áÔ∏è Instalar App</button>
        </div>
      </div>

      <div id="updateBanner" class="updateBanner" style="display:none">‚¨áÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶</div>

      <div class="main">
        <section class="panel">
          <div class="panelHead">
            <div class="panelTitle">üîî Avisos Importantes</div>
            <div class="pill" id="refPill">Atualizado</div>
          </div>
          <div class="avisos" id="avisos"></div>
        </section>

        <aside class="panel" id="adBox" style="display:none">
          <div class="panelHead">
            <div class="panelTitle">üì£ Publicidade</div>
            <div class="pill" id="adPill">‚Äî</div>
          </div>

          <div class="adBody">
            <div class="adCard">
              <div class="adLabel" id="adLabel">An√∫ncio</div>
              <div class="videoWrap">
                <video id="adVideo" autoplay muted playsinline></video>
              </div>
            </div>

            <!-- Mensagens da Cidade (embaixo do v√≠deo) ‚Äî vem do mensagens_cidade.json -->
            <div class="newsBox" id="newsBox" style="display:none">
              <div class="newsHead">
                <div class="newsTitle">üì∞ Mensagens da Cidade</div>
                <div class="pill" id="newsPill">‚Äî</div>
              </div>
              <div class="newsBody" id="newsBody"></div>
            </div>

          </div>
        </aside>
      </div>

      <div class="ticker">
     
      <div class="tickerLine1">
        <span class="tickerIcon">üìñ</span>
        <span id="dataBiblica">‚Äî</span>
        <span id="ref">‚Äî</span>
  <!-- clima na mesma linha (TV) -->
        <span class="wxInline" id="wxInline">
          <span id="wxIconInline">üå¶Ô∏è</span>
          <span id="wxTextInline">‚Äî</span>
        </span>

      </div>
        <div class="tickerLine2">
          <div class="wxMini">
            <span id="wxIcon">üå¶Ô∏è</span>
            <span id="wxText">Clima: carregando‚Ä¶</span>
          </div>

          <div class="dtMini" title="Data e hora">
            <span>üóìÔ∏è</span>
            <span id="footerDT">‚Äî</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    let deferredPrompt = null;

    function mostrarBotaoInstalar(show){
      const b = document.getElementById("btnInstalarApp");
      if (b) b.style.display = show ? "inline-flex" : "none";
    }

    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      mostrarBotaoInstalar(true);
    });

    window.addEventListener("appinstalled", ()=>{
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    });

    async function instalarApp(){
      if(!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    }

    function prioridadeClass(p){
      const x = String(p || "").toLowerCase();
      if (x === "alta") return "alta";
      if (x === "m√©dia" || x === "media") return "media";
      return "baixa";
    }

    function safeText(v){ return (v == null ? "" : String(v)); }
    function setText(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }
    function pad2(n){ return String(n).padStart(2,"0"); }

    function formatDT_BR(v){
      if(!v) return "";
      const d = new Date(v);
      if(isNaN(d.getTime())) return String(v);
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const aa = String(d.getFullYear()).slice(-2);
      const HH = pad2(d.getHours());
      const MM = pad2(d.getMinutes());
      return `${dd}/${mm}/${aa} - ${HH}:${MM}`;
    }

    function footerDateTimeString(d){
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const yyyy = d.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }
    function tickClock(){
      const d = new Date();
      setText("clock", `${pad2(d.getHours())}:${pad2(d.getMinutes())}`);
      setText("footerDT", footerDateTimeString(d));
    }
    tickClock();
    setInterval(tickClock, 1000);

    let ROT_TIMER = null;
    let ROT_STATE = { page: 0, totalPages: 1, paused: false };

    function renderAvisos(data){
      const root = document.getElementById("avisos");
      if (!root) return;
      root.innerHTML = "";

      if (ROT_TIMER) { clearInterval(ROT_TIMER); ROT_TIMER = null; }

      const avisosAll = Array.isArray(data.avisos) ? data.avisos : [];
      const rot = data?.rotacao || {};
      const ativar = !!rot.ativar;

      // >>> sempre no m√°ximo 4 por tela <<<
      const qtdCfg = Math.max(1, Number(rot.quantidadePorTela || 4));
      const qtd = Math.min(4, qtdCfg);

      const intervaloMs = Math.max(3, Number(rot.intervaloSeg || 12)) * 1000;

      if(!avisosAll.length){
        const div = document.createElement("div");
        div.className = "aviso baixa";
        div.innerHTML = `<p class="t">Sem avisos no momento</p><p class="d">${safeText(data.fallback || "‚Äî")}</p>`;
        root.appendChild(div);
        ROT_STATE = { page: 0, totalPages: 1, paused: false };
        return;
      }

      const totalPages = Math.max(1, Math.ceil(avisosAll.length / qtd));
      ROT_STATE = { page: 0, totalPages, paused: false };

      function renderPage(pageIdx){
        root.classList.remove("fade-in");
        root.classList.add("fade-out");

        const doRender = () => {
          root.innerHTML = "";

          const start = pageIdx * qtd;
          const slice = avisosAll.slice(start, start + qtd);

          slice.forEach(a=>{
            const el = document.createElement("div");
            el.className = `aviso ${prioridadeClass(a.prioridade)}`;

            const titulo = safeText(a.titulo || "Aviso");
            const desc = safeText(a.descricao || "");
            const tipo = safeText(a.tipo || "");
            const local = safeText(a.local || "");
            const ini = formatDT_BR(a.inicio || "");
            const fim = formatDT_BR(a.fim || "");

            const itens = [];
            if(local) itens.push(`<span class="metaItem">üìç <b>${escapeHtml(local)}</b></span>`);
            if(tipo)  itens.push(`<span class="metaItem">üè∑Ô∏è <b>${escapeHtml(tipo)}</b></span>`);
            const pr = safeText(a.prioridade || "Baixa");
            itens.push(`<span class="metaItem">‚ö° <span class="prioBadge ${prioridadeClass(pr)}">${escapeHtml(pr)}</span></span>`);
            if(ini || fim) itens.push(`<span class="metaItem">üóìÔ∏è <b>${escapeHtml(ini)}${fim ? " ‚Üí " + escapeHtml(fim) : ""}</b></span>`);

            el.innerHTML = `
              <p class="t">${escapeHtml(titulo)}</p>
              ${desc ? `<p class="d">${escapeHtml(desc)}</p>` : ""}
              <div class="metaLine">${itens.join(`<span class="metaSep">‚Ä¢</span>`)}</div>
            `;
            root.appendChild(el);
          });

          void root.offsetWidth;

          root.classList.remove("fade-out");
          root.classList.add("fade-in");
        };

        setTimeout(doRender, 220);
      }

      renderPage(0);
      root.classList.add("fade-in");

      if (ativar && totalPages > 1){
        if (rot.pausarNoMouse){
          root.addEventListener("mouseenter", ()=> ROT_STATE.paused = true, {passive:true});
          root.addEventListener("mouseleave", ()=> ROT_STATE.paused = false, {passive:true});
          root.addEventListener("touchstart", ()=>{ ROT_STATE.paused = !ROT_STATE.paused; }, {passive:true});
        }

        ROT_TIMER = setInterval(()=>{
          if (ROT_STATE.paused) return;
          ROT_STATE.page = (ROT_STATE.page + 1) % totalPages;
          renderPage(ROT_STATE.page);
        }, intervaloMs);
      }
    }

    function hojeKeyMMDD() {
      const d = new Date();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${mm}-${dd}`;
    }

    async function carregarVersiculo(data) {
      if (!data?.temaDoDia || data.temaDoDia.modo !== "biblico-anual") return;

      try {
        const res = await fetch("versiculos.json?ts=" + Date.now(), { cache: "no-store" });
        const v = await res.json();

        const key = hojeKeyMMDD();
        const texto = v?.versos?.[key];

        setText("dataBiblica", v?.cabecalho || "");
        setText("ref", texto ? texto : (v?.titulo ? v.titulo : "Verso n√£o encontrado"));
      } catch (e) {}
    }

    function wxEmojiFromCode(code){
      if (code === 0) return "‚òÄÔ∏è";
      if ([1,2,3].includes(code)) return "‚õÖ";
      if ([45,48].includes(code)) return "üå´Ô∏è";
      if ([51,53,55,56,57].includes(code)) return "üå¶Ô∏è";
      if ([61,63,65,66,67].includes(code)) return "üåßÔ∏è";
      if ([71,73,75,77,85,86].includes(code)) return "‚ùÑÔ∏è";
      if ([80,81,82].includes(code)) return "üåßÔ∏è";
      if ([95,96,99].includes(code)) return "‚õàÔ∏è";
      return "üå¶Ô∏è";
    }

    async function carregarClima(data){
      const c = data?.clima;

      if (!c?.latitude || !c?.longitude) {
        setText("wxText", "Clima: configure latitude/longitude no data.json");
        return;
      }

      try {
        const url =
          "https://api.open-meteo.com/v1/forecast" +
          `?latitude=${encodeURIComponent(c.latitude)}` +
          `&longitude=${encodeURIComponent(c.longitude)}` +
          `&current=temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m` +
          `&timezone=${encodeURIComponent(c.timezone || "America/Sao_Paulo")}`;

        const res = await fetch(url, { cache: "no-store" });
        const j = await res.json();

        const cur = j?.current;
        if (!cur) throw new Error("Sem current");

        const emoji = wxEmojiFromCode(cur.weather_code);
        const t = Math.round(cur.temperature_2m);
        const w = Math.round(cur.wind_speed_10m);
        const p = cur.precipitation;

        const wx = document.getElementById("wxIcon");
        if (wx) wx.textContent = emoji;
        const top = document.getElementById("wxIconTop");
        if (top) top.textContent = emoji;

        setText("wxText", `${c.cidade || "Cidade"} ‚Ä¢ ${t}¬∞C ‚Ä¢ Vento ${w} km/h ‚Ä¢ Chuva ${p} mm`);
        const wxI = document.getElementById("wxIconInline");
        if (wxI) wxI.textContent = emoji;

        setText("wxTextInline", `${c.cidade || "Cidade"} ‚Ä¢ ${t}¬∞C ‚Ä¢ Vento ${w} km/h ‚Ä¢ Chuva ${p} mm`);
      } catch (e) {
        const wx = document.getElementById("wxIcon");
        if (wx) wx.textContent = "üå¶Ô∏è";
        const top = document.getElementById("wxIconTop");
        if (top) top.textContent = "üå¶Ô∏è";
        setText("wxText", `${data?.clima?.cidade || "‚Äî"} (offline)`);
      }
    }

    function iniciarPublicidade(data){
      const pub = data?.publicidade;
      const adBox = document.getElementById("adBox");
      const adVideo = document.getElementById("adVideo");
      const adLabel = document.getElementById("adLabel");
      const adPill = document.getElementById("adPill");

      if (!adBox || !adVideo || !adLabel) return;

      if (!(pub?.ativar && Array.isArray(pub.videos) && pub.videos.length)) {
        adBox.style.display = "none";
        return;
      }

      const intervalMs = Math.max(3, Number(pub.intervaloSeg || 10)) * 1000;
      let idx = 0;

      function playNext(){
        const item = pub.videos[idx];
        if(!item) return;

        adLabel.textContent = String(item.anunciante || "An√∫ncio");
        if (adPill) adPill.textContent = "Atualizando‚Ä¶";

        const src = String(item.arquivo || "");
        const sep = src.includes("?") ? "&" : "?";
        const finalSrc = src ? (src + sep + "ts=" + Date.now()) : "";

        adVideo.pause();
        adVideo.classList.remove("fit-contain");
        adVideo.removeAttribute("src");
        adVideo.load();

        adVideo.src = finalSrc;
        adVideo.load();

        adVideo.play().catch(() => {
          setTimeout(playNext, 800);
        });

        idx++;
        if(idx >= pub.videos.length) idx = 0;
      }

      adVideo.onloadedmetadata = () => {
        const isVertical = adVideo.videoHeight > adVideo.videoWidth;
        if (isVertical) adVideo.classList.add("fit-contain");
        else adVideo.classList.remove("fit-contain");
        if (adPill) adPill.textContent = "No ar";
      };

      adVideo.onended = () => setTimeout(playNext, intervalMs);
      adVideo.onerror = () => setTimeout(playNext, 1000);

      adBox.style.display = "flex";
      playNext();
      carregarMensagensCidade();
    }

    // ==========================================================
    // MENSAGENS DA CIDADE (mensagens_cidade.json) -> abaixo do v√≠deo
    // Aceita 2 formatos:
    //  A) { mensagens: ["...", "..."] }
    //  B) { items: [{titulo,texto,fonte,data,link}, ...] }
    // ==========================================================
    const CITY_JSON_URL = "./mensagens_cidade.json";

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

function decodeHtmlEntities_(s){
  const t = document.createElement("textarea");
  t.innerHTML = String(s ?? "");
  return t.value;
}
function normalizeText_(s){
  return decodeHtmlEntities_(s).replace(/\u00a0/g, " ").replace(/\s+/g, " ").trim();
}
    
    function parseCityJsonToNewsItems_(j){
      // Formato A: mensagens[]
      if (Array.isArray(j?.mensagens) && j.mensagens.length){
        return j.mensagens.slice(0, 8).map((txt, i)=>({
          titulo: "üóûÔ∏è Cidade",
          texto: String(txt || "").trim(),
          data: j.atualizado_em || j.updatedAt || ""
        }));
      }

      // Formato B: items[]
      const items = Array.isArray(j?.items) ? j.items : [];
      if(items.length){
        return items.slice(0, 8).map(x=>({
          titulo: normalizeText_(x.titulo || "Mensagem"),
          texto: normalizeText_(x.texto || ""),
          data: x.data || j.updatedAt || "",
          fonte: x.fonte || "",
          link: x.link || ""
        }));
      }

      return [];
    }

   // ==========================================================
// MENSAGENS DA CIDADE (mensagens_cidade.json) ‚Äî FUN√á√ÉO COMPLETA (CORRIGIDA)
// - Remove &nbsp; e outras entidades HTML
// - Evita repeti√ß√£o (quando texto == t√≠tulo)
// - Layout: Fonte/Data bem pequeno √† esquerda, depois t√≠tulo, depois resumo
// - Preenche #newsBox / #newsBody (e opcionalmente #newsPill)
// ==========================================================

async function carregarMensagensCidade(){
  const newsBox  = document.getElementById("newsBox");
  const newsBody = document.getElementById("newsBody");
  const newsPill = document.getElementById("newsPill"); // se voc√™ ocultou via CSS, ok

  if(!newsBox || !newsBody) return;

  // Helpers
  function escapeHtml(s){
    return String(s ?? "")
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#39;");
  }
  function decodeHtmlEntities_(s){
    const t = document.createElement("textarea");
    t.innerHTML = String(s ?? "");
    return t.value;
  }
  function normalizeText_(s){
    return decodeHtmlEntities_(s)
      .replace(/\u00a0/g," ")
      .replace(/\s+/g," ")
      .trim();
  }
  function toBRDate_(v){
    // aceita "29-01-2026" ou "2026-01-29" ou ISO
    const s = String(v ?? "").trim();
    if(!s) return "";
    const m1 = s.match(/^(\d{2})-(\d{2})-(\d{4})$/);
    if(m1) return `${m1[1]}/${m1[2]}/${m1[3].slice(-2)}`; // 29/01/26
    const m2 = s.match(/^(\d{4})-(\d{2})-(\d{2})/);
    if(m2) return `${m2[3]}/${m2[2]}/${m2[1].slice(-2)}`;
    const d = new Date(s);
    if(!isNaN(d.getTime())){
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const aa = String(d.getFullYear()).slice(-2);
      return `${dd}/${mm}/${aa}`;
    }
    return s;
  }

  try{
    const res = await fetch("./mensagens_cidade.json?ts=" + Date.now(), { cache:"no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);

    const j = await res.json();
    const items = Array.isArray(j?.items) ? j.items : [];

    const list = items.slice(0, 8).map(x=>{
      const titulo = normalizeText_(x.titulo || "Mensagem");
      const texto  = normalizeText_(x.texto || "");
      const fonte  = normalizeText_(x.fonte || "news.google.com");
      const data   = toBRDate_(x.data || "");

      // remove repeti√ß√£o: se texto for igual ao t√≠tulo (ou muito parecido), some
      let textoLimpo = texto;
      if(textoLimpo && titulo && textoLimpo.toLowerCase() === titulo.toLowerCase()){
        textoLimpo = "";
      }

      // tamb√©m remove a parte final " - dom√≠nio" do t√≠tulo, se vier colada
      // (opcional, melhora visual)
      const tituloLimpo = titulo.replace(/\s+-\s+[\w.-]+\.[a-z]{2,}.*$/i, "").trim() || titulo;

      return { titulo: tituloLimpo, texto: textoLimpo, fonte, data };
    });

    if(!list.length){
      newsBody.innerHTML = `
        <div class="newsItem">
          <div class="newsMeta">Fonte: news.google.com</div>
          <p class="h">Sem mensagens no momento</p>
          <p class="p">Aguardando atualiza√ß√£o do feed‚Ä¶</p>
        </div>`;
      newsBox.style.display = "flex";
      if(newsPill) newsPill.textContent = "‚Äî";
      return;
    }

    // Render no formato que voc√™ pediu
    newsBody.innerHTML = list.map(m=>{
      const meta = `Fonte: ${m.fonte || "news.google.com"}${m.data ? " - " + m.data : ""}`;

      return `
        <div class="newsItem">
          <div class="newsMeta">${escapeHtml(meta)}</div>
          <p class="h">${escapeHtml(m.titulo || "Mensagem")}</p>
          ${m.texto ? `<p class="p">${escapeHtml(m.texto)}</p>` : ``}
        </div>
      `;
    }).join("");

    newsBox.style.display = "flex";
    if(newsPill) newsPill.textContent = "Atualizado";

  }catch(e){
    console.warn("Falha ao carregar mensagens_cidade.json:", e);
    newsBody.innerHTML = `
      <div class="newsItem">
        <div class="newsMeta">Fonte: news.google.com</div>
        <p class="h">Mensagens indispon√≠veis</p>
        <p class="p">Sem conex√£o ou arquivo n√£o encontrado.</p>
      </div>`;
    newsBox.style.display = "flex";
    if(newsPill) newsPill.textContent = "Offline";
  }
}

    
    async function loadAll(){
      const status = document.getElementById("statusJson");
      const dot = document.getElementById("dotOnline");
      const refPill = document.getElementById("refPill");

      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const ct = (res.headers.get("content-type") || "").toLowerCase();
        if (!ct.includes("application/json")) throw new Error("Resposta n√£o-JSON: " + ct);
        const data = await res.json();

        setText("condoCenter", safeText(data.condominio || "‚Äî"));

        if (status) status.textContent = "Atualizado";
        if (dot) dot.style.background = "#44d07a";
        if (refPill) refPill.textContent = "Atualizado";

        renderAvisos(data);

        if (data.temaDoDia && data.temaDoDia.modo === "biblico-anual") {
          setText("dataBiblica", "üìñ");
          setText("ref", "Carregando‚Ä¶");
        } else {
          setText("dataBiblica", "üìå Avisos");
          setText("ref", safeText(data.referencia || "Atualizado"));
        }

        await carregarVersiculo(data);
        await carregarClima(data);
        iniciarPublicidade(data);

        // >>> Mensagens da Cidade v√™m SOMENTE do mensagens_cidade.json <<<
        await carregarMensagensCidade();

        return data;

      } catch(e){
        console.warn("Falha ao carregar data.json:", e);
        if (status) status.textContent = "Offline";
        if (dot) dot.style.background = "#ff5a5a";
        if (refPill) refPill.textContent = "Offline";
        return null;
      }
    }

    loadAll();
    setInterval(loadAll, 60000);
  </script>

  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      try {
        const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });
        try { await reg.update(); } catch(e){}
        reg.addEventListener("updatefound", () => {
          const nw = reg.installing;
          if(!nw) return;
          nw.addEventListener("statechange", () => {
            if (nw.state === "installed" && navigator.serviceWorker.controller) {
              nw.postMessage("SKIP_WAITING");
            }
          });
        });
      } catch(e){}
    });

    navigator.serviceWorker.addEventListener("controllerchange", () => {
      const banner = document.getElementById("updateBanner");
      if(banner) banner.style.display = "block";
      setTimeout(()=>window.location.reload(), 1200);
    });
  }
  </script>

  <script>
  // ===== FUNDO DIN√ÇMICO =====
  const fundos = {
    azul:    ["#061726", "#0b1f33"],
    verde:   ["#0b2e1a", "#134d2c"],
    amarelo: ["#3a3300", "#665c00"],
    laranja: ["#3a1f00", "#663300"],
    branco:  ["#f2f2f2", "#dcdcdc"],
    preto:   ["#000000", "#111111"]
  };

  function setFundo(cor){
    if(!fundos[cor]) return;
    document.documentElement.style.setProperty("--bg1", fundos[cor][0]);
    document.documentElement.style.setProperty("--bg2", fundos[cor][1]);
    try { localStorage.setItem("fundoEscolhido", cor); } catch(e){}
  }

  function fundoAleatorio(){
    const cores = Object.keys(fundos);
    const cor = cores[Math.floor(Math.random() * cores.length)];
    setFundo(cor);
    return cor;
  }

  (function carregarFundoSalvo(){
    try{
      const salvo = localStorage.getItem("fundoEscolhido");
      if(salvo && fundos[salvo]) setFundo(salvo);
    }catch(e){}
  })();

  window.addEventListener("keydown", (e)=>{
    const k = String(e.key || "").toLowerCase();
    if (k === "1") setFundo("azul");
    else if (k === "2") setFundo("verde");
    else if (k === "3") setFundo("amarelo");
    else if (k === "4") setFundo("laranja");
    else if (k === "5") setFundo("branco");
    else if (k === "6") setFundo("preto");
    else if (k === "r") fundoAleatorio();
  });

  setInterval(fundoAleatorio, 300000); // 5 min
  </script>

</body>
</html>
