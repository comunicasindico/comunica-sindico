<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="canonical" href="./">
  <script>
  (function () {
    try {
      const u = new URL(location.href);
      if (u.search) { u.search = ""; location.replace(u.toString()); return; }
      if (u.pathname.endsWith("/index.html")) { location.replace("./"); return; }
    } catch(e){}
  })();
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Cond√¥minos - Comunica S√≠ndico(a)</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#0b223a">

  <style>
    :root{
      --bg1:#061726;
      --bg2:#0b1f33;
      --line:rgba(255,255,255,.10);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.75);
      --shadow: 0 14px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --sat: env(safe-area-inset-top);
      --sar: env(safe-area-inset-right);
      --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left);
    }
    *{box-sizing:border-box}
    html,body{height:100%;width:100%}

    body{
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(16,56,91,0.55), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(11,52,84,0.55), transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));

      /* TV/PC: layout travado com scroll interno */
      overflow:hidden;
      overscroll-behavior:none;
      touch-action:manipulation;

      /* IMPORTANTES: evita rodap√© ‚Äúcortado‚Äù por barra do Windows/TV */
      min-height:100svh;
      padding-bottom: max(14px, env(safe-area-inset-bottom));
    }

    .wrap{
      min-height:100svh;
      width:100%;
      padding:
        calc(14px + var(--sat))
        calc(14px + var(--sar))
        calc(14px + var(--sab))
        calc(14px + var(--sal));
      display:flex;
      justify-content:center;
    }

    .container{
      width:100%;
      max-width:1600px;
      min-height:100svh;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* ===== HEADER ===== */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:16px 18px;
      background:rgba(8,28,46,.60);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      flex:0 0 auto;
      width:100%;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width:0;
      flex:1 1 auto;
    }
    .brand .title{
      margin:0;
      font-size:22px;
      font-weight:900;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      margin:0;
      font-size:12.5px;
      color:var(--muted);
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .condoCenter{
      flex:1 1 auto;
      min-width:0;
      text-align:center;
      font-weight:950;
      letter-spacing:.2px;
      color:rgba(234,242,255,.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      padding:0 8px;
    }

    .rightInfo{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex:0 0 auto;
    }
    .badge{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.55);
      color:var(--muted);font-weight:900;font-size:12px;
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:#ff5a5a}
    #statusJson{font-weight:950;color:rgba(234,242,255,.92)}
    #clock{font-size:22px;font-weight:950;letter-spacing:.6px;color:#fff}
    .btnInstall{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(12,35,56,.55);
      color:rgba(234,242,255,.92);
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      font-size:14px;
      white-space:nowrap;
    }
    .updateBanner{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(120,190,255,.35);
      background:rgba(7,20,34,.28);
      box-shadow:var(--shadow);
      font-weight:900;
      flex:0 0 auto;
      width:100%;
    }

    /* ===== MAIN (TV/PC: 2 COLUNAS) ===== */
    .main{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns: 1.20fr .80fr;
      gap:12px;
      width:100%;
    }

    .panel{
      background:linear-gradient(180deg, rgba(15,43,69,.92), rgba(11,33,55,.92));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      min-height:0;
      overflow:hidden;
    }

    .panelHead{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(7,20,34,.20);
      flex:0 0 auto;
    }
    .panelTitle{
      display:flex;align-items:center;gap:10px;
      font-size:13px;
      font-weight:950;
      letter-spacing:.6px;
      color:rgba(234,242,255,.95);
      text-transform:uppercase;
    }
    .pill{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.35);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .avisos{
      padding:14px;
      overflow:auto; /* TV/PC: scroll interno */
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }

    .aviso{
      padding:14px 14px;
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(7,20,34,.28);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .aviso.alta{
      border-color:rgba(255,70,70,.75);
      background:linear-gradient(180deg, rgba(255,70,70,.16), rgba(7,20,34,.28));
    }
    .aviso.media{
      border-color:rgba(255,160,40,.70);
      background:linear-gradient(180deg, rgba(255,160,40,.14), rgba(7,20,34,.28));
    }
    .aviso.baixa{
      border-color:rgba(110,190,255,.70);
      background:linear-gradient(180deg, rgba(110,190,255,.12), rgba(7,20,34,.28));
    }
    .aviso .t{margin:0;font-weight:950;font-size:18px}
    .aviso .d{margin:0;color:var(--muted);line-height:1.35;font-size:14px}
    .aviso .meta{display:flex;flex-wrap:wrap;gap:8px;margin-top:2px}
    .tag{
      font-size:12px;font-weight:950;
      padding:7px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.35);
      color:rgba(234,242,255,.95);
    }

    /* ===== AD ===== */
    .adBody{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }
    .adCard{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(7,20,34,.18);
      border-radius:14px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .adLabel{
      padding:10px 12px;
      font-weight:950;
      border-bottom:1px solid rgba(255,255,255,.10);
      color:rgba(234,242,255,.92);
      background:rgba(12,35,56,.35);
    }
    .videoWrap{
      width:100%;
      aspect-ratio:16/9;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    video{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      object-position:center;
      background:#000;
    }
    video.fit-contain{ object-fit:contain; }

    /* ===== FOOTER (2 LINHAS) ===== */
    .ticker{
      flex:0 0 auto;
      width:100%;
      padding:10px 12px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(8,28,46,.60);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:6px;

      /* evita ser ‚Äúengolido‚Äù por barras inferiores */
      margin-bottom: max(14px, env(safe-area-inset-bottom));
    }

    .tickerLine1{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
      overflow:hidden;
    }

    .tickerIcon{
      font-size:clamp(16px, 2.2vw, 20px);
      opacity:.95;
      flex:0 0 auto;
    }

    #dataBiblica{
      font-weight:950;
      white-space:nowrap;
      color:rgba(234,242,255,.95);
      font-size:clamp(13px, 1.8vw, 16px);
      flex:0 0 auto;
    }

    #ref{
      color:rgba(234,242,255,.88);
      font-weight:850;
      font-size:clamp(13px, 1.8vw, 16px);
      flex:1 1 auto;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .tickerLine2{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
    }

    .wxMini{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      color:rgba(234,242,255,.92);
      white-space:nowrap;
      font-size:clamp(12px, 1.7vw, 15px);
    }

    @media (max-width: 520px){
      .tickerLine2{ justify-content:flex-start; }
      .wxMini{ white-space:normal; }
    }

/* ===== MOBILE: scroll + v√≠deo embaixo ===== */
@media (max-width: 980px){
  body{
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 0;
  }

  .container{
    min-height:auto;
  }

  .topbar{
    flex-wrap:wrap;
  }

  .condoCenter{
    order:3;
    width:100%;
    text-align:left;
    padding:0;
  }

  /* Em MOBILE vira coluna: avisos acima, publicidade abaixo */
  .main{
    display:flex;
    flex-direction:column;
  }

  section.panel{ order:1; }
  #adBox{ order:2; }

  /* remove scroll interno no mobile: rolagem √∫nica da p√°gina */
  .panel{ min-height:auto; }
  .avisos{ overflow:visible; }

  /* rodap√© fica sempre vis√≠vel ao rolar */
  .ticker{
    position:sticky;
    bottom:0;
    z-index:9;
    margin-bottom: 0;
    padding-bottom: max(12px, env(safe-area-inset-bottom));
  }

  /* Vers√≠culo quebra linha no celular */
  .tickerLine1{ flex-wrap: wrap; }

  #dataBiblica{
    white-space: normal;
  }

  #ref{
    white-space: normal;
    overflow: visible;
    text-overflow: unset;
    line-height: 1.3;
  }
}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <div class="topbar">
        <div class="brand">
          <div class="title" id="titulo">Comunica S√≠ndico ‚Äî Cond√¥minos</div>
          <div class="sub" id="subtitulo">Painel informativo</div>
        </div>

        <div class="condoCenter" id="condoCenter">Condom√≠nio</div>

        <div class="rightInfo">
          <div class="badge" title="Status do painel">
            <span class="dot" id="dotOnline"></span>
            <span id="statusJson">Carregando...</span>
          </div>

          <div class="badge" title="Hora e Clima">
            <span id="wxIconTop">üå¶Ô∏è</span>
            <span id="clock">--:--</span>
          </div>

          <button id="btnInstalarApp" class="btnInstall" onclick="instalarApp()" style="display:none">‚¨áÔ∏è Instalar App</button>
        </div>
      </div>

      <div id="updateBanner" class="updateBanner" style="display:none">‚¨áÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶</div>

      <div class="main">
        <section class="panel">
          <div class="panelHead">
            <div class="panelTitle">üîî Avisos Importantes</div>
            <div class="pill" id="refPill">Atualizado</div>
          </div>
          <div class="avisos" id="avisos"></div>
        </section>

        <aside class="panel" id="adBox" style="display:none">
          <div class="panelHead">
            <div class="panelTitle">üì£ Publicidade</div>
            <div class="pill" id="adPill">‚Äî</div>
          </div>

          <div class="adBody">
            <div class="adCard">
              <div class="adLabel" id="adLabel">An√∫ncio</div>
              <div class="videoWrap">
                <video id="adVideo" autoplay muted playsinline></video>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <div class="ticker">
        <div class="tickerLine1">
          <span class="tickerIcon">üìñ</span>
          <span id="dataBiblica">‚Äî</span>
          <span id="ref">‚Äî</span>
        </div>

        <div class="tickerLine2">
          <div class="wxMini">
            <span id="wxIcon">üå¶Ô∏è</span>
            <span id="wxText">Clima: carregando‚Ä¶</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    let deferredPrompt = null;

    function mostrarBotaoInstalar(show){
      const b = document.getElementById("btnInstalarApp");
      if (b) b.style.display = show ? "inline-flex" : "none";
    }

    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      mostrarBotaoInstalar(true);
    });

    window.addEventListener("appinstalled", ()=>{
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    });

    async function instalarApp(){
      if(!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    }

    function prioridadeClass(p){
      const x = String(p || "").toLowerCase();
      if (x === "alta") return "alta";
      if (x === "m√©dia" || x === "media") return "media";
      return "baixa";
    }

    function safeText(v){ return (v == null ? "" : String(v)); }
    function setText(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }
    function pad2(n){ return String(n).padStart(2,"0"); }

    function formatDT_BR(v){
      if(!v) return "";
      const d = new Date(v);
      if(isNaN(d.getTime())) return String(v);
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const aa = String(d.getFullYear()).slice(-2);
      const HH = pad2(d.getHours());
      const MM = pad2(d.getMinutes());
      return `${dd}/${mm}/${aa} - ${HH}:${MM}`;
    }

    function tickClock(){
      const d = new Date();
      setText("clock", `${pad2(d.getHours())}:${pad2(d.getMinutes())}`);
    }
    tickClock();
    setInterval(tickClock, 1000);

    let ROT_TIMER = null;
    let ROT_STATE = { page: 0, totalPages: 1, paused: false };

    function renderAvisos(data){
      const root = document.getElementById("avisos");
      if (!root) return;
      root.innerHTML = "";

      if (ROT_TIMER) { clearInterval(ROT_TIMER); ROT_TIMER = null; }

      const avisosAll = Array.isArray(data.avisos) ? data.avisos : [];
      const rot = data?.rotacao || {};
      const ativar = !!rot.ativar;
      const qtd = Math.max(1, Number(rot.quantidadePorTela || 4));
      const intervaloMs = Math.max(3, Number(rot.intervaloSeg || 12)) * 1000;

      if(!avisosAll.length){
        const div = document.createElement("div");
        div.className = "aviso baixa";
        div.innerHTML = `<p class="t">Sem avisos no momento</p><p class="d">${safeText(data.fallback || "‚Äî")}</p>`;
        root.appendChild(div);
        ROT_STATE = { page: 0, totalPages: 1, paused: false };
        return;
      }

      const totalPages = Math.max(1, Math.ceil(avisosAll.length / qtd));
      ROT_STATE = { page: 0, totalPages, paused: false };

      function renderPage(pageIdx){
        root.innerHTML = "";

        const start = pageIdx * qtd;
        const slice = avisosAll.slice(start, start + qtd);

        slice.forEach(a=>{
          const el = document.createElement("div");
          el.className = `aviso ${prioridadeClass(a.prioridade)}`;

          const titulo = safeText(a.titulo || "Aviso");
          const desc = safeText(a.descricao || "");
          const tipo = safeText(a.tipo || "");
          const local = safeText(a.local || "");
          const ini = formatDT_BR(a.inicio || "");
          const fim = formatDT_BR(a.fim || "");

          const tags = [];
          if(tipo) tags.push(`<span class="tag">üè∑Ô∏è ${tipo}</span>`);
          if(local) tags.push(`<span class="tag">üìç ${local}</span>`);
          if(ini || fim) tags.push(`<span class="tag">üóìÔ∏è ${ini}${fim ? " ‚Üí " + fim : ""}</span>`);
          tags.push(`<span class="tag">‚ö° ${safeText(a.prioridade || "Baixa")}</span>`);

          el.innerHTML = `
            <p class="t">${titulo}</p>
            ${desc ? `<p class="d">${desc}</p>` : ""}
            <div class="meta">${tags.join("")}</div>
          `;
          root.appendChild(el);
        });
      }

      renderPage(0);

      if (ativar && totalPages > 1){
        if (rot.pausarNoMouse){
          root.addEventListener("mouseenter", ()=> ROT_STATE.paused = true, {passive:true});
          root.addEventListener("mouseleave", ()=> ROT_STATE.paused = false, {passive:true});
          root.addEventListener("touchstart", ()=>{ ROT_STATE.paused = !ROT_STATE.paused; }, {passive:true});
        }

        ROT_TIMER = setInterval(()=>{
          if (ROT_STATE.paused) return;
          ROT_STATE.page = (ROT_STATE.page + 1) % totalPages;
          renderPage(ROT_STATE.page);
        }, intervaloMs);
      }
    }

    function hojeKeyMMDD() {
      const d = new Date();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${mm}-${dd}`;
    }

    async function carregarVersiculo(data) {
      if (!data?.temaDoDia || data.temaDoDia.modo !== "biblico-anual") return;

      try {
        const res = await fetch("versiculos.json?ts=" + Date.now(), { cache: "no-store" });
        const v = await res.json();

        const key = hojeKeyMMDD();
        const texto = v?.versos?.[key];

        setText("dataBiblica", v?.cabecalho || "üìñ Vers√≠culo do dia");
        setText("ref", texto ? texto : (v?.titulo ? v.titulo : "Vers√≠culo n√£o encontrado"));
      } catch (e) {}
    }

    function wxEmojiFromCode(code){
      if (code === 0) return "‚òÄÔ∏è";
      if ([1,2,3].includes(code)) return "‚õÖ";
      if ([45,48].includes(code)) return "üå´Ô∏è";
      if ([51,53,55,56,57].includes(code)) return "üå¶Ô∏è";
      if ([61,63,65,66,67].includes(code)) return "üåßÔ∏è";
      if ([71,73,75,77,85,86].includes(code)) return "‚ùÑÔ∏è";
      if ([80,81,82].includes(code)) return "üåßÔ∏è";
      if ([95,96,99].includes(code)) return "‚õàÔ∏è";
      return "üå¶Ô∏è";
    }

    async function carregarClima(data){
      const c = data?.clima;

      if (!c?.latitude || !c?.longitude) {
        setText("wxText", "Clima: configure latitude/longitude no data.json");
        return;
      }

      try {
        const url =
          "https://api.open-meteo.com/v1/forecast" +
          `?latitude=${encodeURIComponent(c.latitude)}` +
          `&longitude=${encodeURIComponent(c.longitude)}` +
          `&current=temperature_2m,relative_humidity_2m,precipitation,weather_code,wind_speed_10m` +
          `&timezone=${encodeURIComponent(c.timezone || "America/Sao_Paulo")}`;

        const res = await fetch(url, { cache: "no-store" });
        const j = await res.json();

        const cur = j?.current;
        if (!cur) throw new Error("Sem current");

        const emoji = wxEmojiFromCode(cur.weather_code);
        const t = Math.round(cur.temperature_2m);
        const w = Math.round(cur.wind_speed_10m);
        const p = cur.precipitation;

        const wx = document.getElementById("wxIcon");
        if (wx) wx.textContent = emoji;
        const top = document.getElementById("wxIconTop");
        if (top) top.textContent = emoji;

        setText("wxText", `${c.cidade || "Cidade"} ‚Ä¢ ${t}¬∞C ‚Ä¢ Vento ${w} km/h ‚Ä¢ Chuva ${p} mm`);
      } catch (e) {
        const wx = document.getElementById("wxIcon");
        if (wx) wx.textContent = "üå¶Ô∏è";
        const top = document.getElementById("wxIconTop");
        if (top) top.textContent = "üå¶Ô∏è";
        setText("wxText", `${data?.clima?.cidade || "‚Äî"} (offline)`);
      }
    }

    function iniciarPublicidade(data){
      const pub = data?.publicidade;
      const adBox = document.getElementById("adBox");
      const adVideo = document.getElementById("adVideo");
      const adLabel = document.getElementById("adLabel");
      const adPill = document.getElementById("adPill");

      if (!adBox || !adVideo || !adLabel) return;

      if (!(pub?.ativar && Array.isArray(pub.videos) && pub.videos.length)) {
        adBox.style.display = "none";
        return;
      }

      const intervalMs = Math.max(3, Number(pub.intervaloSeg || 10)) * 1000;
      let idx = 0;

      function playNext(){
        const item = pub.videos[idx];
        if(!item) return;

        adLabel.textContent = String(item.anunciante || "An√∫ncio");
        if (adPill) adPill.textContent = "Atualizando‚Ä¶";

        const src = String(item.arquivo || "");
        const sep = src.includes("?") ? "&" : "?";
        const finalSrc = src ? (src + sep + "ts=" + Date.now()) : "";

        adVideo.pause();
        adVideo.classList.remove("fit-contain");
        adVideo.removeAttribute("src");
        adVideo.load();

        adVideo.src = finalSrc;
        adVideo.load();

        adVideo.play().catch(() => {
          setTimeout(playNext, 800);
        });

        idx++;
        if(idx >= pub.videos.length) idx = 0;
      }

      adVideo.onloadedmetadata = () => {
        const isVertical = adVideo.videoHeight > adVideo.videoWidth;
        if (isVertical) adVideo.classList.add("fit-contain");
        else adVideo.classList.remove("fit-contain");
        if (adPill) adPill.textContent = "No ar";
      };

      adVideo.onended = () => setTimeout(playNext, intervalMs);
      adVideo.onerror = () => setTimeout(playNext, 1000);

      adBox.style.display = "flex";
      playNext();
    }

    async function loadAll(){
      const status = document.getElementById("statusJson");
      const dot = document.getElementById("dotOnline");
      const refPill = document.getElementById("refPill");

      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const ct = (res.headers.get("content-type") || "").toLowerCase();
        if (!ct.includes("application/json")) throw new Error("Resposta n√£o-JSON: " + ct);
        const data = await res.json();

        setText("condoCenter", safeText(data.condominio || "‚Äî"));

        if (status) status.textContent = "Atualizado";
        if (dot) dot.style.background = "#44d07a";
        if (refPill) refPill.textContent = "Atualizado";

        renderAvisos(data);

        if (data.temaDoDia && data.temaDoDia.modo === "biblico-anual") {
          setText("dataBiblica", "üìñ Vers√≠culo do dia");
          setText("ref", "Carregando‚Ä¶");
        } else {
          setText("dataBiblica", "üìå Avisos");
          setText("ref", safeText(data.referencia || "Atualizado"));
        }

        await carregarVersiculo(data);
        await carregarClima(data);
        iniciarPublicidade(data);

        return data;

      } catch(e){
        console.warn("Falha ao carregar data.json:", e);
        if (status) status.textContent = "Offline";
        if (dot) dot.style.background = "#ff5a5a";
        if (refPill) refPill.textContent = "Offline";
        return null;
      }
    }

    loadAll();
    setInterval(loadAll, 60000);
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });
          try { await reg.update(); } catch(e){}
          reg.addEventListener("updatefound", () => {
            const nw = reg.installing;
            if(!nw) return;
            nw.addEventListener("statechange", () => {
              if (nw.state === "installed" && navigator.serviceWorker.controller) {
                nw.postMessage("SKIP_WAITING");
              }
            });
          });
        } catch(e){}
      });

      navigator.serviceWorker.addEventListener("controllerchange", () => {
        const banner = document.getElementById("updateBanner");
        if(banner) banner.style.display = "block";
        setTimeout(()=>window.location.reload(), 1200);
      });
    }
  </script>
</body>
</html>
