<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Comunica SÃ­ndico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: #0b1c2d;
  color: #fff;
}
.container {
  display: grid;
  grid-template-rows: auto 1fr auto;
  height: 100vh;
}
header {
  background: #102a43;
  padding: 20px 40px;
  font-size: 32px;
  font-weight: 600;
}
main {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 30px;
  padding: 30px 40px;
}
.avisos {
  background: #16324f;
  border-radius: 12px;
  padding: 25px;
}
.avisos h2 {
  margin-top: 0;
  font-size: 26px;
}
.aviso {
  margin-bottom: 18px;
  padding-bottom: 18px;
  border-bottom: 1px solid rgba(255,255,255,0.15);
}
.aviso:last-child { border-bottom: none; }
.aviso h3 { margin: 0 0 6px; font-size: 20px; }
.aviso p { margin: 0; font-size: 17px; opacity: 0.9; }

.lateral {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.box {
  background: #16324f;
  border-radius: 12px;
  padding: 20px;
  font-size: 20px;
}

footer {
  background: #102a43;
  padding: 12px 40px;
  font-size: 16px;
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
}
footer.alerta {
  background: #7a1f1f;
}
#rodape-clima {
  white-space: nowrap;
  font-weight: 500;
}
</style>
</head>

<body>
<div class="container">
  <header id="titulo"></header>

  <main>
    <section class="avisos">
      <h2>Avisos do dia</h2>
      <div id="lista-avisos"></div>
    </section>

    <aside class="lateral">
      <div class="box" id="data"></div>
      <div class="box" id="hora"></div>
    </aside>
  </main>

  <footer id="rodape">
    <span id="rodape-esq"></span>
    <span id="rodape-clima">Clima: carregandoâ€¦</span>
    <span id="rodape-dir"></span>
  </footer>
</div>

<script>
const ICONES = {
  sol: "â˜€ï¸",
  nuvem: "â›…",
  chuva: "ðŸŒ§ï¸",
  temp: "ðŸŒ©ï¸",
  neve: "â„ï¸"
};

const WMO = {
  0:["sol","CÃ©u limpo"], 1:["nuvem","Poucas nuvens"], 2:["nuvem","Parcialmente nublado"],
  3:["nuvem","Nublado"],
  61:["chuva","Chuva fraca"], 63:["chuva","Chuva"], 65:["chuva","Chuva forte"],
  80:["chuva","Pancadas"], 95:["temp","Tempestade"]
};

let CONFIG;

async function carregarDados() {
  const r = await fetch("data.json?_=" + Date.now());
  CONFIG = await r.json();

  document.getElementById("titulo").innerText = CONFIG.titulo;
  document.getElementById("rodape-esq").innerText = CONFIG.rodape.esquerdo;
  document.getElementById("rodape-dir").innerText = CONFIG.rodape.direito;

  const lista = document.getElementById("lista-avisos");
  lista.innerHTML = "";
  CONFIG.avisos.forEach(a => {
    lista.innerHTML += `<div class="aviso"><h3>${a.titulo}</h3><p>${a.texto}</p></div>`;
  });

  atualizarClima();
}

function atualizarHora() {
  const d = new Date();
  document.getElementById("hora").innerText =
    d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("data").innerText =
    d.toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long",year:"numeric"});
}

async function atualizarClima() {
  const c = CONFIG.clima;
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${c.latitude}&longitude=${c.longitude}&current=temperature_2m,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min&hourly=precipitation_probability&timezone=auto`;

  const r = await fetch(url);
  const j = await r.json();

  const code = j.current.weather_code;
  const info = WMO[code] || ["nuvem","Tempo"];
  const icone = ICONES[info[0]];
  const desc = info[1];

  const temp = Math.round(j.current.temperature_2m);
  const max = Math.round(j.daily.temperature_2m_max[0]);
  const min = Math.round(j.daily.temperature_2m_min[0]);

  const chuvaProxHoras = j.hourly.precipitation_probability
    .slice(0,6).some(p => p >= 50);

  const rodape = document.getElementById("rodape");
  if (chuvaProxHoras && c.alertaChuva) {
    rodape.classList.add("alerta");
  } else {
    rodape.classList.remove("alerta");
  }

  document.getElementById("rodape-clima").innerText =
    `${icone} ${desc} â€¢ ${temp}Â°C (MÃ¡x ${max}Â° / MÃ­n ${min}Â°)`;
}

carregarDados();
atualizarHora();
setInterval(atualizarHora,1000);
setInterval(atualizarClima,15*60*1000);
</script>
</body>
</html>
