<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>Comunica S√≠ndico ‚Äî Cond√¥minos</title>

<!-- =====================================================
     PWA / META
===================================================== -->
<link rel="manifest" href="./manifest-condominos.json" />
<meta name="theme-color" content="#0b223a" />
<meta name="background-color" content="#061726" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Cond√¥minos" />

<link rel="icon" sizes="192x192" href="./icons/icon-192.png" />
<link rel="icon" sizes="512x512" href="./icons/icon-512.png" />
<link rel="apple-touch-icon" href="./icons/icon-192.png" />

<!-- =====================================================
     DETEC√á√ÉO DE DISPOSITIVO (ANTES DO CSS)
===================================================== -->
<script>
(function(){
  try{
    const ua = (navigator.userAgent||"").toLowerCase();
    const qs = new URLSearchParams(location.search);

    const looksMobile = /mobi|iphone|ipod|ipad|android.*mobile/.test(ua);
    const isTVua =
      ua.includes("smart-tv") || ua.includes("android tv") ||
      ua.includes("browsehere") || ua.includes("tizen") ||
      ua.includes("webos") || ua.includes("roku") ||
      ua.includes("bravia") || ua.includes("tv");

    const forceTV = qs.get("tv")==="1";
    const isTV = forceTV || (!looksMobile && isTVua);
    const isMobile = looksMobile && !isTV;

    const w = Math.max(innerWidth, document.documentElement.clientWidth);
    const h = Math.max(innerHeight, document.documentElement.clientHeight);
    const isPortrait = h > w;

    const root = document.documentElement;
    root.classList.toggle("isTV", isTV);
    root.classList.toggle("isMobileUA", isMobile);
    root.classList.toggle("isPortrait", isPortrait);

    addEventListener("resize", ()=>root.classList.toggle("isPortrait", innerHeight>innerWidth), {passive:true});
  }catch(e){}
})();
</script>

<!-- =====================================================
     STYLE / CSS
     (BASE + PC + TV + MOBILE)
===================================================== -->
<style>

/* =======================
   VARI√ÅVEIS GLOBAIS
======================= */
:root{
  --bg1:#061726;
  --bg2:#0b1f33;
  --line:rgba(255,255,255,.14);
  --radius:18px;
  --shadow:0 18px 44px rgba(0,0,0,.35);
  --ui:1;
  --ui2:1;
  --tv-scale:.9;
}

/* =======================
   RESET / BASE
======================= */
*{box-sizing:border-box}
html,body{
  margin:0;
  height:100%;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  overflow:hidden;
}

.wrap{height:100dvh;padding:10px}
.container{height:100%;display:flex;flex-direction:column;gap:10px}
.main{flex:1;min-height:0;display:flex;flex-direction:column;gap:10px}

/* =======================
   GRID FIXO PC / TV
======================= */
.quadTop{
  flex:1;
  display:grid;
  grid-template-columns:1fr 1fr;
  grid-template-rows:repeat(3,1fr);
  gap:10px;
}
#tile1{grid-column:1;grid-row:1}
#tile2{grid-column:2;grid-row:1}
#tile3{grid-column:1;grid-row:2}
#slot5{grid-column:1;grid-row:3}
#tile4{grid-column:2;grid-row:2/4}

/* =======================
   MOBILE ‚Äî COLUNA + ROLAGEM
======================= */
html.isMobileUA:not(.isTV),
html.isMobileUA:not(.isTV) body{
  overflow:auto;
  height:auto;
}
html.isMobileUA:not(.isTV) .quadTop{
  display:flex;
  flex-direction:column;
}
html.isMobileUA:not(.isTV) .wrap{
  height:auto;
}

/* =======================
   TV ‚Äî FORMATO PC + ANTIOVERSCAN
======================= */
html.isTV:not(.isPortrait){
  overflow:hidden;
}
html.isTV:not(.isPortrait) .wrap{
  position:fixed;
  width:92vw;
  height:92vh;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(var(--tv-scale));
}
html.isTV:not(.isPortrait) .quadTop{
  display:grid!important;
}

/* =======================
   V√çDEO ‚Äî MOLDURA TV
======================= */
.videoWrap{position:relative}
.videoWrap .tvOverlay{
  position:absolute;
  inset:0;
  border:4px solid #000;
  border-bottom-width:18px;
  border-radius:12px;
  pointer-events:none;
  z-index:50;
}
.videoWrap .tvOverlay::after{
  content:"CS";
  position:absolute;
  bottom:4px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  font-weight:800;
  letter-spacing:.22em;
}

/* MOBILE remove bezel */
@media(max-width:600px){
  .videoWrap .tvOverlay{border-bottom-width:4px}
  .videoWrap .tvOverlay::after{display:none}
}

</style>
</head>
<body>

<div class="wrap">
  <div class="container">

    <!-- =======================
         TOPO
    ======================= -->
    <div class="topbar">
      <div class="brand">
        <div class="title">
          <span id="titulo">Comunica S√≠ndico - Cond√¥minos</span>
          <span id="wxIconTitle" class="wxTitleIcon"></span>
        </div>

        <div class="subMobileLine">
          <span id="statusJsonMini">Carregando...</span>
          <span class="sep">‚Ä¢</span>
          <span id="clockMini">--:--</span>
        </div>
      </div>

      <div class="rightInfo">
        <div class="badge">
          <span class="dot" id="dotOnline"></span>
          <span id="statusJson">Carregando...</span>
        </div>

        <div class="badge">
          <span id="wxIconTop"></span>
          <span id="clock">--:--</span>
        </div>

        <div class="subRight" id="subtitulo">Painel informativo</div>
        <button id="btnInstalarApp" class="btnInstall" style="display:none">‚¨áÔ∏è Instalar App</button>
      </div>
    </div>

    <div id="updateBanner" class="updateBanner" style="display:none">
      ‚¨áÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶
    </div>

    <!-- =======================
         CONTE√öDO PRINCIPAL
    ======================= -->
    <div class="main">

      <div class="sectionBar">
        <div class="sectionTitle">Avisos</div>
        <div class="pill" id="refPill">Super atualiza√ß√£o</div>
      </div>

      <!-- =======================
           GRID 2x3 FIXO
      ======================= -->
      <div class="quadTop" id="avisosPane">

        <div class="panel tile" id="tile1">
          <div class="tileBody" id="slot1"></div>
        </div>

        <div class="panel tile" id="tile2">
          <div class="tileBody" id="slot2"></div>
        </div>

        <div class="panel tile" id="tile3">
          <div class="tileBody" id="slot3"></div>
        </div>

        <!-- ===== V√çDEO ===== -->
        <div class="panel tile" id="tile4">
          <div class="tileBody" id="slot4">

            <div class="videoWrap">

              <button class="adNav adPrev" onclick="adPrevBtn()">‚èÆ</button>
              <button class="adNav adNext" onclick="adNextBtn()">‚è≠</button>

              <video id="adVideoBg" class="videoBg" autoplay muted loop playsinline></video>
              <video id="adVideo" class="videoMain" autoplay muted playsinline></video>

              <div class="tvOverlay"></div>
            </div>

            <div class="adBelow">
              <div class="adBelowText" id="adLabelBelow">‚Äî</div>
            </div>

          </div>
        </div>

        <!-- ===== MENSAGENS ===== -->
        <div class="tile" id="slot5">
          <div class="newsBox" id="newsBox" style="display:none">
            <div class="newsHead">
              <div class="newsTitle">üì∞ Mensagens no Brasil</div>
            </div>
            <div id="newsBody"></div>
          </div>
        </div>

      </div>

      <!-- ALERTA URGENTE -->
      <div class="alertBox" id="alertBox" style="display:none">
        <div class="alertHead">
          <div class="alertTitle" id="alertTitle">ALERTA URGENTE</div>
          <div class="pill" id="alertOffBtn">Desligar</div>
        </div>
        <div class="alertBody">
          <p class="alertMsg" id="alertMsg">‚Äî</p>
        </div>
      </div>

    </div>

    <!-- =======================
         RODAP√â / TICKER
    ======================= -->
    <div class="ticker">
      <div class="tickerLine1">
        <span class="tickerIcon">üìñ</span>
        <span id="dataBiblica">‚Äî</span>
        <span id="ref">‚Äî</span>

        <div class="wxInline">
          <span id="wxIconInline"></span>
          <span id="wxCityTemp">‚Äî</span>
          <span id="wxWindRain">‚Äî</span>
        </div>
      </div>
    </div>

  </div>
</div>

<script>

/* =======================
   TOKEN / PWA
======================= */
const CS_TOKEN_KEY="CS_TOKEN_V1";
const csGetToken=()=>localStorage.getItem(CS_TOKEN_KEY)||"";
const csSetToken=t=>t&&localStorage.setItem(CS_TOKEN_KEY,t);

/* =======================
   REL√ìGIO
======================= */
function pad(n){return String(n).padStart(2,"0")}
function tickClock(){
  const d=new Date();
  const h=`${pad(d.getHours())}:${pad(d.getMinutes())}`;
  clock.textContent=h;
  clockMini.textContent=h;
}
setInterval(tickClock,1000);
tickClock();

/* =======================
   AVISOS
======================= */
function renderAvisos(data){
  const s1=slot1,s2=slot2,s3=slot3;
  s1.innerHTML="";s2.innerHTML="";s3.innerHTML="";
  (data.avisos||[]).slice(0,3).forEach((a,i)=>{
    const el=document.createElement("div");
    el.className="aviso "+(a.prioridade||"baixa");
    el.innerHTML=`<p class="t">${a.titulo}</p><p class="d">${a.descricao||""}</p>`;
    [s1,s2,s3][i].appendChild(el);
  });
}

/* =======================
   CLIMA (placeholder)
======================= */
function carregarClima(data){
  wxCityTemp.textContent=(data.clima?.cidade||"‚Äî")+" "+(data.clima?.temp||"")+"¬∞C";
}

/* =======================
   MENSAGENS
======================= */
async function carregarMensagensCidade(){
  try{
    const r=await fetch("mensagens_cidade.json?ts="+Date.now());
    const j=await r.json();
    newsBody.innerHTML=j.items.map(i=>`<div class="newsItem">${i.titulo}</div>`).join("");
    newsBox.style.display="flex";
  }catch(e){}
}

/* =======================
   PUBLICIDADE
======================= */
function adPlayByState(videos){
  if(!videos?.length)return;
  const v=videos[0];
  adVideo.src=v.arquivo;
  adVideoBg.src=v.arquivo;
  adLabelBelow.textContent=v.anunciante||"‚Äî";
}
function adNextBtn(){}
function adPrevBtn(){}

/* =======================
   LOAD GERAL
======================= */
async function loadAll(){
  try{
    const r=await fetch("data.json?ts="+Date.now());
    const d=await r.json();
    renderAvisos(d);
    carregarClima(d);
    carregarMensagensCidade();
    adPlayByState(d.publicidade?.videos||[]);
    dotOnline.style.background="#2ecc71";
  }catch(e){
    dotOnline.style.background="#ff5a5a";
  }
}
loadAll();

</script>

<script>
/* =======================
   FIX TV ‚Äî BLOQUEIA FULLSCREEN
======================= */
(function(){
  if(!document.documentElement.classList.contains("isTV"))return;
  document.querySelectorAll("video").forEach(v=>{
    v.requestFullscreen=()=>{};
    v.webkitEnterFullscreen=()=>{};
  });
})();
</script>

<script>
/* =======================
   TV SCALE AJUST√ÅVEL
======================= */
(function(){
  const root=document.documentElement;
  if(!root.classList.contains("isTV"))return;
  let s=parseFloat(localStorage.getItem("TV_SCALE"))||0.9;
  root.style.setProperty("--tv-scale",s);
  document.addEventListener("keydown",e=>{
    if(e.key==="+")s=Math.min(1,s+.01);
    if(e.key==="-")s=Math.max(.75,s-.01);
    root.style.setProperty("--tv-scale",s);
    localStorage.setItem("TV_SCALE",s);
  });
})();
</script>

</body>
</html>

