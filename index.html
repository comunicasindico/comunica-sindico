<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Comunica S√≠ndico ‚Äî Cond√¥minos</title>

  <!-- ‚úÖ MARCA isTV / isMobileUA ANTES DO CSS (√† prova de zoom) -->
  <script>
  (function preClassifyDevice(){
    try{
      const ua = (navigator.userAgent || "").toLowerCase();

      // mobile UA (N√ÉO pega Android TV)
      const isMobileUA = /mobi|iphone|ipod|ipad|android.*mobile/.test(ua);

      // UAs t√≠picas de TV
      const isTVua =
        ua.includes("smart-tv") || ua.includes("smarttv") ||
        ua.includes("hbbtv") || ua.includes("appletv") ||
        ua.includes("googletv") || ua.includes("android tv") ||
        ua.includes("bravia") || ua.includes("sonydtv") ||
        ua.includes("netcast") || ua.includes("tizen") ||
        ua.includes("web0s") || ua.includes("webos") ||
        ua.includes("viera") || ua.includes("roku") ||
        ua.includes("aft") || ua.includes("tv");

      // üîí ‚Äútamanho f√≠sico‚Äù (screen.* n√£o muda com zoom)
      const sw = Number(screen.width || 0);
      const sh = Number(screen.height || 0);
      const maxS = Math.max(sw, sh);
      const minS = Math.min(sw, sh);

      // Heur√≠stica forte: telas grandes
      const isPhysBig = (maxS >= 960 && minS >= 540) || (maxS >= 1280 && minS >= 720);

      // viewport grande (fallback)
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      const isViewportBig = (Math.max(vw, vh) >= 1100 && Math.min(vw, vh) >= 650);

 // 1) For√ßa manual: use ?tv=1 na URL (recomendado para SEMP/BrowseHere)
const qs = new URLSearchParams(location.search);
const forceTV = (qs.get("tv") === "1");

// 2) BrowseHere (SEMP): trate como TV
const isBrowseHere = ua.includes("browsehere") || ua.includes("browse here");

// ‚úÖ TV final: for√ßado OU BrowseHere OU heur√≠sticas
const shouldTV = forceTV || isBrowseHere || (!isMobileUA && (isTVua || isPhysBig || isViewportBig));

      document.documentElement.classList.toggle("isMobileUA", !!isMobileUA);
      document.documentElement.classList.toggle("isTV", !!shouldTV);
    }catch(e){}
  })();
  </script>

  <style>
    :root{
      --bg1:#061726;
      --bg2:#0b1f33;
      --line: rgba(255,255,255,.14);
      --muted: rgba(234,242,255,.74);
      --radius: 18px;
      --shadow: 0 18px 44px rgba(0,0,0,.35);
      --news-bg: rgba(10,30,50,.55);
      --news-border: rgba(255,255,255,.12);
      --news-shadow: 0 18px 44px rgba(0,0,0,.30);
      --font-soft: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;

      /* escalas padr√£o */
      --ui: 1;
      --ui2: 1;
      --tv-safe-bottom: 0px;

      /* safe-area */
      --sat: env(safe-area-inset-top, 0px);
      --sar: env(safe-area-inset-right, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);

      --topbar-bg: none;
    }

    /* ‚úÖ mata rolagem por padding/altura */
    *, *::before, *::after{ box-sizing:border-box; }

    html, body{
      height:100%;
      width:100%;
      margin:0;
      overflow:hidden; /* mobile libera em media query */
      background: radial-gradient(1200px 800px at 30% 10%, rgba(70,120,180,.20), transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      color:#fff;
      font-family: var(--font-soft);
    }

    .wrap{
      height:100dvh;
      min-height:100dvh;
      padding:
        calc(10px + var(--sat))
        calc(10px + var(--sar))
        calc(10px + var(--sab))
        calc(10px + var(--sal));
    }

    .container{
      height:100%;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .topbar{
      flex:0 0 auto;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      background:
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45)),
        var(--topbar-bg);
      background-size: cover;
      background-position:center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      gap:10px;
    }

    .brand{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .title{ font-weight:950; letter-spacing:.3px; font-size: calc(18px * var(--ui2)); line-height:1.1; }
    .sub{ color:rgba(234,242,255,.84); font-weight:850; font-size: calc(12px * var(--ui)); }
    .subMobileLine{ display:none; align-items:center; justify-content:center; gap:10px; color:rgba(234,242,255,.8); font-weight:900; }
    .sep{ opacity:.35; font-weight:900; }

    .rightInfo{ display:flex; align-items:center; gap:10px; }

    .badge{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.55);
      color:var(--muted);
      font-weight:900;
      font-size: calc(12px * var(--ui));
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:#ff5a5a}
    #statusJson{font-weight:950;color:rgba(234,242,255,.92)}
    #clock{ font-weight:950; color:rgba(234,242,255,.92); font-size: calc(16px * var(--ui2)); }

    .btnInstall{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.25);
      color:#fff;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:950;
      cursor:pointer;
    }

    .updateBanner{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color:#fff;
      border-radius:14px;
      padding:10px 12px;
      font-weight:950;
    }

    .main{
      flex:1 1 auto;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow:hidden;
    }

    /* Cabe√ßalho √∫nico dos Avisos + bot√£o Atualizar na mesma linha */
    .sectionBar{
      flex:0 0 auto;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      background:rgba(8,28,46,.60);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
    }
    .sectionTitle{
      font-weight:950;
      letter-spacing:.6px;
      text-transform:uppercase;
      font-size: calc(18px * var(--ui2));
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      font-size: calc(12px * var(--ui));
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.35);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      user-select:none;
      cursor:pointer;
    }
    .pill:hover{ filter:brightness(1.08); }
    .pill:active{ transform:scale(.98); }

    .panel{
      background:linear-gradient(180deg, rgba(15,43,69,.92), rgba(11,33,55,.92));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      min-height:0;
      overflow:hidden;
    }

    .quadTop{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap:8px;
      width:100%;
      height:100%;
    }

    .tile{ min-height:0; overflow:hidden; display:flex; flex-direction:column; }
    .tileBody{
      padding:12px;
      min-height:0;
      flex:1 1 auto;
      overflow:hidden;
      display:flex;
    }

    @keyframes avisoIn{
      from{ opacity:0; transform: translateY(8px) scale(.995); }
      to  { opacity:1; transform: translateY(0) scale(1); }
    }

    .aviso{
      height:100%;
      width:100%;
      padding:16px 16px 12px 18px;
      border-radius:16px;
      background:linear-gradient(180deg, rgba(20,60,95,.88), rgba(10,30,50,.88));
      display:flex;
      flex-direction:column;
      gap:10px;
      border:1px solid rgba(140,200,255,.22);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.14),
        inset 0 -14px 22px rgba(0,0,0,.28),
        0 14px 34px rgba(0,0,0,.45);
      animation: avisoIn .22s ease both;
      overflow:hidden;
      position:relative;
    }

    .aviso::before{
      content:"";
      position:absolute;
      inset:10px auto 10px 10px;
      width:6px;
      border-radius:999px;
      background:rgba(255,255,255,.15);
    }

    .aviso.alta{
      border:1px solid rgba(255,90,90,.9);
      background:linear-gradient(180deg, rgba(255,80,80,.28), rgba(12,30,50,.92));
    }
    .aviso.alta::before{ background:linear-gradient(180deg,#ff5a5a,#c0392b); }

    .aviso.media{
      border:1px solid rgba(255,179,71,.85);
      background:linear-gradient(180deg, rgba(255,180,70,.25), rgba(12,30,50,.92));
    }
    .aviso.media::before{ background:linear-gradient(180deg,#ffb347,#e67e22); }

    .aviso.baixa{
      border:1px solid rgba(77,166,255,.85);
      background:linear-gradient(180deg, rgba(100,170,255,.25), rgba(12,30,50,.92));
    }
    .aviso.baixa::before{ background:linear-gradient(180deg,#6fb6ff,#2980b9); }

    .aviso .t{
      margin:0;
      font-weight:950;
      letter-spacing:.2px;
      color:#fff;
      text-shadow:0 1px 2px rgba(0,0,0,.6);
      line-height:1.10;
      white-space:normal;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    .aviso .d{
      margin:0;
      color:#e0ecff;
      line-height:1.24;
      overflow:hidden;
      white-space:normal;
      overflow-wrap:anywhere;
      word-break:break-word;
      flex:1 1 auto;
      min-height:0;
    }

    .metaLine{
      margin-top:auto;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      color:rgba(234,242,255,.92);
      font-size: 11px;
      font-weight:900;
      line-height: 1.15;
    }

    .metaItem{ display:inline-flex; align-items:center; gap:6px; opacity:.95; }
    .metaItem b{ font-weight:950; color:#fff; }
    .metaSep{ opacity:.35; font-weight:900; }

    .prioBadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      font-weight:950;
      letter-spacing:.4px;
      text-transform:uppercase;
      font-size: 10px;
      line-height:1;
      border:1px solid rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.08));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.35),
        inset 0 -2px 6px rgba(0,0,0,.35),
        0 6px 14px rgba(0,0,0,.35);
    }
    .prioBadge.alta{
      border-color: rgba(255,90,90,.80);
      background: linear-gradient(180deg, rgba(255,120,120,.50), rgba(160,0,0,.35));
    }
    .prioBadge.media{
      border-color: rgba(255,179,71,.75);
      background: linear-gradient(180deg, rgba(255,210,120,.55), rgba(160,90,0,.35));
    }
    .prioBadge.baixa{
      border-color: rgba(120,190,255,.70);
      background: linear-gradient(180deg, rgba(160,210,255,.55), rgba(0,80,160,.32));
    }

    .fade-out{ opacity:0; transition: opacity .14s ease; }
    .fade-in { opacity:1; transition: opacity .14s ease; }

    .videoWrap{
      width:100%;
      height:100%;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border-radius:14px;
      position:relative;
      flex:1 1 auto;
      min-height:0;
    }

    .videoBg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      filter: blur(18px) saturate(1.08);
      transform: scale(1.12);
      opacity:.55;
      background:#000;
    }

    .videoMain{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:contain;
      background:transparent;
    }

    video::-webkit-media-controls{ display:none !important; }
    video::-webkit-media-controls-panel{ display:none !important; }
    video::-webkit-media-controls-enclosure{ display:none !important; }

    .newsBox{
      flex:0 0 auto;
      background: var(--news-bg);
      border: 1px solid var(--news-border);
      box-shadow: var(--news-shadow);
      border-radius: 18px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .newsHead{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background:rgba(12,35,56,.35);
      flex:0 0 auto;
    }

    .newsTitle{ font-weight:950; color:rgba(234,242,255,.95); }
    #newsPill{ display:none !important; }

    #newsBody{
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height:0;
      flex:1 1 auto;
      overflow:hidden;
    }

    .newsItem{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      padding: 10px 10px 9px;
      overflow:hidden;
    }

    .newsItem .h{
      font-family: var(--font-soft);
      font-weight: 820;
      font-size: clamp(11px, 1.25dvh, 15px);
      line-height: 1.18;
      letter-spacing: .12px;
      color: rgba(234,242,255,.95);
      margin: 0;
      display:block;
      white-space:normal;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    .newsSourceLine{
      margin-top: 6px;
      font-size: 11px;
      color: rgba(234,242,255,.72);
      font-weight: 900;
      text-align:left;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .ticker{
      flex:0 0 auto;
      width:100%;
      padding:10px 12px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(8,28,46,.60);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      display:flex;
      flex-direction:column;
      gap:6px;
      margin:0;
    }

    .tickerLine1{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      min-width:0;
      flex-wrap:nowrap;
    }

    .tickerIcon{
      font-size:clamp(22px, 3.1vw, 28px);
      opacity:.95;
      flex:0 0 auto;
      white-space:nowrap;
    }

    #dataBiblica{
      font-weight:950;
      white-space:nowrap;
      color:rgba(234,242,255,.95);
      font-size: calc(16px * var(--ui2));
      flex:0 0 auto;
    }

    #ref{
      color:rgba(234,242,255,.88);
      font-weight:850;
      font-size: clamp(12px, 1.05vw, 16px);
      flex: 1 1 auto;
      min-width: 0;
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
      line-height: 1.22;
      text-align:center;
      margin:0 10px;
    }

    .wxInline{
      flex:0 0 auto;
      width:auto;
      margin-left:auto;
      display:flex;
      flex-direction:row;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      font-size: clamp(11px, 0.95vw, 14px);
    }

    .wxInline .wxL1{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight: 950;
      color: rgba(234,242,255,.92);
      line-height: 1.15;
    }

    .wxInline .wxL2{
      font-weight: 900;
      color: rgba(234,242,255,.78);
      line-height: 1.15;
    }

    .wxInline .wxL2::before{
      content:" ‚Ä¢ ";
      opacity:.65;
      font-weight:900;
      margin-right:2px;
    }

    .wxMiniSvg{
      display:inline-flex;
      width: 18px;
      height: 18px;
      align-items:center;
      justify-content:center;
      transform: translateY(1px);
    }
    .wxMiniSvg svg{
      width: 18px;
      height: 18px;
      display:block;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }

    /* ============================================================
       ‚úÖ REGRAS MOBILE: SOMENTE se (isMobileUA E N√ÉO TV)
       ============================================================ */

    /* MOBILE continua igual: volta a ser coluna/rolagem (somente quando n√£o √© TV) */
    @media (max-width: 980px){
      html.isMobileUA:not(.isTV) .main{
        display:flex !important;
        flex-direction:column !important;
      }
    }

    /* ‚úÖ MOBILE: s√≥ aplica se N√ÉO for TV */
    @media (max-width: 980px){
      html.isMobileUA:not(.isTV){
        --ui: clamp(1, calc(100vmin / 900), 2.10);
        --ui2: clamp(1, calc(100vmin / 850), 2.70);
        --tv-safe-bottom: 0px;
      }

      html.isMobileUA:not(.isTV), html.isMobileUA:not(.isTV) body{
        height:auto !important;
        min-height:100svh !important;
        overflow:auto !important;
        -webkit-overflow-scrolling: touch;
      }

      html.isMobileUA:not(.isTV) body{ padding:0 !important; }

      html.isMobileUA:not(.isTV) .wrap{
        min-height:100svh !important;
        height:auto !important;
        overflow:visible !important;
        padding:
          calc(14px + var(--sat))
          calc(14px + var(--sar))
          calc(14px + var(--sab))
          calc(14px + var(--sal));
      }

      html.isMobileUA:not(.isTV) .container{
        min-height:auto !important;
        height:auto !important;
        overflow:visible !important;
        gap:10px;
      }

      html.isMobileUA:not(.isTV) .topbar{ flex-wrap:wrap; justify-content:center; text-align:center; }
      html.isMobileUA:not(.isTV) .brand{ width:100%; align-items:center; text-align:center; }
      html.isMobileUA:not(.isTV) .subMobileLine{ display:flex; width:100%; }

      html.isMobileUA:not(.isTV) .sectionBar{ justify-content:space-between; }

      html.isMobileUA:not(.isTV) .quadTop{
        display:flex;
        flex-direction:column;
        height:auto;
        gap:10px;
      }

      html.isMobileUA:not(.isTV) .tileBody{ padding:12px; }

      /* ticker no mobile sem sticky */
      html.isMobileUA:not(.isTV) .ticker{
        position:relative !important;
        bottom:auto !important;
        z-index:10;
        margin:0;
        padding-bottom:max(12px, env(safe-area-inset-bottom));
      }

      /* ticker 2 linhas */
      html.isMobileUA:not(.isTV) .tickerLine1{
        flex-wrap:wrap !important;
        justify-content:space-between;
        row-gap:6px;
      }
      html.isMobileUA:not(.isTV) .tickerIcon{ order:1; }
      html.isMobileUA:not(.isTV) #dataBiblica{ order:2; }

      html.isMobileUA:not(.isTV) #ref{
        order:3;
        flex: 1 1 100% !important;
        min-width: 0 !important;
        margin:0 !important;
        text-align:left !important;
        white-space:normal !important;
        overflow:visible !important;
        text-overflow:unset !important;
        overflow-wrap:anywhere;
        word-break:break-word;
      }

      html.isMobileUA:not(.isTV) #wxInline{
        order:4;
        width:100% !important;
        justify-content:flex-end !important;
        margin-left:0 !important;
      }

      /* mant√©m clima/√≠cone do topo no celular */
      html.isMobileUA:not(.isTV) .rightInfo{
        display:flex !important;
        position:absolute;
        top: 12px;
        right: 12px;
        gap: 0;
        align-items:center;
        justify-content:flex-end;
        z-index: 5;
      }
      html.isMobileUA:not(.isTV) .rightInfo .badge[title="Status do painel"]{ display:none !important; }
      html.isMobileUA:not(.isTV) #clock{ display:none !important; }
      html.isMobileUA:not(.isTV) #btnInstalarApp{ display:none !important; }
      html.isMobileUA:not(.isTV) .rightInfo .badge[title="Hora e Clima"]{
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        gap: 0 !important;
      }
      html.isMobileUA:not(.isTV) #wxIconTop{ width:56px; height:56px; transform:none !important; }
      html.isMobileUA:not(.isTV) #wxIconTop svg{ width:56px; height:56px; }

      /* ‚úÖ MOBILE: garantir altura do v√≠deo (publicidade) */
      html.isMobileUA:not(.isTV) #slot4{
        display:block !important;
        padding:12px !important;
        min-height: 220px;
      }

      html.isMobileUA:not(.isTV) #slot4 .videoWrap{
        width:100% !important;
        aspect-ratio: 16 / 9;
        height:auto !important;
        min-height: 220px;
        position:relative;
      }

      @media (max-width: 420px){
        html.isMobileUA:not(.isTV) #slot4{ min-height: 200px; }
        html.isMobileUA:not(.isTV) #slot4 .videoWrap{ min-height: 200px; }
      }
    }

    /* ‚úÖ FOR√áA 2x2 EM TV MESMO SE @media disparar por zoom */
    @media (max-width: 980px){
      html.isTV .quadTop{
        display:grid !important;
        grid-template-columns: 1fr 1fr !important;
        grid-template-rows: 1fr 1fr !important;
        height:100% !important;
      }
      html.isTV, html.isTV body{ overflow:hidden !important; height:100dvh !important; min-height:100dvh !important; }
      html.isTV .wrap{ height:100dvh !important; min-height:100dvh !important; overflow:hidden !important; }
      html.isTV .container{ height:100% !important; overflow:hidden !important; }
      html.isTV .main{ overflow:hidden !important; }
    }

    @media (min-width: 981px) and (max-width: 1100px){
      .tickerLine1{ flex-wrap:wrap; justify-content:center; }
      #ref{ flex:1 1 100%; margin:0; }
      .wxInline{ width:100%; justify-content:center; margin-left:0; }
      .wxInline .wxL2::before{ content:""; }
    }

    @media (min-width: 981px) and (max-height: 720px){
      :root{ --tv-safe-bottom: 44px; }
    }

    /* TV: escala e padding safe */
    html.isTV{
      --ui:  clamp(1, calc(100dvh / 980), 1.70);
      --ui2: clamp(1, calc(100dvh / 920), 2.05);
      --tv-safe-bottom: 44px;
    }

    html.isTV .wrap{
      height:100dvh !important;
      min-height:100dvh !important;
      padding:
        calc(10px + var(--sat))
        calc(10px + var(--sar))
        calc(max(12px, var(--tv-safe-bottom)) + var(--sab))
        calc(10px + var(--sal)) !important;
    }

    /* navega√ß√£o an√∫ncios */
    .adNav{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width:30px;
      height:30px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(0,0,0,.28);
      color:rgba(255,255,255,.92);
      font-size:14px;
      cursor:pointer;
      z-index:6;
      opacity:.35;
      transition: opacity .15s ease, transform .15s ease, filter .15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
    }
    .adNav:hover{ opacity:.85; filter:brightness(1.06); }
    .adNav:active{ transform: translateY(-50%) scale(.96); }
    .adPrev{ left:8px; }
    .adNext{ right:8px; }
    @media (max-width: 980px){
      .adNav{ width:28px; height:28px; font-size:13px; opacity:.28; }
    }

    /* garante que o v√≠deo apare√ßa com altura e o texto fique embaixo */
    #slot4{ display:flex; flex-direction:column; gap:10px; }
    #slot4 .videoWrap{
      width:100%;
      aspect-ratio: 16 / 9;
      min-height: 240px;
      border-radius:14px;
      overflow:hidden;
      position:relative;
      background:#000;
    }
    .adBelow{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(8,28,46,.55);
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
    }
    .adBelowText{
      font-weight:950;
      text-align:center;
      color:rgba(234,242,255,.96);
      font-size: clamp(14px, 1.25vw, 20px);
      line-height:1.18;
      white-space:normal;
      overflow:visible;
      text-overflow:unset;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

/* ‚úÖ TV: trava 100% sem scroll (BrowseHere/SEMP) */
html.isTV, html.isTV body{
  height:100dvh !important;
  width:100vw !important;
  overflow:hidden !important;
}

html.isTV body{
  position: fixed !important;
  inset: 0 !important;
}

html.isTV .wrap{
  position: fixed !important;
  inset: 0 !important;
  overflow:hidden !important;
}

/* ‚úÖ mesmo que o @media (max-width:980px) dispare por zoom, mant√©m 2x2 */
@media (max-width: 980px){
  html.isTV .main{ 
    display:block !important;
  }
  html.isTV .quadTop{
    display:grid !important;
    grid-template-columns: 1fr 1fr !important;
    grid-template-rows: 1fr 1fr !important;
  }
}

/* ===== ALERTA URGENTE ===== */
.urgentBox{
  border-radius:18px;
  border:2px solid rgba(255,255,255,.25);
  background: linear-gradient(180deg, rgba(255,0,0,.92), rgba(140,0,0,.95));
  color:#fff;
  padding:18px;
  box-shadow: 0 18px 44px rgba(0,0,0,.55);
}

.urgentTitle{
  font-weight: 950;
  text-transform: uppercase;
  font-size: clamp(26px, 3vw, 48px);
  line-height: 1.1;
}

.urgentMsg{
  margin-top: 12px;
  font-weight: 900;
  font-size: clamp(22px, 2.8vw, 42px);
  line-height: 1.15;
}

.urgentBlink{
  animation: urgentBlink 1s steps(1) infinite;
}

@keyframes urgentBlink{
  0%,49% { filter: brightness(1.1); }
  50%,100% { filter: brightness(.75); }
}


/* Quando alerta urgente estiver ativo, some com as mensagens no Brasil */
html.urgentOn #newsBox{ display:none !important; }
html.urgentOn .newsBox{ display:none !important; }

/* ============================
   ALERTA URGENTE (substitui Mensagens no Brasil)
   ============================ */
.alertBox{
  flex:0 0 auto;
  border-radius:18px;
  border:2px solid rgba(255,255,255,.22);
  background: linear-gradient(180deg, rgba(180,0,0,.95), rgba(120,0,0,.92));
  box-shadow: 0 18px 40px rgba(0,0,0,.55);
  overflow:hidden;
  display:none; /* aparece s√≥ quando ativar */
}

.alertHead{
  padding:12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  border-bottom:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.18);
}

.alertTitle{
  font-weight:950;
  letter-spacing:.8px;
  text-transform:uppercase;
  color:#fff;
  font-size: clamp(18px, 2.2vw, 30px);
  line-height:1.1;
}

.alertBody{
  padding:14px 16px 16px;
}

.alertMsg{
  margin:0;
  color:#fff;
  font-weight:950;
  font-size: clamp(20px, 3.2vw, 48px);
  line-height:1.08;
  overflow-wrap:anywhere;
  word-break:break-word;
  text-shadow: 0 2px 14px rgba(0,0,0,.45);
}

@keyframes alertBlink{
  0%,100%{ filter:brightness(1); }
  50%{ filter:brightness(1.25); }
}
.alertBox.blink{
  animation: alertBlink .9s ease-in-out infinite;
}

/* ‚úÖ T√≠tulo gigante, caixa alta e negrito */
.topbar .brand .title{
  font-weight: 1000;
  text-transform: uppercase;
  letter-spacing: .8px;
  line-height: 1.05;

  /* ocupa o espa√ßo e cresce na tela cheia */
  font-size: clamp(34px, 4.2vw, 78px);

  /* evita quebrar layout; se precisar, corta com ‚Ä¶ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ‚úÖ ‚ÄúPainel informativo‚Äù na direita, abaixo dos badges */
.subRight{
  margin-top: 6px;
  font-weight: 1000;
  opacity: .92;
  text-align: right;

  font-size: clamp(14px, 1.25vw, 22px);
}

/* ‚úÖ garante que a coluna do t√≠tulo ganhe o m√°ximo poss√≠vel */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 14px;
}

.topbar .brand{
  flex: 1 1 auto;
  min-width: 0;
}

.topbar .rightInfo{
  flex: 0 0 auto;
  display:flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

/* =====================================================
   PATCH DESKTOP ‚Äî N√ÉO AFETA CELULAR
   ===================================================== */
@media (min-width: 900px){

  /* Topbar continua igual no mobile */
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
  }

  /* Deixa a √°rea do t√≠tulo ocupar o m√°ximo poss√≠vel */
  .topbar .brand{
    flex:1 1 auto;
    min-width:0;
  }

  /* T√çTULO GRANDE ‚Äî DESKTOP APENAS */
  .topbar .brand .title{
    font-weight:1000;
    text-transform:uppercase;
    letter-spacing:.8px;
    line-height:1.05;

    /* cresce conforme a tela */
    font-size:clamp(36px, 4.2vw, 78px);

    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  /* Painel informativo √† direita, abaixo dos badges */
  .topbar .rightInfo .subRight{
    margin-top:6px;
    font-weight:1000;
    opacity:.92;
    text-align:right;
    font-size:clamp(14px, 1.25vw, 22px);
  }

  /* Coluna direita organizada */
  .topbar .rightInfo{
    flex:0 0 auto;
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
  }
}
/* =================== FIM PATCH =================== */

/* DESKTOP: caixa alta e grande */
@media (min-width: 900px){
  #titulo{
    text-transform: uppercase;
    font-weight: 1000;
    letter-spacing: .8px;
    line-height: 1.05;
    font-size: clamp(36px, 4.2vw, 78px);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* MOBILE: garante que n√£o muda (fica como era) */
@media (max-width: 899px){
  #titulo{
    text-transform: none;
  }
}

    
    
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <div class="topbar">
        <div class="brand">
          <div class="title" id="titulo">Comunica S√≠ndico - Cond√¥minos</div>
         
          <div class="subMobileLine" id="subMobileLine">
            <span id="statusJsonMini">Carregando...</span>
            <span class="sep">¬∫</span>
            <span id="clockMini">--:--</span>
          </div>
        </div>

        <div class="rightInfo">
          <div class="badge" title="Status do painel">
            <span class="dot" id="dotOnline"></span>
            <span id="statusJson">Carregando...</span>
          </div>

          <div class="badge" title="Hora e Clima">
            <span id="wxIconTop" aria-label="Clima" role="img"></span>
            <span id="clock">--:--</span>
          </div>

         <!-- ‚úÖ Painel informativo ao lado direito, abaixo de Atualizado + Hora -->
          <div class="subRight" id="subtitulo">Painel informativo</div>
        
          <button id="btnInstalarApp" class="btnInstall" style="display:none">‚¨áÔ∏è Instalar App</button>
        </div>
      </div>

      <div id="updateBanner" class="updateBanner" style="display:none">‚¨áÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶</div>

      <div class="main">

        <div class="sectionBar">
          <div class="sectionTitle">Avisos</div>
          <div class="pill" id="refPill" title="Clique para atualizar">Atualizar</div>
        </div>

        <div class="quadTop fade-in" id="avisosPane">
          <div class="panel tile"><div class="tileBody" id="slot1"></div></div>
          <div class="panel tile"><div class="tileBody" id="slot2"></div></div>
          <div class="panel tile"><div class="tileBody" id="slot3"></div></div>

          <div class="panel tile">
            <div class="tileBody" id="slot4">

              <div class="videoWrap">
                <button class="adNav adPrev" type="button" onclick="adPrevBtn()" aria-label="Anterior">‚èÆ</button>
                <button class="adNav adNext" type="button" onclick="adNextBtn()" aria-label="Pr√≥ximo">‚è≠</button>

                <video id="adVideoBg" class="videoBg" autoplay muted playsinline webkit-playsinline loop
                  disablepictureinpicture controlslist="nofullscreen noremoteplayback nodownload"></video>
                <video id="adVideo" class="videoMain" autoplay muted playsinline webkit-playsinline
                  disablepictureinpicture controlslist="nofullscreen noremoteplayback nodownload"></video>
              </div>

              <div class="adBelow">
                <div class="adBelowText" id="adLabelBelow">‚Äî</div>
              </div>

            </div>
          </div>
        </div>

<div class="urgentBox" id="urgentBox" style="display:none">
  <div class="urgentTitle" id="urgentTitle">ALERTA URGENTE</div>
  <div class="urgentMsg" id="urgentMsg">‚Äî</div>
</div>
     
        <!-- ALERTA URGENTE (ocupa o lugar das mensagens quando ativado) -->
<div class="alertBox" id="alertBox" style="display:none">
  <div class="alertHead">
    <div class="alertTitle" id="alertTitle">ALERTA URGENTE</div>
    <div class="pill" id="alertOffBtn" title="Desligar alerta">Desligar</div>
  </div>
  <div class="alertBody">
    <p class="alertMsg" id="alertMsg">‚Äî</p>
  </div>
</div>
        
        <div class="newsBox" id="newsBox" style="display:none">
          <div class="newsHead">
            <div class="newsTitle" id="cityTitle">üì∞ Mensagens no Brasil</div>
            <div class="pill" id="newsPill">‚Äî</div>
          </div>
          <div id="newsBody"></div>
        </div>
       </div>

      <div class="ticker">
        <div class="tickerLine1">
          <span class="tickerIcon">üìñ</span>
          <span id="dataBiblica">‚Äî</span>
          <span id="ref">‚Äî</span>

          <div class="wxInline" id="wxInline">
            <div class="wxL1">
              <span id="wxIconInline" class="wxMiniSvg" aria-hidden="true"></span>
              <span id="wxCityTemp">‚Äî</span>
            </div>
            <div class="wxL2" id="wxWindRain">‚Äî</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚úÖ APP SCRIPT -->
  <script>
    let deferredPrompt = null;

    function mostrarBotaoInstalar(show){
      const b = document.getElementById("btnInstalarApp");
      if (b) b.style.display = show ? "inline-flex" : "none";
    }
    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      mostrarBotaoInstalar(true);
    });
    window.addEventListener("appinstalled", ()=>{
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    });
    async function instalarApp(){
      if(!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    }

    function prioridadeClass(p){
      const x = String(p || "").toLowerCase();
      if (x === "alta") return "alta";
      if (x === "m√©dia" || x === "media") return "media";
      return "baixa";
    }
    function safeText(v){ return (v == null ? "" : String(v)); }
    function setText(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }
    function pad2(n){ return String(n).padStart(2,"0"); }
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }


    function applyUrgentAlert(cfg){
  const alertBox = document.getElementById("alertBox");
  const newsBox  = document.getElementById("newsBox");
  const tEl = document.getElementById("alertTitle");
  const mEl = document.getElementById("alertMsg");

  const a = cfg?.alertaUrgente || {};
  const on = !!a.ativar;

  if(!alertBox || !newsBox) return;

  if(on){
    // mostra alerta
    if(tEl) tEl.textContent = String(a.titulo || "ALERTA URGENTE");
    if(mEl) mEl.textContent = String(a.mensagem || "‚Äî");

    alertBox.style.display = "block";
    newsBox.style.display = "none";

    alertBox.classList.toggle("blink", !!a.piscar);
  }else{
    alertBox.style.display = "none";
    alertBox.classList.remove("blink");
    // newsBox volta (ser√° reativado por carregarMensagensCidade)
  }
}



    
    // ‚úÖ "mobile" s√≥ se N√ÉO for TV (n√£o cai no layout mobile por zoom)
    function isMobile(){
      return window.matchMedia("(max-width: 980px)").matches &&
             document.documentElement.classList.contains("isMobileUA") &&
             !document.documentElement.classList.contains("isTV");
    }

    function refreshPage(){ location.reload(); }

    function tickClock(){
      const d = new Date();
      const hhmm = `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
      setText("clock", hhmm);
      setText("clockMini", hhmm);
    }
    tickClock();
    setInterval(tickClock, 1000);

    (function bindUI(){
      const btn = document.getElementById("btnInstalarApp");
      if(btn) btn.onclick = instalarApp;
      const refPill = document.getElementById("refPill");
      if(refPill) refPill.onclick = refreshPage;

      const alertOffBtn = document.getElementById("alertOffBtn");
if(alertOffBtn) alertOffBtn.onclick = ()=>{
  // desligar LOCAL (somente nesta tela, n√£o altera o data.json)
  try{
    const cfg = window.__lastDataForTopbar || {};
    if(cfg.alertaUrgente) cfg.alertaUrgente.ativar = false;
    applyUrgentAlert(cfg);
    carregarMensagensCidade();
  }catch(e){}
};
      })();

    function parseBRDateTime(v){
      const s = String(v ?? "").trim();
      if(!s) return null;
      const m = s.match(/^(\d{2})\/(\d{2})\/(\d{2}|\d{4})\s*(?:-\s*)?(\d{2}):(\d{2})$/);
      if(m){
        const dd = Number(m[1]);
        const mm = Number(m[2]);
        let yyyy = Number(m[3]);
        if(String(m[3]).length === 2) yyyy = 2000 + yyyy;
        const HH = Number(m[4]);
        const MM = Number(m[5]);
        const d = new Date(yyyy, mm-1, dd, HH, MM, 0, 0);
        if(!isNaN(d.getTime())) return d;
      }
      const d2 = new Date(s);
      if(!isNaN(d2.getTime())) return d2;
      return null;
    }

    function formatDT_BR(v){
      if(!v) return "";
      const d = parseBRDateTime(v);
      if(!d) return String(v);
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const aa = String(d.getFullYear()).slice(-2);
      const HH = pad2(d.getHours());
      const MM = pad2(d.getMinutes());
      return `${dd}/${mm}/${aa} - ${HH}:${MM}`;
    }

    function isBigScreenMode(){
      const tv = document.documentElement.classList.contains("isTV");
      const fs = !!document.fullscreenElement;
      return tv || fs;
    }

    function fitTextToBox(el, opts = {}){
      if(!el) return;
      const { maxPx = 36, minPx = 12, step = 1 } = opts;
      el.style.fontSize = maxPx + "px";
      el.style.overflow = "hidden";
      el.offsetHeight;
      let cur = maxPx;
      while(cur > minPx && (el.scrollHeight > el.clientHeight + 1 || el.scrollWidth > el.clientWidth + 1)){
        cur -= step;
        el.style.fontSize = cur + "px";
      }
      return cur;
    }

    function autoFitAvisosUniform(){
      const cards = Array.from(document.querySelectorAll(".aviso"));
      if(!cards.length) return;

      const big = isBigScreenMode();

      const tMax = big ? 44 : 30;
      const dMax = big ? 36 : 26;
      const tMin = big ? 16 : 14;
      const dMin = big ? 14 : 12;

      const results = cards.map(card=>{
        const t = card.querySelector(".t");
        const d = card.querySelector(".d");
        const tSize = t ? fitTextToBox(t, { maxPx: tMax, minPx: tMin, step: 1 }) : tMin;
        const dSize = d ? fitTextToBox(d, { maxPx: dMax, minPx: dMin, step: 1 }) : dMin;
        return { tSize, dSize };
      });

      let tUniform = Math.min(...results.map(r=>r.tSize));
      let dUniform = Math.min(...results.map(r=>r.dSize));

      cards.forEach(card=>{
        const t = card.querySelector(".t");
        const d = card.querySelector(".d");
        if(t) t.style.fontSize = tUniform + "px";
        if(d) d.style.fontSize = dUniform + "px";
      });

      const tryGrow = (delta)=>{
        const tTry = tUniform + delta;
        const dTry = dUniform + delta;
        if(tTry > tMax || dTry > dMax) return false;

        let ok = true;
        cards.forEach(card=>{
          const t = card.querySelector(".t");
          const d = card.querySelector(".d");
          if(t) t.style.fontSize = tTry + "px";
          if(d) d.style.fontSize = dTry + "px";
        });

        cards.forEach(card=>{
          const t = card.querySelector(".t");
          const d = card.querySelector(".d");
          if((t && (t.scrollHeight > t.clientHeight + 1 || t.scrollWidth > t.clientWidth + 1)) ||
             (d && (d.scrollHeight > d.clientHeight + 1 || d.scrollWidth > d.clientWidth + 1))){
            ok = false;
          }
        });

        if(!ok){
          cards.forEach(card=>{
            const t = card.querySelector(".t");
            const d = card.querySelector(".d");
            if(t) t.style.fontSize = tUniform + "px";
            if(d) d.style.fontSize = dUniform + "px";
          });
          return false;
        }

        tUniform = tTry;
        dUniform = dTry;
        return true;
      };

      for(let i=0;i<20;i++){
        if(!tryGrow(1)) break;
      }
    }

    function buildAvisoEl(a){
      const el = document.createElement("div");
      el.className = `aviso ${prioridadeClass(a.prioridade)}`;

      const titulo = safeText(a.titulo || "Aviso");
      const desc = safeText(a.descricao || "");
      const tipo = safeText(a.tipo || "");
      const local = safeText(a.local || "");
      const ini = formatDT_BR(a.inicio || "");
      const fim = formatDT_BR(a.fim || "");

      const itens = [];
      if(local) itens.push(`<span class="metaItem">üìç <b>${escapeHtml(local)}</b></span>`);
      if(tipo)  itens.push(`<span class="metaItem">üè∑Ô∏è <b>${escapeHtml(tipo)}</b></span>`);
      const pr = safeText(a.prioridade || "Baixa");
      itens.push(`<span class="metaItem">‚ö° <span class="prioBadge ${prioridadeClass(pr)}">${escapeHtml(pr)}</span></span>`);
      if(ini || fim) itens.push(`<span class="metaItem">üóìÔ∏è <b>${escapeHtml(ini)}${fim ? " ‚Üí " + escapeHtml(fim) : ""}</b></span>`);

      el.innerHTML = `
        <p class="t">${escapeHtml(titulo)}</p>
        ${desc ? `<p class="d">${escapeHtml(desc)}</p>` : `<p class="d">‚Äî</p>`}
        <div class="metaLine">${itens.join(`<span class="metaSep">‚Ä¢</span>`)}</div>
      `;
      return el;
    }

    function buildMiniAdEl(offset){
      const wrap = document.createElement("div");
      wrap.className = "videoWrap";
      wrap.dataset.miniad = "1";
      wrap.dataset.offset = String(offset || 0);

      const overlay = document.createElement("div");
      overlay.className = "adOverlay";
      overlay.innerHTML = `<div class="adText">‚Äî</div>`;

      const vbg = document.createElement("video");
      vbg.className = "videoBg";
      vbg.autoplay = true;
      vbg.muted = true;
      vbg.playsInline = true;
      vbg.loop = true;
      vbg.setAttribute("webkit-playsinline", "");
      vbg.setAttribute("disablepictureinpicture", "");
      vbg.setAttribute("controlslist", "nofullscreen noremoteplayback nodownload");

      const v = document.createElement("video");
      v.className = "videoMain";
      v.autoplay = true;
      v.muted = true;
      v.playsInline = true;
      v.setAttribute("webkit-playsinline", "");
      v.setAttribute("disablepictureinpicture", "");
      v.setAttribute("controlslist", "nofullscreen noremoteplayback nodownload");

      wrap.appendChild(overlay);
      wrap.appendChild(vbg);
      wrap.appendChild(v);
      return wrap;
    }

    let ROT_TIMER = null;

    function renderAvisos(data){
      const pane = document.getElementById("avisosPane");
      const s1 = document.getElementById("slot1");
      const s2 = document.getElementById("slot2");
      const s3 = document.getElementById("slot3");
      if(!pane || !s1 || !s2 || !s3) return;

      if (ROT_TIMER) { clearInterval(ROT_TIMER); ROT_TIMER = null; }

      const avisosAllRaw = Array.isArray(data.avisos) ? data.avisos.slice() : [];

// ‚úÖ compat Admin: {titulo, descricao, nivel, ativo}
// ‚úÖ compat antigo: {titulo, descricao, prioridade}
const avisosAll = avisosAllRaw
  .filter(a => a && (a.ativo !== false))
  .map(a => {
    const nivel = String(a.nivel ?? a.prioridade ?? "baixa").toLowerCase();
    const prioridade =
      nivel.includes("alt") ? "alta" :
      nivel.includes("med") ? "media" : "baixa";

    return {
      ...a,
      titulo: String(a.titulo ?? "Aviso"),
      descricao: String(a.descricao ?? a.msg ?? ""),
      prioridade
    };
  });

      const rank = { alta:3, media:2, baixa:1 };
      avisosAll.sort((a,b)=>{
        const pa = prioridadeClass(a?.prioridade);
        const pb = prioridadeClass(b?.prioridade);
        return (rank[pb]||0) - (rank[pa]||0);
      });

      if(!avisosAll.length){
        s1.innerHTML = ""; s2.innerHTML = ""; s3.innerHTML = "";
        s1.appendChild(buildMiniAdEl(1));
        s2.appendChild(buildMiniAdEl(2));
        s3.appendChild(buildMiniAdEl(3));
        return;
      }

      if (!Number.isFinite(window.__rotStart)) window.__rotStart = 0;

      function paint(){
        const total = avisosAll.length;
        const start = window.__rotStart % total;

        s1.innerHTML = "";
        s2.innerHTML = "";
        s3.innerHTML = "";

        const a0 = avisosAll[start];
        const a1 = avisosAll[(start + 1) % total];
        const a2 = avisosAll[(start + 2) % total];

        if(a0) s1.appendChild(buildAvisoEl(a0));
        if(a1) s2.appendChild(buildAvisoEl(a1));
        if(a2) s3.appendChild(buildAvisoEl(a2));

        requestAnimationFrame(()=>{
          try{ autoFitAvisosUniform(); }catch(e){}
        });
      }

      paint();

      ROT_TIMER = setInterval(()=>{
        window.__rotStart = (window.__rotStart + 1) % avisosAll.length;
        paint();
      }, Math.max(3000, Number(data?.rotacao?.intervaloSeg || 8) * 1000));
    }

    function hojeKeyMMDD() {
      const d = new Date();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${mm}-${dd}`;
    }

    async function carregarVersiculo(data) {
      if (!data?.temaDoDia || data.temaDoDia.modo !== "biblico-anual") return;
      try {
        const res = await fetch("versiculos.json?ts=" + Date.now(), { cache: "no-store" });
        const v = await res.json();
        const key = hojeKeyMMDD();
        const texto = v?.versos?.[key];
        setText("dataBiblica", v?.cabecalho || "");
        setText("ref", texto ? texto : (v?.titulo ? v.titulo : "Verso n√£o encontrado"));
      } catch (e) {}
    }

    function wxSvgCloud(){
      return `
      <svg class="wxsvg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g class="cloud">
          <path d="M22 44h22a12 12 0 0 0 0-24 15 15 0 0 0-29-3A11 11 0 0 0 22 44z"
            fill="rgba(235,245,255,.92)"/>
          <path d="M22 44h22a12 12 0 0 0 0-24 15 15 0 0 0-29-3A11 11 0 0 0 22 44z"
            fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
        </g>
      </svg>`;
    }

    function wxSetIcon(elId, code){
      const el = document.getElementById(elId);
      if(!el) return;
      el.innerHTML = wxSvgCloud();
      el.setAttribute("role","img");
      el.setAttribute("aria-label","Clima");
    }

    async function carregarClima(data){
      const c = data?.clima;
      try {
        if (!c?.latitude || !c?.longitude) throw new Error("Sem coordenadas");
        const url =
          "https://api.open-meteo.com/v1/forecast" +
          `?latitude=${encodeURIComponent(c.latitude)}` +
          `&longitude=${encodeURIComponent(c.longitude)}` +
          `&current=temperature_2m,precipitation,weather_code,wind_speed_10m` +
          `&timezone=${encodeURIComponent(c.timezone || "America/Sao_Paulo")}`;

        const res = await fetch(url, { cache: "no-store" });
        const j = await res.json();
        const cur = j?.current;
        if (!cur) throw new Error("Sem current");

        const t = Math.round(cur.temperature_2m);
        const w = Math.round(cur.wind_speed_10m);
        const p = cur.precipitation;

        wxSetIcon("wxIconTop", cur.weather_code);
        wxSetIcon("wxIconInline", cur.weather_code);

        setText("wxCityTemp", `${c.cidade || "‚Äî"} ${t}¬∞C`);
        setText("wxWindRain", `Vento ${w} km/h ‚Ä¢ Chuva ${p} mm`);
      } catch (e) {
        const cloud = wxSvgCloud();
        const top = document.getElementById("wxIconTop");
        const mini = document.getElementById("wxIconInline");
        if (top) top.innerHTML = cloud;
        if (mini) mini.innerHTML = cloud;
        setText("wxCityTemp", `${data?.clima?.cidade || "‚Äî"} (offline)`);
        setText("wxWindRain", `Vento ‚Äî km/h ‚Ä¢ Chuva ‚Äî mm`);
      }
    }

    const AD_STATE_KEY = "CS_AD_STATE_V2";
    const AD_SHUFFLE_KEY = "CS_AD_SHUFFLE_V2";

    function adLoadState(){ try { return JSON.parse(sessionStorage.getItem(AD_STATE_KEY) || "{}"); } catch(e){ return {}; } }
    function adSaveState(st){ try { sessionStorage.setItem(AD_STATE_KEY, JSON.stringify(st || {})); } catch(e){} }

    function adFilterMp4(list){
      const arr = Array.isArray(list) ? list : [];
      return arr.filter(x=>{
        const src = String(x?.arquivo || "").trim();
        return /\.mp4(\?.*)?$/i.test(src);
      });
    }

    function adShuffleCopy(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function adGetShuffledList(originalList){
      try{
        const raw = sessionStorage.getItem(AD_SHUFFLE_KEY);
        if(raw){
          const saved = JSON.parse(raw);
          const filesNow = originalList.map(x => String(x?.arquivo||""));
          const filesSaved = Array.isArray(saved?.files) ? saved.files : [];
          if(filesSaved.join("|") === filesNow.join("|") && Array.isArray(saved?.order)){
            const order = saved.order;
            const map = new Map(originalList.map(x => [String(x?.arquivo||""), x]));
            const rebuilt = order.map(f => map.get(f)).filter(Boolean);
            filesNow.forEach(f=>{ if(!order.includes(f)) rebuilt.push(map.get(f)); });
            return rebuilt;
          }
        }
      }catch(e){}
      const shuffled = adShuffleCopy(originalList);
      try{
        const order = shuffled.map(x => String(x?.arquivo||""));
        const files = originalList.map(x => String(x?.arquivo||""));
        sessionStorage.setItem(AD_SHUFFLE_KEY, JSON.stringify({ files, order }));
      }catch(e){}
      return shuffled;
    }

    function setVideoSrcPair(vMain, vBg, src){
      if(!vMain || !vBg) return;
      const curMain = (vMain.currentSrc || vMain.src || "").split("?")[0];
      const next = (src || "").split("?")[0];
      if(curMain !== next){
        try{ vMain.pause(); }catch(e){}
        try{ vBg.pause(); }catch(e){}
        vMain.removeAttribute("src");
        vBg.removeAttribute("src");
        try{ vMain.load(); vBg.load(); }catch(e){}
        vBg.src = src;
        vMain.src = src;
        try{ vBg.load(); vMain.load(); }catch(e){}
      }
      const playSafe = (v)=>{
        try{ const p = v.play(); if(p && p.catch) p.catch(()=>{}); }catch(e){}
      };
      vBg.onloadedmetadata = () => playSafe(vBg);
      vMain.onloadedmetadata = () => playSafe(vMain);
      playSafe(vBg);
      playSafe(vMain);
    }

    function playMiniAds(list, baseIdx){
      const minis = Array.from(document.querySelectorAll('[data-miniad="1"]'));
      if(!minis.length || !list.length) return;

      minis.forEach(w=>{
        const off = Number(w.dataset.offset || 0) || 0;
        const i = (baseIdx + off) % list.length;
        const item = list[i];
        const src = String(item?.arquivo || "");
        const sep = src.includes("?") ? "&" : "?";
        const finalSrc = src ? (src + sep + "ts=" + Date.now()) : "";
        const vBg = w.querySelector("video.videoBg");
        const vMain = w.querySelector("video.videoMain");
        setVideoSrcPair(vMain, vBg, finalSrc);

        const label = w.querySelector(".adOverlay .adText");
        if(label) label.textContent = String(item?.anunciante || "‚Äî");
      });
    }

    function adPlayByState(videos){
      const adVideo = document.getElementById("adVideo");
      const adVideoBg = document.getElementById("adVideoBg");
      const adBelow = document.getElementById("adLabelBelow");
      if(!adVideo || !adVideoBg) return;

      let list = Array.isArray(videos) ? videos : [];
      if(!list.length) return;

      try{
        const cfg = (window.__lastDataForTopbar || {});
        const pub = cfg?.publicidade || {};
        if (pub.shuffle) list = adGetShuffledList(list);
      }catch(e){}

      const st = adLoadState();
      let idx = Number.isFinite(st.idx) ? st.idx : 0;
      if(idx < 0) idx = 0;
      if(idx >= list.length) idx = 0;

      const item = list[idx];
      const src = String(item?.arquivo || "");
      const sep = src.includes("?") ? "&" : "?";
      const finalSrc = src ? (src + sep + "ts=" + Date.now()) : "";

      const txt = String(item?.anunciante || "‚Äî");
      if(adBelow) adBelow.textContent = txt;

      setVideoSrcPair(adVideo, adVideoBg, finalSrc);

      st.idx = idx;
      st.paused = false;
      st.t = 0;
      adSaveState(st);

      playMiniAds(list, idx);
    }

    function adNext(videos){
      const list = videos;
      if(!list.length) return;

      const st = adLoadState();
      let idx = Number.isFinite(st.idx) ? st.idx : 0;
      idx++;
      if(idx >= list.length) idx = 0;

      st.idx = idx;
      st.t = 0;
      st.paused = false;
      adSaveState(st);

      adPlayByState(list);
    }

    function adNextBtn(){
      try{
        const data = window.__lastDataForTopbar || {};
        const pub = data.publicidade || {};
        const videosMp4 = adFilterMp4(pub.videos);
        if(!videosMp4.length) return;
        adNext(videosMp4);
      }catch(e){}
    }

    function adPrevBtn(){
      try{
        const data = window.__lastDataForTopbar || {};
        const pub = data.publicidade || {};
        const videosMp4 = adFilterMp4(pub.videos);
        if(!videosMp4.length) return;

        const st = adLoadState();
        let idx = Number.isFinite(st.idx) ? st.idx : 0;
        idx = idx - 1;
        if(idx < 0) idx = videosMp4.length - 1;

        st.idx = idx;
        st.t = 0;
        st.paused = false;
        adSaveState(st);

        adPlayByState(videosMp4);
      }catch(e){}
    }

    function iniciarPublicidade(data){
      const pub = data?.publicidade;
      if (!pub?.ativar) return;

      const videosMp4 = adFilterMp4(pub?.videos);
      if (!videosMp4.length) return;

      const v = document.getElementById("adVideo");
      if(!v) return;

      v.onended = () => adNext(videosMp4);
      v.onerror = () => setTimeout(()=>adNext(videosMp4), 1200);

      adPlayByState(videosMp4);
    }

    function decodeHtmlEntities_(s){
      const t = document.createElement("textarea");
      t.innerHTML = String(s ?? "");
      return t.value;
    }
    function normalizeText_(s){
      return decodeHtmlEntities_(s).replace(/\u00a0/g, " ").replace(/\s+/g, " ").trim();
    }

    function getNewsMaxItems(){
      const h = window.innerHeight || 900;
      if (isMobile()) return 8;
      if (h < 720) return 3;
      if (h < 880) return 4;
      return 6;
    }

    async function carregarMensagensCidade(){
      const newsBox  = document.getElementById("newsBox");
      const newsBody = document.getElementById("newsBody");
      if(!newsBox || !newsBody) return;

      try{
        const res = await fetch("./mensagens_cidade.json?ts=" + Date.now(), { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);

        const j = await res.json();
        const items = Array.isArray(j.items) ? j.items : [];
        const maxItems = getNewsMaxItems();

        if(!items.length){
          newsBody.innerHTML = `
            <div class="newsItem"><p class="h">Sem mensagens no momento</p></div>
            <div class="newsSourceLine">Fonte: indispon√≠vel</div>
          `;
          newsBox.style.display = "flex";
          return;
        }

        let html = "";
        const fontes = new Set();

        items.slice(0, maxItems).forEach(x=>{
          let titulo = normalizeText_(x.titulo || x.title || "Mensagem");
          titulo = titulo.replace(/\s+‚Äì\s+Google\s+News$/i, "").trim();
          titulo = titulo.replace(/\s+\|\s+.*$/i, "").trim();
          if(!titulo) titulo = "Mensagem";
          if(x.fonte) fontes.add(normalizeText_(x.fonte));
          html += `<div class="newsItem"><p class="h">${escapeHtml(titulo)}</p></div>`;
        });

        let fonteLine = "";
        if(fontes.size){
          const joined = Array.from(fontes).join(" ‚Ä¢ ");
          fonteLine = `<div class="newsSourceLine">Fonte: ${escapeHtml(joined)}</div>`;
        }

        newsBody.innerHTML = html + fonteLine;
        newsBox.style.display = "flex";
      }catch(e){
        newsBody.innerHTML = `
          <div class="newsItem"><p class="h">Mensagens indispon√≠veis</p></div>
          <div class="newsSourceLine">Fonte: news.google.com (offline)</div>
        `;
        newsBox.style.display = "flex";
      }

      // se alerta estiver ativo, n√£o mostra Mensagens no Brasil
try{
  const cfg = window.__lastDataForTopbar || {};
  if(cfg?.alertaUrgente?.ativar){
    if(newsBox) newsBox.style.display = "none";
    return;
  }
}catch(e){}
    }

    
    function aplicarImagemTopbar(data){
      // Se Admin definiu imagem do cabe√ßalho, N√ÉO sobrescreve.
      try{
        const cab = data?.publicidade?.cabecalhoImagem || {};
        if(cab.ativar && String(cab.url||"").trim()) return;
      }catch(e){}
      const cidade = String(data?.clima?.cidade || "").toLowerCase();
      const isTubarao = cidade.includes("tubar√£o") || cidade.includes("tubarao");

      const h = new Date().getHours();
      const estaNoite = (h >= 18 || h <= 4);

      const isMob = isMobile();
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      const longest = Math.max(vw, vh);

      const is2560 = longest >= 2400;
      const is1920 = longest >= 1700;

      let img = "./img/tubarao01.jpg";

      if(isTubarao){
        if(estaNoite){
          if(isMob)       img = "./img/tubarao_noite.jpg";
          else if(is2560) img = "./img/tubarao_noite-2560p.jpg";
          else if(is1920) img = "./img/tubarao_noite-1920p.jpg";
          else            img = "./img/tubarao_noite-1280p.jpg";
        }else{
          if(isMob)       img = "./img/tubarao01.jpg";
          else if(is2560) img = "./img/tubarao01-2560p.jpg";
          else if(is1920) img = "./img/tubarao01-1920p.jpg";
          else            img = "./img/tubarao01-1280p.jpg";
        }
      }

      const test = new Image();
      test.decoding = "async";
      test.onload = () => {
        document.documentElement.style.setProperty("--topbar-bg", `url('${img}')`);
      };
      test.onerror = () => {
        document.documentElement.style.setProperty("--topbar-bg", `url('./img/tubarao01.jpg')`);
      };
      test.src = img + "?v=1";
    }

    function setCityTitleFromConfig(cfg){
      const el = document.getElementById("cityTitle");
      if(!el) return;
      const t = cfg?.publicidade?.cidadeTitulo || cfg?.cidadeTitulo || "üì∞ Mensagens no Brasil";
      el.textContent = String(t);
    }


function applyUrgentBox(data){
  const urgent = data?.alertaUrgente || {};
  const box = document.getElementById("urgentBox");
  if(!box) return;

  const msg = String(urgent.mensagem || "").trim();
  const on = !!urgent.ativar && msg.length > 0;

  // ‚úÖ classe global que derruba a news via CSS
  document.documentElement.classList.toggle("urgentOn", on);

  if(on){
    const tEl = document.getElementById("urgentTitle");
    const mEl = document.getElementById("urgentMsg");
    if(tEl) tEl.textContent = urgent.titulo || "ALERTA URGENTE";
    if(mEl) mEl.textContent = msg;

    box.style.display = "block";
    box.classList.toggle("urgentBlink", !!urgent.piscar);
  }else{
    box.style.display = "none";
    box.classList.remove("urgentBlink");
  }
}

function applyHeaderCityImage(data){
  const cfg = data?.publicidade?.cabecalhoImagem || {};
  const on  = !!cfg.ativar;
  const url = String(cfg.url || "").trim();

  if(on && url){
    const finalUrl = url + (url.includes("?") ? "&" : "?") + "ts=" + Date.now();
    document.documentElement.style.setProperty("--topbar-bg", `url('${finalUrl}')`);
    return true; // Admin mandou
  }
  return false;
}

    
    async function loadAll(){
      const status = document.getElementById("statusJson");
      const statusMini = document.getElementById("statusJsonMini");
      const dot = document.getElementById("dotOnline");

      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const ct = (res.headers.get("content-type") || "").toLowerCase();
        if (!ct.includes("application/json")) throw new Error("Resposta n√£o-JSON: " + ct);

        const data = await res.json();
        window.__lastDataForTopbar = data;
      
        const adminBgOn = applyHeaderCityImage(data);
        
        if (status) status.textContent = "Atualizado";
        if (statusMini) statusMini.textContent = "Atualizado";
        if (dot) dot.style.background = "#44d07a";

        setCityTitleFromConfig(data);

        renderAvisos(data);
        applyUrgentBox(data);
        
        if (data.temaDoDia && data.temaDoDia.modo === "biblico-anual") {
          setText("dataBiblica", "üìñ");
          setText("ref", "Carregando‚Ä¶");
        } else {
          setText("dataBiblica", "üìå Avisos");
          setText("ref", safeText(data.referencia || "Atualizado"));
        }

        await carregarVersiculo(data);
        await carregarClima(data);

        await carregarMensagensCidade();
        if(!adminBgOn){
          aplicarImagemTopbar(data);
        }

        iniciarPublicidade(data);

        requestAnimationFrame(()=>{
          if(!isMobile()) autoFitAvisosUniform();
        });

        return data;

      } catch(e){
        if (status) status.textContent = "Offline";
        if (statusMini) statusMini.textContent = "Offline";
        if (dot) dot.style.background = "#ff5a5a";
        return null;
      }
    }

    loadAll();

    setInterval(() => {
      try{ if(window.__lastDataForTopbar) aplicarImagemTopbar(window.__lastDataForTopbar); }catch(e){}
    }, 60000);

    let __rzT = null;
    window.addEventListener("resize", ()=>{
      clearTimeout(__rzT);
      __rzT = setTimeout(()=>{
        if(!isMobile()){
          try{ autoFitAvisosUniform(); }catch(e){}
        }
        try{ carregarMensagensCidade(); }catch(e){}
        try{ if(window.__lastDataForTopbar) aplicarImagemTopbar(window.__lastDataForTopbar); }catch(e){}
      }, 160);
    }, {passive:true});

    document.addEventListener("fullscreenchange", ()=>{
      try{
        if(!isMobile()) autoFitAvisosUniform();
      }catch(e){}
    });
  </script>

  <!-- ‚úÖ FUNDO (atalhos teclado) -->
  <script>
    const fundos = {
      azul:    ["#061726", "#0b1f33"],
      verde:   ["#0b2e1a", "#134d2c"],
      amarelo: ["#3a3300", "#665c00"],
      laranja: ["#3a1f00", "#663300"],
      branco:  ["#f2f2f2", "#dcdcdc"],
      preto:   ["#000000", "#111111"]
    };

    function setFundo(cor){
      if(!fundos[cor]) return;
      document.documentElement.style.setProperty("--bg1", fundos[cor][0]);
      document.documentElement.style.setProperty("--bg2", fundos[cor][1]);
      try { localStorage.setItem("fundoEscolhido", cor); } catch(e){}
    }

    function fundoAleatorio(){
      const cores = Object.keys(fundos);
      const cor = cores[Math.floor(Math.random() * cores.length)];
      setFundo(cor);
      return cor;
    }

    (function carregarFundoSalvo(){
      try{
        const salvo = localStorage.getItem("fundoEscolhido");
        if(salvo && fundos[salvo]) setFundo(salvo);
      }catch(e){}
    })();

    window.addEventListener("keydown", (e)=>{
      const k = String(e.key || "").toLowerCase();
      if (k === "1") setFundo("azul");
      else if (k === "2") setFundo("verde");
      else if (k === "3") setFundo("amarelo");
      else if (k === "4") setFundo("laranja");
      else if (k === "5") setFundo("branco");
      else if (k === "6") setFundo("preto");
      else if (k === "r") fundoAleatorio();
    });

    setInterval(fundoAleatorio, 300000);
  </script>

  <!-- ‚úÖ SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });
          try { await reg.update(); } catch(e){}
          reg.addEventListener("updatefound", () => {
            const nw = reg.installing;
            if(!nw) return;
            nw.addEventListener("statechange", () => {
              if (nw.state === "installed" && navigator.serviceWorker.controller) {
                nw.postMessage("SKIP_WAITING");
              }
            });
          });
        } catch(e){}
      });

      navigator.serviceWorker.addEventListener("controllerchange", () => {
        const banner = document.getElementById("updateBanner");
        if(banner) banner.style.display = "block";
        setTimeout(()=>window.location.reload(), 1200);
      });
    }
  </script>

</body>
</html>
