<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="canonical" href="./">
  <script>
  (function () {
    try {
      const u = new URL(location.href);
      if (u.search) { u.search = ""; location.replace(u.toString()); return; }
      if (u.pathname.endsWith("/index.html")) {
        u.pathname = u.pathname.replace(/\/index\.html$/i, "/");
        location.replace(u.toString()); return;
      }
    } catch (e) {}
  })();
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Comunica S√≠ndico - Cond√¥minos</title>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#0b223a">

  <style>
    :root{
      --bg1:#061726;
      --bg2:#0b1f33;
      --line:rgba(255,255,255,.10);
      --txt:#eaf2ff;
      --muted:rgba(234,242,255,.75);
      --shadow: 0 14px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --sat: env(safe-area-inset-top);
      --sar: env(safe-area-inset-right);
      --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left);

      /* ‚úÖ DESKTOP/TV: base por ALTURA (dvh) para n√£o mudar quando abre meia-tela vs tela cheia */
      --ui:  clamp(1, calc(100dvh / 980), 1.70);
      --ui2: clamp(1, calc(100dvh / 920), 2.05);

      /* ‚ÄúSobra‚Äù de seguran√ßa para TVs (overscan) */
      --tv-safe-bottom: 18px;

      --topbar-bg: none;
      --topbar-img-opacity: .92;

      --font-ui: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      --font-soft: ui-rounded, "SF Pro Rounded", "Segoe UI", var(--font-ui);

      --news-bg: rgba(8, 24, 40, .62);
      --news-border: rgba(255,255,255,.12);
      --news-shadow: 0 18px 40px rgba(0,0,0,.38);
      --news-title: rgba(234,242,255,.96);
    }

    *{box-sizing:border-box}
    html,body{height:100%;width:100%}

    body{
      margin:0;
      font-family:"Segoe UI",Arial,sans-serif;
      color:var(--txt);
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(16,56,91,0.55), transparent 60%),
        radial-gradient(900px 600px at 85% 15%, rgba(11,52,84,0.55), transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      overflow:hidden;
      overscroll-behavior:none;
      touch-action:manipulation;
      min-height:100dvh;
      height:100dvh;
      width:100%;
      padding:0; /* ‚úÖ evita empurrar rodap√© */
    }

    .wrap{
      height:100dvh;
      min-height:100dvh;
      width:100%;
      padding:
        calc(12px + var(--sat))
        calc(12px + var(--sar))
        calc(max(12px, var(--tv-safe-bottom)) + var(--sab))
        calc(12px + var(--sal));
      display:block;
    }

    .container{
      width:100%;
      height:100%;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:12px;
      max-width:none;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:16px 18px;
      background:rgba(8,28,46,.60);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      flex:0 0 auto;
      width:100%;
      position:relative;
      overflow:hidden;
    }

  .topbar::before{
  content:"";
  position:absolute;
  inset:0;

  /* imagem em alta resolu√ß√£o */
  background-image: var(--topbar-bg);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  /* remove zoom que causa blur */
  transform: none !important;

  /* melhora nitidez em telas grandes */
  image-rendering: auto;
  will-change: transform;

  opacity: var(--topbar-img-opacity);
  pointer-events:none;
}

    .topbar::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(90deg, rgba(5,20,35,.55), rgba(5,20,35,.25)),
        radial-gradient(900px 420px at 20% 20%, rgba(0,0,0,.12), transparent 65%);
      pointer-events:none;
    }

    .topbar > *{ position:relative; z-index:1; }

    .brand{display:flex;flex-direction:column;gap:3px;min-width:0;flex:1 1 auto;}

    #titulo{
      margin:0;
      font-size: clamp(32px, 3.2vw, 54px);
      font-weight: 950;
      letter-spacing:.2px;
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
      overflow-wrap:anywhere;
      word-break:break-word;
      line-height: 1.08;
    }

    #subtitulo{
      margin:0;
      font-size: calc(12.5px * var(--ui));
      color:var(--muted);
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .subMobileLine{
      display:none;
      margin-top:2px;
      font-size: calc(12.5px * var(--ui));
      color: rgba(234,242,255,.84);
      font-weight: 850;
      gap: 8px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      text-align:center;
    }
    .subMobileLine .sep{ opacity:.55; font-weight:900; }

    .condoCenter{
      flex:1 1 auto;
      min-width:0;
      text-align:center;
      font-weight:950;
      letter-spacing:.2px;
      color:rgba(234,242,255,.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      padding:0 8px;
    }

    .rightInfo{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      flex:0 0 auto;
    }

    .badge{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.55);
      color:var(--muted);
      font-weight:900;
      font-size: calc(12px * var(--ui));
      white-space:nowrap;
    }

    .dot{width:10px;height:10px;border-radius:50%;background:#ff5a5a}
    #statusJson{font-weight:950;color:rgba(234,242,255,.92)}

    .btnInstall{
      border:1px solid rgba(255,255,255,.18);
      background:rgba(12,35,56,.55);
      color:rgba(234,242,255,.92);
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      font-size: calc(14px * var(--ui));
      white-space:nowrap;
    }

    /* ===== WX TOP ICON (container) ===== */
    #wxIconTop{
      display:inline-flex;
      width: 46px;
      height: 46px;
      line-height: 1;
      align-items:center;
      justify-content:center;
      transform: translateY(1px);
    }
    #wxIconTop svg{
      width: 46px;
      height: 46px;
      display:block;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,.45));
    }

    .updateBanner{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(120,190,255,.35);
      background:rgba(7,20,34,.28);
      box-shadow:var(--shadow);
      font-weight:900;
      flex:0 0 auto;
      width:100%;
    }

    .main{
      flex:1 1 auto;
      min-height:0;
      display:grid;
      grid-template-columns: 1.20fr .80fr;
      gap:12px;
      width:100%;
      height:100%;
    }

    .panel{
      background:linear-gradient(180deg, rgba(15,43,69,.92), rgba(11,33,55,.92));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      min-height:0;
      overflow:hidden;
    }

    .panelHead{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(7,20,34,.20);
      flex:0 0 auto;
    }

    .panelTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      letter-spacing:.6px;
      color:rgba(234,242,255,.95);
      text-transform:uppercase;
      font-size: calc(18px * var(--ui2));
    }

    .pill{
      font-size: calc(12px * var(--ui));
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(12,35,56,.35);
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
      user-select:none;
      cursor:pointer;
    }
    .pill:hover{ filter:brightness(1.08); }
    .pill:active{ transform:scale(.98); }

    @keyframes avisoIn{
      from{ opacity:0; transform: translateY(10px) scale(.99); }
      to  { opacity:1; transform: translateY(0) scale(1); }
    }
    @keyframes glowPulseRed{
      0%,100%{ box-shadow: 0 0 14px rgba(255,80,80,.35), inset 0 1px 0 rgba(255,255,255,.15); }
      50%    { box-shadow: 0 0 20px rgba(255,80,80,.55), inset 0 1px 0 rgba(255,255,255,.18); }
    }
    #avisos.fade-out{ opacity:0; transition: opacity .22s ease; }
    #avisos.fade-in { opacity:1; transition: opacity .22s ease; }

    .avisos{
      padding:14px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow:hidden; /* ‚úÖ evita overflow que empurra o rodap√© */
    }

    .aviso{
      padding:16px;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(20,60,95,.88), rgba(10,30,50,.88));
      display:flex;
      flex-direction:column;
      gap:10px;
      border:1px solid rgba(140,200,255,.22);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.14),
        inset 0 -14px 22px rgba(0,0,0,.28),
        0 14px 34px rgba(0,0,0,.55);
      transition: transform .22s ease, box-shadow .22s ease, filter .22s ease;
      animation: avisoIn .28s ease both;
      will-change: transform, opacity;
      position:relative;
      padding-left:18px;
      height:auto;
      min-height:auto;
      overflow:hidden;
    }

    .aviso:hover{
      transform: translateY(-2px);
      filter: saturate(1.05);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.16),
        0 10px 28px rgba(0,0,0,.62);
    }

    .aviso::before{
      content:"";
      position:absolute;
      inset:10px auto 10px 10px;
      width:6px;
      border-radius:999px;
      background:rgba(255,255,255,.15);
    }

    .aviso.alta{
      border:1px solid rgba(255,90,90,.9);
      background:linear-gradient(180deg, rgba(255,80,80,.28), rgba(12,30,50,.92));
      animation: avisoIn .28s ease both, glowPulseRed 2.2s ease-in-out infinite;
    }
    .aviso.alta::before{ background:linear-gradient(180deg,#ff5a5a,#c0392b); }

    .aviso.media{
      border:1px solid rgba(255,179,71,.85);
      background:linear-gradient(180deg, rgba(255,180,70,.25), rgba(12,30,50,.92));
    }
    .aviso.media::before{ background:linear-gradient(180deg,#ffb347,#e67e22); }

    .aviso.baixa{
      border:1px solid rgba(77,166,255,.85);
      background:linear-gradient(180deg, rgba(100,170,255,.25), rgba(12,30,50,.92));
    }
    .aviso.baixa::before{ background:linear-gradient(180deg,#6fb6ff,#2980b9); }

    .aviso .t{
      margin:0;
      font-weight:950;
      font-size: calc(22px * var(--ui2));
      letter-spacing:.3px;
      color:#fff;
      text-shadow:0 1px 2px rgba(0,0,0,.6);
      line-height:1.15;
      display:block;
      white-space:normal;
      overflow:visible;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    .aviso.alta  .t::before{ content:"‚ö†Ô∏è"; }
    .aviso.media .t::before{ content:"üî∂"; }
    .aviso.baixa .t::before{ content:"‚ÑπÔ∏è"; }

    .aviso .d{
      margin:0;
      color:#e0ecff;
      line-height:1.30;
      font-size:clamp(16px, 1.9vw, 22px);
      display:block;
      white-space:normal;
      overflow:hidden;
      overflow-wrap:anywhere;
      word-break:break-word;
    }

    .metaLine{
      margin-top:auto;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      color:rgba(234,242,255,.92);
      font-size: 0.42em;
      font-weight:900;
      line-height: 1.15;
    }
    @media (max-width: 520px){ .metaLine{ font-size: 0.45em; } }
    @media (min-width: 1200px){ .metaLine{ font-size: 0.45em; } }

    .metaItem{ display:inline-flex; align-items:center; gap:8px; opacity:.95; }
    .metaItem b{ font-weight:950; color:#fff; }
    .metaSep{ opacity:.35; font-weight:900; }

    .prioBadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:6px 10px;
      border-radius:999px;
      font-weight:950;
      letter-spacing:.4px;
      text-transform:uppercase;
      font-size: calc(10px * var(--ui));
      line-height:1;
      border:1px solid rgba(255,255,255,.22);
      background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.08));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.35),
        inset 0 -2px 6px rgba(0,0,0,.35),
        0 6px 14px rgba(0,0,0,.35);
    }
    .prioBadge.alta{
      border-color: rgba(255,90,90,.80);
      background: linear-gradient(180deg, rgba(255,120,120,.50), rgba(160,0,0,.35));
      text-shadow: 0 1px 0 rgba(0,0,0,.55);
    }
    .prioBadge.media{
      border-color: rgba(255,179,71,.75);
      background: linear-gradient(180deg, rgba(255,210,120,.55), rgba(160,90,0,.35));
      text-shadow: 0 1px 0 rgba(0,0,0,.50);
    }
    .prioBadge.baixa{
      border-color: rgba(120,190,255,.70);
      background: linear-gradient(180deg, rgba(160,210,255,.55), rgba(0,80,160,.32));
      text-shadow: 0 1px 0 rgba(0,0,0,.45);
    }

    .adBody{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      overflow:hidden; /* ‚úÖ remove scroll geral do bloco */
    }
    .adCard{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(7,20,34,.18);
      border-radius:14px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
      flex:0 0 auto;
    }
    .adLabel{
      padding:10px 12px;
      font-weight:950;
      border-bottom:1px solid rgba(255,255,255,.10);
      color:rgba(234,242,255,.92);
      background:rgba(12,35,56,.35);
    }

    .videoWrap{
      width:100%;
      aspect-ratio:16/9;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
      max-height: 38vh;
      overflow:hidden;
      border-radius: 12px;
      position:relative;
    }

    video{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
      object-position:center;
      background:#000;
    }
    video.fit-contain{ object-fit:contain; }

   /* ===== CONTROLES DO V√çDEO (PC/TV + CELULAR) ‚Äî laterais igual celular ===== */
.tvVideoControls{
  position:absolute;
  left: 0;
  right: 0;
  top: 50%;
  bottom: auto;
  transform: translateY(-50%);
  display:flex;
  justify-content: space-between; /* ‚ü® esquerda | direita ‚ü© */
  align-items:center;
  z-index:50;
  user-select:none;

  /* deixa clic√°vel mas sem ‚Äúcaixa‚Äù escura */
  pointer-events:none;
  background: transparent;
  border: none;
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  box-shadow: none;

  padding: 0 10px;
  gap: 0;
  border-radius: 0;
}

    .tvBtn{
      min-width: 44px;
      height: 40px;
      padding: 0 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      color: rgba(255,255,255,.95);
      font-weight: 950;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.18),
        0 10px 18px rgba(0,0,0,.35);
      transition: transform .12s ease, filter .12s ease, border-color .12s ease;
    }
    .tvBtn:hover{ filter: brightness(1.08); border-color: rgba(255,255,255,.24); }
    .tvBtn:active{ transform: translateY(1px) scale(.98); }

   @media (max-width: 980px){
  #btnBack10, #btnFwd10{ display:none !important; }
  #btnPrevAd, #btnNextAd{ display:flex !important; }

  .tvBtn{
    pointer-events: auto;
    min-width: 34px;
    width: 34px;
    height: 34px;
    padding: 0;
    border-radius: 999px;
    font-size: 16px;
    line-height: 1;
    background: rgba(0,0,0,.28);
    border: 1px solid rgba(255,255,255,.22);
    box-shadow: 0 8px 18px rgba(0,0,0,.35);
  }

  #btnPrevAd, #btnNextAd{ width: 34px; min-width: 34px; }
}

    .ticker{
      flex:0 0 auto;
      width:100%;
      padding:10px 12px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(8,28,46,.60);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      display:flex;
      flex-direction:column;
      align-items:stretch;
      gap:6px;
      margin:0; /* ‚úÖ remove empurr√£o do rodap√© */
    }

    .tickerLine1{
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
      overflow:hidden;
      flex-wrap: wrap;
      justify-content:center;
      text-align:center;
    }

    .tickerIcon{
      font-size:clamp(22px, 3.1vw, 28px);
      opacity:.95;
      flex:0 0 auto;
    }

    #dataBiblica{
      font-weight:950;
      white-space:nowrap;
      color:rgba(234,242,255,.95);
      font-size: calc(16px * var(--ui2));
      flex:0 0 auto;
    }

  #ref{
  color:rgba(234,242,255,.88);
  font-weight:850;
  font-size: calc(16px * var(--ui2));
  flex: 1 1 auto;          /* ocupa o m√°ximo de espa√ßo */
  min-width: 0;
  white-space: normal;    /* permite quebrar linha se precisar */
  overflow: visible;      /* n√£o corta */
  text-overflow: unset;   /* remove os ... */
  line-height: 1.25;
  text-align:center;
}

   /* ===== RODAP√â CLIMA (2 LINHAS) ‚Äî S√ì MOBILE ===== */
@media (max-width: 980px){
  .wxInline{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:2px;
    margin-top: 6px;
    white-space: normal !important;
  }

  .wxInline .wxL1{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight: 950;
    color: rgba(234,242,255,.92);
    font-size: clamp(13px, 1.9vw, 18px);
    line-height: 1.15;
  }

  .wxInline .wxL2{
    font-weight: 900;
    color: rgba(234,242,255,.78);
    font-size: clamp(12px, 1.7vw, 16px);
    line-height: 1.15;
  }
}

    .wxMiniSvg{
      display:inline-flex;
      width: 18px;
      height: 18px;
      line-height: 1;
      align-items:center;
      justify-content:center;
      transform: translateY(1px);
    }
    .wxMiniSvg svg{
      width: 18px;
      height: 18px;
      display:block;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
    }

    /* ===== NEWS (SEM SCROLL) ===== */
    #newsBox{
      background: var(--news-bg);
      border: 1px solid var(--news-border);
      box-shadow: var(--news-shadow);
      border-radius: 18px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      min-height:0;
      flex: 1 1 auto; /* ‚úÖ ocupa o resto sem causar barra */
    }

    .newsHead{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background:rgba(12,35,56,.35);
      flex:0 0 auto;
    }

    .newsTitle{ font-weight:950; color:rgba(234,242,255,.92); }
    #newsPill{ display:none !important; }

    #newsBody{
      padding: 12px 14px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height:0;
      flex:1 1 auto;
      overflow:hidden; /* ‚úÖ sem barra */
      if (window.innerWidth >= 981) {
  requestAnimationFrame(() => {
    autoFitNews();
  });
}
    }

    @media (min-width: 981px){
  #newsBody{
    display:grid;
    grid-template-rows: repeat(4, minmax(0, 1fr)); /* 4 itens sempre cabem */
    gap:10px;
  }
  .newsItem{ min-height:0; overflow:hidden; }
}
    .newsItem{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      padding: 12px 12px 10px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .newsItem:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
    }
   .newsItem .h{
  font-family: var(--font-soft);
  font-weight: 750;
  font-size: clamp(12px, 1.55dvh, 18px); /* reduz automaticamente em telas menores */
  line-height: 1.18;
  letter-spacing: .15px;
  color: var(--news-title);
  margin: 0;

  display:block;              /* <- tira line-clamp */
  overflow:visible;           /* <- sem cortar */
  white-space:normal;         /* <- quebra linha */
  overflow-wrap:anywhere;
  word-break:break-word;
}

    .newsFooter{
      margin-top: 8px;
      font-size: 11px;
      color: rgba(255,255,255,.65);
      font-weight: 900;
      text-align:left;
    }
    .newsFooterItem{
      font-size: 11px;
      color: rgba(255,255,255,.55);
      margin-left: 6px;
      text-align:left;
    }

   /* ===== AVISOS DESKTOP: altura pelo conte√∫do (m√°x 3 avisos via JS) ===== */
@media (min-width: 981px){
  #avisos{
    padding:14px;
    min-height:0;
    display:flex;              /* <- volta para flex (n√£o for√ßa 3 alturas iguais) */
    flex-direction:column;
    gap:12px;
    overflow:hidden;           /* sem scroll geral */
  }

  #avisos .aviso{
    flex:0 0 auto;             /* <- N√ÉO estica */
    height:auto;               /* <- cresce conforme conte√∫do */
    min-height:unset;
  }

  /* mant√©m a descri√ß√£o como est√° (sem mexer na fonte), s√≥ garante quebra boa */
  #avisos .aviso .d{
    white-space:normal;
    overflow-wrap:anywhere;
    word-break:break-word;
  }
}

    /* ===== MOBILE (MANTIDO) ===== */
    @media (max-width: 980px){
      :root{
        /* ‚úÖ MOBILE continua como estava (base em vmin) */
        --ui: clamp(1, calc(100vmin / 900), 2.10);
        --ui2: clamp(1, calc(100vmin / 850), 2.70);
        --tv-safe-bottom: 0px;
      }

      body{ overflow:auto; -webkit-overflow-scrolling: touch; padding:0; height:auto; min-height:100svh; }
      .wrap{ min-height:100svh; height:auto; padding: calc(14px + var(--sat)) calc(14px + var(--sar)) calc(14px + var(--sab)) calc(14px + var(--sal)); }
      .container{ min-height:auto; height:auto; }

      .topbar{ flex-wrap:wrap; justify-content:center; text-align:center; }
      .condoCenter{ display:none !important; }
      .brand{ width:100%; align-items:center; text-align:center; }
      .rightInfo{ display:none !important; }
      .subMobileLine{ display:flex; width:100%; }

      .main{ display:flex; flex-direction:column; }
      section.panel{ order:1; }
      #adBox{ order:2; min-height:0; }
      .panel{ min-height:auto; }

      .ticker{
        position:sticky;
        bottom:0;
        z-index:50;
        margin:0;
        padding-bottom: max(12px, env(safe-area-inset-bottom));
      }

      /* WX TOP premium no celular (flutuante topo-direito) */
      .rightInfo{
        display:flex !important;
        position:absolute;
        top: 12px;
        right: 12px;
        gap: 0;
        align-items:center;
        justify-content:flex-end;
        z-index: 5;
      }
      .rightInfo .badge[title="Status do painel"]{ display:none !important; }
      #clock{ display:none !important; }
      #btnInstalarApp{ display:none !important; }
      .rightInfo .badge[title="Hora e Clima"]{
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        gap: 0 !important;
      }
      #wxIconTop{ width:56px; height:56px; transform:none !important; }
      #wxIconTop svg{ width:56px; height:56px; }
    }

    /* ===== Anima√ß√µes WX SVG ===== */
    .wxsvg .sun-rays{ transform-origin: 32px 32px; animation: wx-rotate 6s linear infinite; }
    @keyframes wx-rotate{ from{ transform: rotate(0deg);} to{ transform: rotate(360deg);} }

    .wxsvg .sun-core{ animation: wx-pulse 2.4s ease-in-out infinite; transform-origin: 32px 32px; }
    @keyframes wx-pulse{ 0%,100%{ transform: scale(1);} 50%{ transform: scale(1.08);} }

    .wxsvg .cloud{ animation: wx-float 3.2s ease-in-out infinite; }
    @keyframes wx-float{ 0%,100%{ transform: translateX(0);} 50%{ transform: translateX(2.5px);} }

    .wxsvg .drops line{ animation: wx-rain 1.1s linear infinite; }
    .wxsvg .drops line:nth-child(2){ animation-delay:.15s; }
    .wxsvg .drops line:nth-child(3){ animation-delay:.30s; }
    @keyframes wx-rain{ 0%{ transform: translateY(0); opacity:.15;} 15%{opacity:1;} 100%{ transform: translateY(8px); opacity:.05;} }

    .wxsvg .bolt{ animation: wx-bolt 1.4s ease-in-out infinite; }
    @keyframes wx-bolt{ 0%,100%{ opacity:.35; transform: translateY(0);} 50%{ opacity:1; transform: translateY(1px);} }


/* =========================================================
   RODAP√â ‚Äî PC/TV: vers√≠culo completo + clima no fim √† direita
   (Celular mant√©m como est√°)
   ========================================================= */
@media (min-width: 981px){

  .tickerLine1{
    display:flex;
    align-items:center;
    justify-content:space-between; /* vers√≠culo no meio, clima vai pra direita */
    gap:12px;
    flex-wrap:nowrap;
    text-align:left;
  }

  .tickerIcon,
  #dataBiblica{
    flex:0 0 auto;
    white-space:nowrap;
  }

  /* Vers√≠culo: SEM "..." e com espa√ßo m√°ximo */
  #ref{
    flex:1 1 auto;
    min-width:0;
    margin:0 10px;
    white-space:normal;        /* permite quebrar */
    overflow:visible;          /* n√£o corta */
    text-overflow:unset;       /* remove ... */
    line-height:1.22;
    text-align:center;
    font-size: clamp(12px, 1.05vw, 16px);
  }

  /* Clima: preso no canto direito */
  .wxInline{
    flex:0 0 auto;
    width:auto;
    margin-left:auto;
    display:flex;
    flex-direction:row;
    align-items:center;
    gap:8px;
    white-space:nowrap;
    font-size: clamp(11px, 0.95vw, 14px);
  }

  /* separador entre L1 e L2 (s√≥ no desktop) */
  .wxInline .wxL2::before{
    content:" ‚Ä¢ ";
    opacity:.65;
    font-weight:900;
    margin-right:2px;
  }
}

/* Janela PC menor: se apertar, vira 2 linhas (sem estragar) */
@media (min-width: 981px) and (max-width: 1100px){
  .tickerLine1{ flex-wrap:wrap; justify-content:center; }
  #ref{ flex:1 1 100%; margin:0; }
  .wxInline{
    width:100%;
    justify-content:center;
    margin-left:0;
  }
  .wxInline .wxL2::before{ content:""; }
}
  
  
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <div class="topbar">
        <div class="brand">
          <div class="title" id="titulo">Comunica S√≠ndico - Cond√¥minos</div>
          <div class="sub" id="subtitulo">Painel Informativo</div>

          <div class="subMobileLine" id="subMobileLine">
            <span id="statusJsonMini">Carregando...</span>
            <span class="sep">¬∫</span>
            <span id="clockMini">--:--</span>
          </div>
        </div>

        <div class="condoCenter" id="condoCenter"></div>

        <div class="rightInfo">
          <div class="badge" title="Status do painel">
            <span class="dot" id="dotOnline"></span>
            <span id="statusJson">Carregando...</span>
          </div>

          <div class="badge" title="Hora e Clima">
            <span id="wxIconTop" aria-label="Clima" role="img"></span>
            <span id="clock">--:--</span>
          </div>

          <button id="btnInstalarApp" class="btnInstall" style="display:none">‚¨áÔ∏è Instalar App</button>
        </div>
      </div>

      <div id="updateBanner" class="updateBanner" style="display:none">‚¨áÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶</div>

      <div class="main">
        <section class="panel">
          <div class="panelHead">
            <div class="panelTitle">üîî Avisos Importantes</div>
            <div class="pill" id="refPill" title="Clique para atualizar">Atualizar</div>
          </div>
          <div class="avisos" id="avisos"></div>
        </section>

        <aside class="panel" id="adBox" style="display:none">
          <div class="panelHead">
            <div class="panelTitle">üì£ Publicidade</div>
            <div class="pill" id="adPill">‚Äî</div>
          </div>

          <div class="adBody">
            <div class="adCard" id="adCard">
              <div class="adLabel" id="adLabel">An√∫ncio</div>

              <div class="videoWrap">
                <video id="adVideo" autoplay muted playsinline></video>

                <div class="tvVideoControls" id="tvVideoControls" aria-hidden="true">
                  <button class="tvBtn" id="btnPrevAd" title="V√≠deo anterior" aria-label="V√≠deo anterior">‚ü®</button>
                  <button class="tvBtn" id="btnBack10" title="Voltar 10s" aria-label="Voltar 10 segundos">‚Ü∂10</button>
                  <button class="tvBtn" id="btnFwd10" title="Avan√ßar 10s" aria-label="Avan√ßar 10 segundos">10‚Ü∑</button>
                  <button class="tvBtn" id="btnNextAd" title="Pr√≥ximo v√≠deo" aria-label="Pr√≥ximo v√≠deo">‚ü©</button>
                </div>
              </div>
            </div>

            <div class="newsBox" id="newsBox" style="display:none">
              <div class="newsHead">
                <div class="newsTitle" id="cityTitle">üì∞ Mensagens no Brasil</div>
                <div class="pill" id="newsPill">‚Äî</div>
              </div>
              <div id="newsBody"></div>
            </div>

          </div>
        </aside>
      </div>

      <div class="ticker">
        <div class="tickerLine1">
          <span class="tickerIcon">üìñ</span>
          <span id="dataBiblica">‚Äî</span>
          <span id="ref">‚Äî</span>

          <div class="wxInline" id="wxInline">
            <div class="wxL1">
              <span id="wxIconInline" class="wxMiniSvg" aria-hidden="true"></span>
              <span id="wxCityTemp">‚Äî</span>
            </div>
            <div class="wxL2" id="wxWindRain">‚Äî</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* =========================================================
       PWA install
       ========================================================= */
    let deferredPrompt = null;
    function mostrarBotaoInstalar(show){
      const b = document.getElementById("btnInstalarApp");
      if (b) b.style.display = show ? "inline-flex" : "none";
    }
    window.addEventListener("beforeinstallprompt", (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      mostrarBotaoInstalar(true);
    });
    window.addEventListener("appinstalled", ()=>{
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    });
    async function instalarApp(){
      if(!deferredPrompt) return;
      await deferredPrompt.prompt();
      deferredPrompt = null;
      mostrarBotaoInstalar(false);
    }

    /* =========================================================
       Utils
       ========================================================= */
    function prioridadeClass(p){
      const x = String(p || "").toLowerCase();
      if (x === "alta") return "alta";
      if (x === "m√©dia" || x === "media") return "media";
      return "baixa";
    }
    function safeText(v){ return (v == null ? "" : String(v)); }
    function setText(id, v){ const el = document.getElementById(id); if(el) el.textContent = v; }
    function pad2(n){ return String(n).padStart(2,"0"); }
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }
    function isMobile(){ return window.matchMedia("(max-width: 980px)").matches; }
    function refreshPage(){ location.reload(); }

    function footerDateString(d){
      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const yyyy = d.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }

    function tickClock(){
      const d = new Date();
      const hhmm = `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
      setText("clock", hhmm);
      setText("clockMini", hhmm);
    }
    tickClock();
    setInterval(tickClock, 1000);

    (function bindUI(){
      const btn = document.getElementById("btnInstalarApp");
      if(btn) btn.onclick = instalarApp;
      const refPill = document.getElementById("refPill");
      if(refPill) refPill.onclick = refreshPage;
    })();

    /* =========================================================
       Avisos (3 por tela + ajuste autom√°tico desktop)
       ========================================================= */
    let ROT_TIMER = null;
    let ROT_STATE = { page: 0, totalPages: 1, paused: false };
    let DESC_CAP = null;

    function parseBRDateTime(v){
      const s = String(v ?? "").trim();
      if(!s) return null;

      const m = s.match(/^(\d{2})\/(\d{2})\/(\d{2}|\d{4})\s*(?:-\s*)?(\d{2}):(\d{2})$/);
      if(m){
        const dd = Number(m[1]);
        const mm = Number(m[2]);
        let yyyy = Number(m[3]);
        if(String(m[3]).length === 2) yyyy = 2000 + yyyy;
        const HH = Number(m[4]);
        const MM = Number(m[5]);
        const d = new Date(yyyy, mm-1, dd, HH, MM, 0, 0);
        if(!isNaN(d.getTime())) return d;
      }

      const d2 = new Date(s);
      if(!isNaN(d2.getTime())) return d2;
      return null;
    }

    function formatDT_BR(v){
      if(!v) return "";
      const d = parseBRDateTime(v);
      if(!d) return String(v);

      const dd = pad2(d.getDate());
      const mm = pad2(d.getMonth()+1);
      const aa = String(d.getFullYear()).slice(-2);
      const HH = pad2(d.getHours());
      const MM = pad2(d.getMinutes());
      return `${dd}/${mm}/${aa} - ${HH}:${MM}`;
    }

    function fitDescInCard(card){
      const desc = card.querySelector(".d");
      if(!desc) return 18;

      const h = Math.max(240, card.clientHeight || 0);
      const cap = Math.max(22, Math.floor(h * 0.22));   // ‚úÖ tenta grande
      const MIN = 18;
      const MAX = Math.max(MIN, cap);

      let lo = MIN, hi = MAX, best = MIN;
      while(lo <= hi){
        const mid = (lo + hi) >> 1;
        desc.style.setProperty("--desc-font", mid + "px");
        const ok = (desc.scrollHeight <= desc.clientHeight + 1);
        if(ok){ best = mid; lo = mid + 1; }
        else { hi = mid - 1; }
      }
      desc.style.setProperty("--desc-font", best + "px");
      return best;
    }

    function ajustarAvisosTelaCheia(pageIdx){
      if(isMobile()) return;
      const root = document.getElementById("avisos");
      if(!root) return;
      const cards = Array.from(root.querySelectorAll(".aviso"));
      if(!cards.length) return;

      if(pageIdx === 0 && DESC_CAP == null){
        const bests = cards.map(c => fitDescInCard(c));
        DESC_CAP = Math.min(...bests);
        cards.forEach(c => c.querySelector(".d")?.style.setProperty("--desc-font", DESC_CAP + "px"));
        return;
      }

      const cap = (DESC_CAP == null ? 22 : DESC_CAP);
      cards.forEach(c => c.querySelector(".d")?.style.setProperty("--desc-font", cap + "px"));
    }

// ==========================================================
// AUTO-FIT: reduz fonte at√© o texto caber no container
// ==========================================================
function fitTextToBox(el, opts = {}){
  if(!el) return;
  const {
    maxPx = 44,
    minPx = 12,
    step  = 1
  } = opts;

  // reseta para um valor ‚Äúalto‚Äù e desce at√© caber
  el.style.fontSize = maxPx + "px";

  // for√ßa reflow (garante medidas atualizadas)
  // eslint-disable-next-line no-unused-expressions
  el.offsetHeight;

  let cur = maxPx;
  // while: se estourar altura OU largura, reduz
  while(cur > minPx && (el.scrollHeight > el.clientHeight || el.scrollWidth > el.clientWidth)){
    cur -= step;
    el.style.fontSize = cur + "px";
  }
}

function autoFitAvisos(){
  // Ajusta t√≠tulo e descri√ß√£o de cada aviso
  document.querySelectorAll("#avisos .aviso").forEach(card => {
    const t = card.querySelector(".t");
    const d = card.querySelector(".d");

    // t√≠tulo: n√£o pode ficar gigante em janela menor
    fitTextToBox(t, { maxPx: 34, minPx: 14, step: 1 });

    // descri√ß√£o: este √© o principal
    fitTextToBox(d, { maxPx: 42, minPx: 14, step: 1 });
  });
}

function autoFitNews(){
  // Ajusta cada manchete do bloco de not√≠cias
  document.querySelectorAll("#newsBody .newsItem .h").forEach(h => {
    fitTextToBox(h, { maxPx: 20, minPx: 11, step: 1 });
  });
}
    
    function renderAvisos(data){
      const root = document.getElementById("avisos");
      if (!root) return;
      root.innerHTML = "";

      if (ROT_TIMER) { clearInterval(ROT_TIMER); ROT_TIMER = null; }
      DESC_CAP = null;

      const avisosAll = Array.isArray(data.avisos) ? data.avisos : [];
      const rot = data?.rotacao || {};
      const ativar = !!rot.ativar;

      const qtd = 3;
      const intervaloMs = Math.max(3, Number(rot.intervaloSeg || 12)) * 1000;

      if(!avisosAll.length){
        const div = document.createElement("div");
        div.className = "aviso baixa";
        div.innerHTML = `<p class="t">Sem avisos no momento</p><p class="d">${escapeHtml(safeText(data.fallback || "‚Äî"))}</p><div class="metaLine"></div>`;
        root.appendChild(div);
        root.style.setProperty("--rows", "1");
        ROT_STATE = { page: 0, totalPages: 1, paused: false };
        return;
        // ‚úÖ AUTO-AJUSTE (desktop/janela pequena)
if (window.innerWidth >= 981) {
  // pequena espera pra garantir layout pronto
  requestAnimationFrame(() => {
    autoFitAvisos();
  });
}
      }

      function buildAvisoEl(a){
        const el = document.createElement("div");
        el.className = `aviso ${prioridadeClass(a.prioridade)}`;

        const titulo = safeText(a.titulo || "Aviso");
        const desc = safeText(a.descricao || "");
        const tipo = safeText(a.tipo || "");
        const local = safeText(a.local || "");
        const ini = formatDT_BR(a.inicio || "");
        const fim = formatDT_BR(a.fim || "");

        const itens = [];
        if(local) itens.push(`<span class="metaItem">üìç <b>${escapeHtml(local)}</b></span>`);
        if(tipo)  itens.push(`<span class="metaItem">üè∑Ô∏è <b>${escapeHtml(tipo)}</b></span>`);
        const pr = safeText(a.prioridade || "Baixa");
        itens.push(`<span class="metaItem">‚ö° <span class="prioBadge ${prioridadeClass(pr)}">${escapeHtml(pr)}</span></span>`);
        if(ini || fim) itens.push(`<span class="metaItem">üóìÔ∏è <b>${escapeHtml(ini)}${fim ? " ‚Üí " + escapeHtml(fim) : ""}</b></span>`);

        el.innerHTML = `
          <p class="t">${escapeHtml(titulo)}</p>
          ${desc ? `<p class="d">${escapeHtml(desc)}</p>` : `<p class="d">‚Äî</p>`}
          <div class="metaLine">${itens.join(`<span class="metaSep">‚Ä¢</span>`)}</div>
        `;
        return el;
      }

      const totalPages = Math.max(1, Math.ceil(avisosAll.length / qtd));
      ROT_STATE = { page: 0, totalPages, paused: false };

      function renderPage(pageIdx){
        root.classList.remove("fade-in");
        root.classList.add("fade-out");

        const doRender = () => {
          root.innerHTML = "";
          const start = pageIdx * qtd;
          const slice = avisosAll.slice(start, start + qtd);
          root.style.setProperty("--rows", String(Math.max(1, Math.min(3, slice.length))));
          slice.forEach(a => root.appendChild(buildAvisoEl(a)));
          requestAnimationFrame(()=> ajustarAvisosTelaCheia(pageIdx));
          void root.offsetWidth;
          root.classList.remove("fade-out");
          root.classList.add("fade-in");
        };
        setTimeout(doRender, 220);
      }

      renderPage(0);
      root.classList.add("fade-in");

      if (ativar && totalPages > 1){
        if (rot.pausarNoMouse){
          root.addEventListener("mouseenter", ()=> ROT_STATE.paused = true, {passive:true});
          root.addEventListener("mouseleave", ()=> ROT_STATE.paused = false, {passive:true});
          root.addEventListener("touchstart", ()=>{ ROT_STATE.paused = !ROT_STATE.paused; }, {passive:true});
        }
        ROT_TIMER = setInterval(()=>{
          if (ROT_STATE.paused) return;
          ROT_STATE.page = (ROT_STATE.page + 1) % totalPages;
          renderPage(ROT_STATE.page);
        }, intervaloMs);
      }
    }

    /* =========================================================
       Vers√≠culo anual
       ========================================================= */
    function hojeKeyMMDD() {
      const d = new Date();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${mm}-${dd}`;
    }

    async function carregarVersiculo(data) {
      if (!data?.temaDoDia || data.temaDoDia.modo !== "biblico-anual") return;
      try {
        const res = await fetch("versiculos.json?ts=" + Date.now(), { cache: "no-store" });
        const v = await res.json();
        const key = hojeKeyMMDD();
        const texto = v?.versos?.[key];
        setText("dataBiblica", v?.cabecalho || "");
        setText("ref", texto ? texto : (v?.titulo ? v.titulo : "Verso n√£o encontrado"));
      } catch (e) {}
    }

    /* =========================================================
       WX SVGs (premium)
       ========================================================= */
    function wxSvgSun(){
      return `
      <svg class="wxsvg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g class="sun-rays" fill="none" stroke="rgba(255,220,120,.95)" stroke-width="3" stroke-linecap="round">
          <line x1="32" y1="6"  x2="32" y2="14"/>
          <line x1="32" y1="50" x2="32" y2="58"/>
          <line x1="6"  y1="32" x2="14" y2="32"/>
          <line x1="50" y1="32" x2="58" y2="32"/>
          <line x1="12" y1="12" x2="18" y2="18"/>
          <line x1="46" y1="46" x2="52" y2="52"/>
          <line x1="46" y1="18" x2="52" y2="12"/>
          <line x1="12" y1="52" x2="18" y2="46"/>
        </g>
        <circle class="sun-core" cx="32" cy="32" r="12" fill="rgba(255,200,60,.98)"/>
        <circle cx="32" cy="32" r="12" fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
      </svg>`;
    }

    function wxSvgCloud(){
      return `
      <svg class="wxsvg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g class="cloud">
          <path d="M22 44h22a12 12 0 0 0 0-24 15 15 0 0 0-29-3A11 11 0 0 0 22 44z"
            fill="rgba(235,245,255,.92)"/>
          <path d="M22 44h22a12 12 0 0 0 0-24 15 15 0 0 0-29-3A11 11 0 0 0 22 44z"
            fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
        </g>
      </svg>`;
    }

    function wxSvgRain(){
      return `
      <svg class="wxsvg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g class="cloud">
          <path d="M20 40h24a11 11 0 0 0 0-22 14 14 0 0 0-27-3A10 10 0 0 0 20 40z"
            fill="rgba(235,245,255,.92)"/>
          <path d="M20 40h24a11 11 0 0 0 0-22 14 14 0 0 0-27-3A10 10 0 0 0 20 40z"
            fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
        </g>
        <g class="drops" stroke="rgba(120,200,255,.95)" stroke-width="3" stroke-linecap="round">
          <line x1="26" y1="44" x2="24" y2="52"/>
          <line x1="34" y1="44" x2="32" y2="52"/>
          <line x1="42" y1="44" x2="40" y2="52"/>
        </g>
      </svg>`;
    }

    function wxSvgStorm(){
      return `
      <svg class="wxsvg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g class="cloud">
          <path d="M18 40h26a11 11 0 0 0 0-22 14 14 0 0 0-27-3A10 10 0 0 0 18 40z"
            fill="rgba(235,245,255,.92)"/>
          <path d="M18 40h26a11 11 0 0 0 0-22 14 14 0 0 0-27-3A10 10 0 0 0 18 40z"
            fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
        </g>
        <path class="bolt" d="M30 42l-4 10h6l-3 10 12-16h-6l3-4z"
          fill="rgba(255,210,80,.98)"/>
      </svg>`;
    }

    function wxSvgByCode(code){
      const c = Number(code);
      const isSun   = (c === 0);
      const isCloud = ([1,2,3,45,48].includes(c));
      const isRain  = ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(c));
      const isStorm = ([95,96,99].includes(c));

      if (isSun)   return { label:"Ensolarado", svg: wxSvgSun() };
      if (isStorm) return { label:"Tempestade", svg: wxSvgStorm() };
      if (isRain)  return { label:"Chuva", svg: wxSvgRain() };
      if (isCloud) return { label:"Nublado", svg: wxSvgCloud() };
      return { label:"Clima", svg: wxSvgCloud() };
    }

    function wxSetIcon(elId, code){
      const el = document.getElementById(elId);
      if(!el) return;
      const o = wxSvgByCode(code);
      el.innerHTML = o.svg;
      el.setAttribute("role","img");
      el.setAttribute("aria-label", o.label || "Clima");
    }

    async function carregarClima(data){
      const c = data?.clima;
      try {
        if (!c?.latitude || !c?.longitude) throw new Error("Sem coordenadas");

        const url =
          "https://api.open-meteo.com/v1/forecast" +
          `?latitude=${encodeURIComponent(c.latitude)}` +
          `&longitude=${encodeURIComponent(c.longitude)}` +
          `&current=temperature_2m,precipitation,weather_code,wind_speed_10m` +
          `&timezone=${encodeURIComponent(c.timezone || "America/Sao_Paulo")}`;

        const res = await fetch(url, { cache: "no-store" });
        const j = await res.json();
        const cur = j?.current;
        if (!cur) throw new Error("Sem current");

        const t = Math.round(cur.temperature_2m);
        const w = Math.round(cur.wind_speed_10m);
        const p = cur.precipitation;
        const code = Number(cur.weather_code);

        wxSetIcon("wxIconTop", code);
        wxSetIcon("wxIconInline", code);

        setText("wxCityTemp", `${c.cidade || "Tubar√£o/SC"} ${t}¬∞C`);
        setText("wxWindRain", `Vento ${w} km/h ‚Ä¢ Chuva ${p} mm`);

      } catch (e) {
        const cloud = wxSvgCloud();
        const top = document.getElementById("wxIconTop");
        const mini = document.getElementById("wxIconInline");
        if (top) top.innerHTML = cloud;
        if (mini) mini.innerHTML = cloud;
        setText("wxCityTemp", `${data?.clima?.cidade || "‚Äî"} (offline)`);
        setText("wxWindRain", `Vento ‚Äî km/h ‚Ä¢ Chuva ‚Äî mm`);
      }
    }

    /* =========================================================
       Publicidade ‚Äî MP4 + troca no onended
       ========================================================= */
    const AD_STATE_KEY = "CS_AD_STATE_V1";
    const AD_SHUFFLE_KEY = "CS_AD_SHUFFLE_V1";

    function adLoadState(){
      try { return JSON.parse(sessionStorage.getItem(AD_STATE_KEY) || "{}"); }
      catch(e){ return {}; }
    }
    function adSaveState(st){
      try { sessionStorage.setItem(AD_STATE_KEY, JSON.stringify(st || {})); } catch(e){}
    }

    function adFilterMp4(list){
      const arr = Array.isArray(list) ? list : [];
      return arr.filter(x=>{
        const src = String(x?.arquivo || "").trim();
        return /\.mp4(\?.*)?$/i.test(src);
      });
    }

    function adSeek(delta){
      const v = document.getElementById("adVideo");
      if(!v) return;
      try{
        v.currentTime = Math.max(0, (v.currentTime || 0) + delta);
        const st = adLoadState();
        st.t = v.currentTime || 0;
        st.paused = v.paused;
        adSaveState(st);
      }catch(e){}
    }

    function setCityTitleFromConfig(cfg){
      const el = document.getElementById("cityTitle");
      if(!el) return;
      const t = cfg?.publicidade?.cidadeTitulo || cfg?.cidadeTitulo || "üì∞ Mensagens no Brasil";
      el.textContent = String(t);
    }

    function bindTvVideoControls(videos){
      const v = document.getElementById("adVideo");
      const controls = document.getElementById("tvVideoControls");
      if(!v || !controls) return;

      controls.style.display = "flex";

      const bPrev = document.getElementById("btnPrevAd");
      const bNext = document.getElementById("btnNextAd");
      const bBack = document.getElementById("btnBack10");
      const bFwd  = document.getElementById("btnFwd10");

      function setIdx(nextIdx){
        const list = videos;
        if(!list.length) return;

        let i = nextIdx;
        if(i < 0) i = list.length - 1;
        if(i >= list.length) i = 0;

        const st = adLoadState();
        st.idx = i;
        st.t = 0;
        st.paused = false;
        adSaveState(st);

        adPlayByState(list, true);
      }

      if(bPrev) bPrev.onclick = () => setIdx((adLoadState().idx ?? 0) - 1);
      if(bNext) bNext.onclick = () => setIdx((adLoadState().idx ?? 0) + 1);
      if(bBack) bBack.onclick = () => adSeek(-10);
      if(bFwd)  bFwd.onclick  = () => adSeek(+10);

      window.addEventListener("keydown", (e)=>{
        if(isMobile()) return;
        const k = String(e.key || "").toLowerCase();
        if(k === "arrowleft") setIdx((adLoadState().idx ?? 0) - 1);
        if(k === "arrowright") setIdx((adLoadState().idx ?? 0) + 1);
      });
    }

    function adApplyFitContain(v){
      try{
        const isVertical = v.videoHeight > v.videoWidth;
        if (isVertical) v.classList.add("fit-contain");
        else v.classList.remove("fit-contain");
      }catch(e){}
    }

    function adSavePlayback(){
      const v = document.getElementById("adVideo");
      if(!v) return;
      const st = adLoadState();
      st.t = Number.isFinite(v.currentTime) ? v.currentTime : (st.t || 0);
      st.paused = v.paused;
      adSaveState(st);
    }

    function adShuffleCopy(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function adGetShuffledList(originalList){
      try{
        const raw = sessionStorage.getItem(AD_SHUFFLE_KEY);
        if(raw){
          const saved = JSON.parse(raw);
          const filesNow = originalList.map(x => String(x?.arquivo||""));
          const filesSaved = Array.isArray(saved?.files) ? saved.files : [];
          if(filesSaved.join("|") === filesNow.join("|") && Array.isArray(saved?.order)){
            const order = saved.order;
            const map = new Map(originalList.map(x => [String(x?.arquivo||""), x]));
            const rebuilt = order.map(f => map.get(f)).filter(Boolean);
            filesNow.forEach(f=>{ if(!order.includes(f)) rebuilt.push(map.get(f)); });
            return rebuilt;
          }
        }
      }catch(e){}

      const shuffled = adShuffleCopy(originalList);
      try{
        const order = shuffled.map(x => String(x?.arquivo||""));
        const files = originalList.map(x => String(x?.arquivo||""));
        sessionStorage.setItem(AD_SHUFFLE_KEY, JSON.stringify({ files, order }));
      }catch(e){}
      return shuffled;
    }

    function adPlayByState(videos, forceFromStart){
      const adVideo = document.getElementById("adVideo");
      const adLabel = document.getElementById("adLabel");
      const adPill  = document.getElementById("adPill");
      if(!adVideo || !adLabel) return;

      let list = Array.isArray(videos) ? videos : [];
      if(!list.length) return;

      try{
        const cfg = (window.__lastDataForTopbar || window.__cfg || {});
        const pub = cfg?.publicidade || {};
        if (pub.shuffle) list = adGetShuffledList(list);
      }catch(e){}

      const st = adLoadState();
      let idx = Number.isFinite(st.idx) ? st.idx : 0;
      if(idx < 0) idx = 0;
      if(idx >= list.length) idx = 0;

      const item = list[idx];
      const src = String(item?.arquivo || "");
      const sep = src.includes("?") ? "&" : "?";
      const finalSrc = src ? (src + sep + "ts=" + Date.now()) : "";

      adLabel.textContent = String(item?.anunciante || "An√∫ncio");
      if (adPill) adPill.textContent = "No ar";

      const cur = adVideo.currentSrc || adVideo.src || "";
      const baseCur = cur.split("?")[0];
      const baseNext = finalSrc.split("?")[0];

      if (baseCur !== baseNext){
        adVideo.pause();
        adVideo.classList.remove("fit-contain");
        adVideo.removeAttribute("src");
        adVideo.load();
        adVideo.src = finalSrc;
        adVideo.load();
      }

      const desiredTime = (forceFromStart ? 0 : Number(st.t || 0));
      const playNow = () => {
        try{
          if(!forceFromStart && desiredTime > 0 && Number.isFinite(desiredTime)){
            try { adVideo.currentTime = desiredTime; } catch(e){}
          }
          const p = adVideo.play();
          if(p && p.catch) p.catch(()=>{});
        }catch(e){}
      };

      if (adVideo.readyState >= 1) {
        adApplyFitContain(adVideo);
        playNow();
      } else {
        adVideo.onloadedmetadata = () => { adApplyFitContain(adVideo); playNow(); };
      }

      st.idx = idx;
      st.paused = false;
      adSaveState(st);
    }

    function adNext(videos){
      const list = videos;
      if(!list.length) return;

      const st = adLoadState();
      let idx = Number.isFinite(st.idx) ? st.idx : 0;
      idx++;
      if(idx >= list.length) idx = 0;

      st.idx = idx;
      st.t = 0;
      st.paused = false;
      adSaveState(st);

      adPlayByState(list, true);
    }

    function iniciarPublicidade(data){
      const pub = data?.publicidade;
      const adBox = document.getElementById("adBox");
      const adVideo = document.getElementById("adVideo");
      const adCard = document.getElementById("adCard");
      if (!adBox) return;

      if (!pub?.ativar){
        adBox.style.display = "none";
        return;
      }

      adBox.style.display = "flex";
      carregarMensagensCidade();

      const videosMp4 = adFilterMp4(pub?.videos);
      if (!videosMp4.length){
        if (adCard) adCard.style.display = "none";
        return;
      }

      if (adCard) adCard.style.display = "flex";
      bindTvVideoControls(videosMp4);

      if (!adVideo) return;

      adVideo.addEventListener("click", () => {
        try{
          const st = adLoadState();
          st.paused = false;
          adSaveState(st);
        }catch(e){}
        adVideo.play().catch(()=>{});
      }, { passive:true });

      adVideo.addEventListener("timeupdate", ()=>{ if(!isMobile()) adSavePlayback(); }, {passive:true});
      adVideo.addEventListener("pause", adSavePlayback, {passive:true});
      adVideo.addEventListener("play", adSavePlayback, {passive:true});
      document.addEventListener("visibilitychange", ()=>{ if(document.hidden) adSavePlayback(); });

      adPlayByState(videosMp4, false);
      adVideo.onended = () => adNext(videosMp4);
      adVideo.onerror = () => setTimeout(()=>adNext(videosMp4), 1200);
    }

    /* =========================================================
       Mensagens da Cidade (SEM SCROLL)
       ========================================================= */
    function decodeHtmlEntities_(s){
      const t = document.createElement("textarea");
      t.innerHTML = String(s ?? "");
      return t.value;
    }
    function normalizeText_(s){
      return decodeHtmlEntities_(s).replace(/\u00a0/g, " ").replace(/\s+/g, " ").trim();
    }

    function getNewsMaxItems(){
      const h = window.innerHeight || 900;
      if (isMobile()) return 8;
      if (h < 720) return 3;
      if (h < 880) return 4;
      return 5;
    }

    async function carregarMensagensCidade(){
      const newsBox  = document.getElementById("newsBox");
      const newsBody = document.getElementById("newsBody");
      if(!newsBox || !newsBody) return;

      try{
        const res = await fetch("./mensagens_cidade.json?ts=" + Date.now(), { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);

        const j = await res.json();
        const items = Array.isArray(j.items) ? j.items : [];
        const maxItems = getNewsMaxItems();

        if(!items.length){
          newsBody.innerHTML = `
            <div class="newsItem"><p class="h">Sem mensagens no momento</p></div>
            <div class="newsFooter">Fonte: indispon√≠vel</div>
          `;
          newsBox.style.display = "flex";
          return;
        }

        let html = "";
        const fontes = new Set();

        items.slice(0, maxItems).forEach(x=>{
          let titulo = normalizeText_(x.titulo || x.title || "Mensagem");
          titulo = titulo.replace(/\s+‚Äì\s+Google\s+News$/i, "").trim();
          titulo = titulo.replace(/\s+\|\s+.*$/i, "").trim();
          if(!titulo) titulo = "Mensagem";

          if(x.fonte) fontes.add(normalizeText_(x.fonte));
          html += `<div class="newsItem"><p class="h">${escapeHtml(titulo)}</p></div>`;
        });

        let fontesHtml = "";
        if(fontes.size){
          fontesHtml = `<div class="newsFooter">Fonte:</div>`;
          fontes.forEach(f=>{ fontesHtml += `<div class="newsFooterItem">${escapeHtml(f)}</div>`; });
        }

        newsBody.innerHTML = html + fontesHtml;
        newsBox.style.display = "flex";

      }catch(e){
        newsBody.innerHTML = `
          <div class="newsItem"><p class="h">Mensagens indispon√≠veis</p></div>
          <div class="newsFooter">Fonte: news.google.com (offline)</div>
        `;
        newsBox.style.display = "flex";
      }
    }

  /* =========================================================
   Topbar imagem por cidade / hor√°rio / tamanho de tela (n√≠tida)
   ========================================================= */
function aplicarImagemTopbar(data){

  const cidade = String(data?.clima?.cidade || "").toLowerCase();
  const isTubarao = cidade.includes("tubar√£o") || cidade.includes("tubarao");

  const h = new Date().getHours();
  const estaNoite = (h >= 18 || h <= 4);

  const isMobile = window.matchMedia("(max-width: 980px)").matches;
  const isBigScreen = Math.max(screen.width, screen.height) >= 1920;

  let img = "./img/tubarao01.jpg"; // fallback padr√£o

  if(isTubarao){

    if(estaNoite){
      if(isMobile)       img = "./img/tubarao_noite.jpg";
      else if(isBigScreen) img = "./img/tubarao_noite-2560p.jpg";
      else               img = "./img/tubarao_noite-1920p.jpg";
    }else{
      if(isMobile)       img = "./img/tubarao01.jpg";
      else if(isBigScreen) img = "./img/tubarao01-2560p.jpg";
      else               img = "./img/tubarao01-1920p.jpg";
    }

  }

  const test = new Image();

  test.onload = () => {
    document.documentElement.style.setProperty(
      "--topbar-bg",
      `url('${img}')`
    );
  };

  test.onerror = () => {
    document.documentElement.style.setProperty(
      "--topbar-bg",
      `url('./img/tubarao01.jpg')`
    );
  };

  // ‚úÖ sem Date.now() (evita blur)
  // troque v=1 somente quando atualizar a imagem
  test.src = img + "?v=1";
}

    /* =========================================================
       Load principal
       ========================================================= */
    async function loadAll(){
      const status = document.getElementById("statusJson");
      const statusMini = document.getElementById("statusJsonMini");
      const dot = document.getElementById("dotOnline");

      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const ct = (res.headers.get("content-type") || "").toLowerCase();
        if (!ct.includes("application/json")) throw new Error("Resposta n√£o-JSON: " + ct);
        const data = await res.json();
        window.__lastDataForTopbar = data;

        setText("condoCenter", safeText(data.condominio || "‚Äî"));

        if (status) status.textContent = "Atualizado";
        if (statusMini) statusMini.textContent = "Atualizado";
        if (dot) dot.style.background = "#44d07a";

        setCityTitleFromConfig(data);

        renderAvisos(data);

        if (data.temaDoDia && data.temaDoDia.modo === "biblico-anual") {
          setText("dataBiblica", "üìñ");
          setText("ref", "Carregando‚Ä¶");
        } else {
          setText("dataBiblica", "üìå Avisos");
          setText("ref", safeText(data.referencia || "Atualizado"));
        }

        await carregarVersiculo(data);
        await carregarClima(data);
        aplicarImagemTopbar(data);
        iniciarPublicidade(data);

        return data;

      } catch(e){
        if (status) status.textContent = "Offline";
        if (statusMini) statusMini.textContent = "Offline";
        if (dot) dot.style.background = "#ff5a5a";
        return null;
      }
    }

    loadAll();

    setInterval(() => {
      try{ if(window.__lastDataForTopbar) aplicarImagemTopbar(window.__lastDataForTopbar); }catch(e){}
    }, 60000);

    /* ‚úÖ recalcula ‚Äúnews max items‚Äù quando muda tamanho (PC/Wix/TV) */
    window.addEventListener("resize", ()=>{
      if(!isMobile()) carregarMensagensCidade();
      try{ if(window.__lastDataForTopbar) ajustarAvisosTelaCheia(ROT_STATE.page || 0); }catch(e){}
    }, {passive:true});


window.addEventListener("resize", () => {
  if (window.innerWidth >= 981) {
    autoFitAvisos();
    autoFitNews();
  }
});
    
  </script>

  <script>
    /* =========================================================
       Service Worker update
       ========================================================= */
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });
          try { await reg.update(); } catch(e){}
          reg.addEventListener("updatefound", () => {
            const nw = reg.installing;
            if(!nw) return;
            nw.addEventListener("statechange", () => {
              if (nw.state === "installed" && navigator.serviceWorker.controller) {
                nw.postMessage("SKIP_WAITING");
              }
            });
          });
        } catch(e){}
      });

      navigator.serviceWorker.addEventListener("controllerchange", () => {
        const banner = document.getElementById("updateBanner");
        if(banner) banner.style.display = "block";
        setTimeout(()=>window.location.reload(), 1200);
      });
    }
  </script>

  <script>
    /* =========================================================
       Fundo din√¢mico
       ========================================================= */
    const fundos = {
      azul:    ["#061726", "#0b1f33"],
      verde:   ["#0b2e1a", "#134d2c"],
      amarelo: ["#3a3300", "#665c00"],
      laranja: ["#3a1f00", "#663300"],
      branco:  ["#f2f2f2", "#dcdcdc"],
      preto:   ["#000000", "#111111"]
    };

    function setFundo(cor){
      if(!fundos[cor]) return;
      document.documentElement.style.setProperty("--bg1", fundos[cor][0]);
      document.documentElement.style.setProperty("--bg2", fundos[cor][1]);
      try { localStorage.setItem("fundoEscolhido", cor); } catch(e){}
    }

    function fundoAleatorio(){
      const cores = Object.keys(fundos);
      const cor = cores[Math.floor(Math.random() * cores.length)];
      setFundo(cor);
      return cor;
    }

    (function carregarFundoSalvo(){
      try{
        const salvo = localStorage.getItem("fundoEscolhido");
        if(salvo && fundos[salvo]) setFundo(salvo);
      }catch(e){}
    })();

    window.addEventListener("keydown", (e)=>{
      const k = String(e.key || "").toLowerCase();
      if (k === "1") setFundo("azul");
      else if (k === "2") setFundo("verde");
      else if (k === "3") setFundo("amarelo");
      else if (k === "4") setFundo("laranja");
      else if (k === "5") setFundo("branco");
      else if (k === "6") setFundo("preto");
      else if (k === "r") fundoAleatorio();
    });

    setInterval(fundoAleatorio, 300000);
  </script>

</body>
</html>
