<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Cond√¥minos - Comunica S√≠ndico(a)</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#061726">

<!-- üîí Canonical URL: evita instalar 2 vers√µes (com/sem ?pwa=) -->
<script>
(function(){
  const url = new URL(window.location.href);
  const pwa = url.searchParams.get("pwa");

  if (pwa !== "condominos" && url.search) {
    url.search = "";
    window.location.replace(url.toString());
  }

  if (!url.pathname.endsWith("/index.html") && !url.pathname.endsWith("/")) {
    window.location.replace("./index.html");
  }
})();
</script>

<style>
:root{
  --bg1:#061726;
  --bg2:#0b1f33;
  --line:rgba(255,255,255,.10);
  --txt:#eaf2ff;
  --muted:rgba(234,242,255,.75);
  --shadow: 0 14px 50px rgba(0,0,0,.35);
  --radius: 18px;
  --sat: env(safe-area-inset-top);
  --sar: env(safe-area-inset-right);
  --sab: env(safe-area-inset-bottom);
  --sal: env(safe-area-inset-left);
}
*{box-sizing:border-box}
html,body{height:100%;width:100%}
body{
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  color:var(--txt);
  background:
    radial-gradient(1200px 700px at 15% 10%, #10385b 0%, rgba(16,56,91,0) 55%),
    radial-gradient(900px 600px at 85% 15%, #0b3454 0%, rgba(11,52,84,0) 55%),
    linear-gradient(180deg, var(--bg1), var(--bg2));
  overscroll-behavior:none;
  user-select:none;
  touch-action:manipulation;
  min-height:100dvh;
}
.wrap{
  min-height:100dvh;
  width:100%;
  padding:
    calc(18px + var(--sat))
    calc(18px + var(--sar))
    calc(18px + var(--sab) + 58px)
    calc(18px + var(--sal));
  display:flex;
  justify-content:center;
}
.container{
  width:min(1400px, 100%);
  min-height:calc(100dvh - var(--sat) - var(--sab) - 36px - 58px);
  display:flex;
  flex-direction:column;
  gap:18px;
}
.topbar{
  display:flex;align-items:center;justify-content:space-between;gap:14px;
  padding:18px 20px;
  background:rgba(8,28,46,.55);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.title{margin:0;font-size:28px;font-weight:800}
.subtitle{margin:4px 0 0;font-size:13px;color:var(--muted);font-weight:600}
.badge{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;border-radius:999px;
  border:1px solid var(--line);
  background:rgba(12,35,56,.55);
  color:var(--muted);font-weight:700;font-size:12px;
}
.dot{width:10px;height:10px;border-radius:50%;background:#44d07a}
.btnInstall{
  border:1px solid rgba(255,255,255,.18);
  background:rgba(12,35,56,.55);
  color:rgba(234,242,255,.92);
  padding:10px 12px;
  border-radius:999px;
  font-weight:800;
  cursor:pointer;
  font-size:16px;
}
.updateBanner{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(120,190,255,.35);
  background:rgba(7,20,34,.28);
  box-shadow:var(--shadow);
  font-weight:900;
}
.grid{
  flex:1;
  display:grid;
  grid-template-columns:1.25fr .75fr;
  gap:18px;
}
.card{
  background:linear-gradient(180deg, rgba(15,43,69,.92), rgba(11,33,55,.92));
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
}
.card .head{
  padding:16px 18px;
  border-bottom:1px solid var(--line);
  display:flex;justify-content:center;
}
.pill{
  font-size:12px;font-weight:800;
  padding:8px 10px;border-radius:999px;
  border:1px solid var(--line);
  color:var(--muted);
}
.avisos{
  padding:16px;
  flex:1;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.aviso{
  padding:16px;
  border:1px solid var(--line);
  border-radius:14px;
  background:rgba(7,20,34,.28);
}
.aviso.alta{border-color:rgba(255,80,80,.55)}
.aviso.media{border-color:rgba(255,200,70,.40)}
.aviso.baixa{border-color:rgba(120,190,255,.35)}
.aviso .t{margin:0 0 8px;font-weight:900;font-size:18px}
.aviso .d{margin:0;color:var(--muted)}
.side{display:grid;gap:18px}
.mini{
  padding:16px;
  background:linear-gradient(180deg, rgba(12,35,56,.95), rgba(9,26,44,.95));
  border:1px solid var(--line);
  border-radius:var(--radius);
}
#wxbar{
  position:fixed;left:0;right:0;bottom:0;
  padding:
    10px
    calc(14px + var(--sar))
    calc(10px + var(--sab))
    calc(14px + var(--sal));
  font:800 14px "Segoe UI",Arial,sans-serif;
  display:flex;gap:12px;align-items:center;justify-content:center;
  background:#0b223a;color:#fff;
  border-top:1px solid rgba(255,255,255,.12);
}
@media(max-width:980px){
  .grid{grid-template-columns:1fr;}
}
</style>
</head>

<body>
<div class="wrap">
<div class="container">

<div class="topbar">
  <div>
    <h1 class="title" id="titulo">Comunica S√≠ndico</h1>
    <p class="subtitle" id="subtitulo">Painel informativo</p>
  </div>
  <div style="display:flex;gap:10px;">
    <button id="btnInstalarApp" class="btnInstall" onclick="instalarApp()" style="display:none">üì≤ Instalar App</button>
    <div class="badge"><span class="dot"></span><span id="statusJson">Carregando‚Ä¶</span></div>
  </div>
</div>

<div id="updateBanner" class="updateBanner" style="display:none">
‚¨ÜÔ∏è Nova vers√£o dispon√≠vel. Atualizando‚Ä¶
</div>

<div class="grid">
<section class="card">
  <div class="head">
    <div class="pill" id="dataBiblica">‚Äî</div>
  </div>
  <div class="avisos" id="avisos"></div>
</section>

<aside class="side">
  <div class="mini anuncio" id="adBox" style="display:none">
    <p id="adLabel"></p>
    <video id="adVideo" autoplay muted playsinline></video>
  </div>
</aside>
</div>

</div>
</div>

<div id="wxbar">
<span id="wxIcon">‚è≥</span>
<span id="wxText">Clima: carregando‚Ä¶</span>
</div>

<script>
let deferredPrompt=null;
function mostrarBotaoInstalar(s){document.getElementById("btnInstalarApp").style.display=s?"inline-flex":"none";}
window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();deferredPrompt=e;mostrarBotaoInstalar(true);});
window.addEventListener("appinstalled",()=>{deferredPrompt=null;mostrarBotaoInstalar(false);});
async function instalarApp(){if(!deferredPrompt)return;await deferredPrompt.prompt();deferredPrompt=null;mostrarBotaoInstalar(false);}

async function loadAll(){
const status=document.getElementById("statusJson");
try{
const r=await fetch("data.json?ts="+Date.now(),{cache:"no-store"});
const j=await r.json();
status.textContent="Atualizado";
renderAvisos(j);
}catch{
status.textContent="Offline";
}
}
function renderAvisos(j){
const el=document.getElementById("avisos");
el.innerHTML="";
(j.avisos||[]).forEach(a=>{
const d=document.createElement("div");
d.className="aviso "+(a.prioridade||"baixa");
d.innerHTML=`<p class="t">${a.titulo}</p><p class="d">${a.descricao}</p>`;
el.appendChild(d);
});
}
loadAll();
setInterval(loadAll,60000);
</script>

<script>
/* Service Worker + update control */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", async () => {
    try {
      const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });
      try { await reg.update(); } catch {}

      reg.addEventListener("updatefound", () => {
        const nw = reg.installing;
        if (!nw) return;
        nw.addEventListener("statechange", () => {
          if (nw.state === "installed" && navigator.serviceWorker.controller) {
            reg.waiting?.postMessage("SKIP_WAITING");
            nw.postMessage("SKIP_WAITING");
          }
        });
      });

    } catch {}
  });

  navigator.serviceWorker.addEventListener("controllerchange", () => {
    const banner = document.getElementById("updateBanner");
    if (banner) banner.style.display = "block";
    setTimeout(() => window.location.reload(), 1200);
  });
}
</script>

</body>
</html>
