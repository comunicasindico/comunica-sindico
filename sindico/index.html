<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no,date=no,address=no,email=no">

  <title>S√≠ndico(a) ‚Äî Comunica S√≠ndico</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0b223a">

  <link rel="icon" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="S√≠ndico(a)">

  <!-- Evita m√∫ltiplas vers√µes sem matar o ?pwa=1 -->
  <script>
  (function(){
    const isStandalone =
      (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) ||
      (window.navigator.standalone === true);

    try{
      const url = new URL(location.href);
      if(!isStandalone && !url.searchParams.has("pwa")){
        url.searchParams.set("pwa","1");
        history.replaceState(null,"",url.toString());
      }
    }catch(e){}
  })();
  </script>

  <style>
    :root{
      --bg:#061726;
      --card:rgba(12,35,56,.55);
      --txt:#eaf2ff;
      --line:rgba(255,255,255,.15);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--txt);
      display:flex;
      min-height:100dvh;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .box{
      width:min(720px,100%);
      padding:26px;
      border:1px solid var(--line);
      border-radius:18px;
      background:var(--card);
      text-align:center;
      box-shadow:0 14px 40px rgba(0,0,0,.4);
    }
    h1{margin:0 0 10px 0;font-size:24px}
    p{margin:0 0 14px 0;opacity:.9;font-size:16px;line-height:1.35}
    .actions{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(12,35,56,.75);
      color:var(--txt);
      padding:14px 20px;
      font-weight:800;
      font-size:15px;
      text-decoration:none;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.08)}
    .mini{font-size:13px;opacity:.75;margin-top:10px}
    .badge{
      display:inline-block;
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      opacity:.85;
      margin-bottom:12px;
    }
  </style>
</head>

<body>
  <div class="box">
    <div class="badge" id="mode">Abrindo...</div>

    <h1>üì£ S√≠ndico(a) ‚Äî Comunica S√≠ndico</h1>
    <p>Painel administrativo para gerenciar avisos e e-mails dos cond√¥minos.</p>

    <div class="actions">
      <a class="btn" id="go" rel="noopener"
         href="https://script.google.com/macros/s/AKfycbyBHEhubiPa5Oif5T68PzrahDbYHpw5LDfZ0oHD_E7ozCYEk62xCVGk648ITzH-eehQ/exec">
        üöÄ Abrir Painel do S√≠ndico
      </a>
      <button class="btn" id="cancel" type="button" style="opacity:.9;display:none">‚è∏Ô∏è N√£o redirecionar</button>
    </div>

    <p class="mini" id="hint">Dica: instale este app na Tela de In√≠cio para acesso r√°pido (FaceID/TouchID no aparelho).</p>
  </div>

  <script>
(function(){
  const goEl = document.getElementById("go");
  const mode = document.getElementById("mode");
  const cancelBtn = document.getElementById("cancel");
  const hint = document.getElementById("hint");

  const isStandalone =
    (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) ||
    (window.navigator.standalone === true);

  mode.textContent = isStandalone ? "Modo App (instalado)" : "Modo Navegador";

  if (hint) {
    hint.textContent = isStandalone
      ? "Toque em ‚ÄúAbrir painel‚Äù (o painel √© online no Apps Script)."
      : "Instale o app (menu do navegador) ou toque em ‚ÄúAbrir painel‚Äù.";
  }

  if (cancelBtn) cancelBtn.style.display = "none";

  // Melhor compatibilidade (principalmente iPhone/Safari):
  // no navegador, abre em nova aba; no app instalado, abre normal.
  if(goEl){
    if(!isStandalone){
      goEl.setAttribute("target","_blank");
    }else{
      goEl.removeAttribute("target");
    }
  }

  // Service Worker (GitHub Pages + repo)
  if ("serviceWorker" in navigator) {
    const base = "/comunica-sindico/sindico/";
    const swUrl = base + "sw.js";
    const scope = base;

    window.addEventListener("load", async () => {
      try{
        const reg = await navigator.serviceWorker.register(swUrl, { scope });
        try { await reg.update(); } catch(e){}

        reg.addEventListener("updatefound", () => {
          const nw = reg.installing;
          if(!nw) return;
          nw.addEventListener("statechange", () => {
            if (nw.state === "installed" && navigator.serviceWorker.controller) {
              nw.postMessage("SKIP_WAITING");
            }
          });
        });
      }catch(e){}
    });

    navigator.serviceWorker.addEventListener("controllerchange", () => {
      setTimeout(() => window.location.reload(), 600);
    });
  }
})();
  </script>

</body>
</html>
