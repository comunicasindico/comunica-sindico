<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<meta name="format-detection" content="telephone=no,date=no,address=no,email=no"/>

<!-- üîí Canonical (evita duplicar app com query ?pwa= / ?app=) -->
<link rel="canonical" href="./">
<script>
(function(){
  try{
    const u = new URL(location.href);
    if(u.search){
      u.search = "";
      location.replace(u.toString());
      return;
    }
    if(u.pathname.endsWith("/index.html")){
      location.replace("./");
      return;
    }
  }catch(e){}
})();
</script>

<title>S√≠ndico(a) ‚Äî Comunica S√≠ndico</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b223a">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<!-- iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="S√≠ndico(a)">

<style>
:root{
  --bg:#061726;
  --card:rgba(12,35,56,.55);
  --txt:#eaf2ff;
  --line:rgba(255,255,255,.15);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--txt);
  display:flex;
  min-height:100dvh;
  align-items:center;
  justify-content:center;
  padding:18px;
}
.box{
  width:min(720px, 100%);
  padding:26px;
  border:1px solid var(--line);
  border-radius:18px;
  background:var(--card);
  text-align:center;
  box-shadow:0 14px 40px rgba(0,0,0,.4);
}
h1{margin:0 0 10px;font-size:24px}
p{margin:0 0 14px;opacity:.9;font-size:16px;line-height:1.35}
.actions{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:6px;
}
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(12,35,56,.75);
  color:var(--txt);
  padding:14px 20px;
  font-weight:800;
  font-size:15px;
  text-decoration:none;
  cursor:pointer;
  user-select:none;
}
.btn:hover{filter:brightness(1.08)}
.mini{font-size:13px;opacity:.75;margin-top:10px}
.badge{
  display:inline-block;
  font-size:12px;
  padding:6px 10px;
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px;
  opacity:.85;
  margin:0 0 12px;
}
</style>
</head>

<body>

<div class="box">
  <div class="badge" id="mode">Abrindo‚Ä¶</div>

  <h1>üìã S√≠ndico(a) ‚Äî Comunica S√≠ndico</h1>
  <p>Painel administrativo para gerenciar avisos e e-mails dos cond√¥minos.</p>

  <div class="actions">
    <a class="btn" id="go" rel="noopener" href="https://script.google.com/macros/s/AKfycbyBHEhubiPa5Oif5T68PzrahDbYHpw5LDfZ0oHD_E7ozCYEk62xCVGk648ITzH-eehQ/exec">
      ‚û°Ô∏è Abrir Painel do S√≠ndico
    </a>
    <button class="btn" id="cancel" type="button" style="opacity:.9">
      ‚è∏Ô∏è N√£o redirecionar
    </button>
  </div>

  <p class="mini">
    Dica: instale este app na Tela de In√≠cio para acesso r√°pido (FaceID/TouchID no aparelho).
  </p>
</div>

<script>
/* ===== Estado ===== */
const targetUrl = document.getElementById("go").href;
const mode = document.getElementById("mode");
const cancelBtn = document.getElementById("cancel");
let canceled = false;

cancelBtn.addEventListener("click", () => {
  canceled = true;
  mode.textContent = "Redirecionamento pausado";
  cancelBtn.style.display = "none";
});

/* Detecta se est√° rodando como app instalado */
const isStandalone =
  (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) ||
  window.navigator.standalone === true;

mode.textContent = isStandalone ? "Modo App (instalado)" : "Modo Navegador";

/* ===== Service Worker ‚Äî PWA S√≠ndico (escopo /sindico/) ===== */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", async () => {
    try {
      const reg = await navigator.serviceWorker.register("./sw.js", { scope: "./" });

      try { await reg.update(); } catch {}

      reg.addEventListener("updatefound", () => {
        const nw = reg.installing;
        if (!nw) return;

        nw.addEventListener("statechange", () => {
          if (nw.state === "installed" && navigator.serviceWorker.controller) {
            reg.waiting?.postMessage("SKIP_WAITING");
            nw.postMessage("SKIP_WAITING");
          }
        });
      });
    } catch (err) {
      console.error("Erro no Service Worker (S√≠ndico):", err);
    }
  });

  navigator.serviceWorker.addEventListener("controllerchange", () => {
    setTimeout(() => window.location.reload(), 800);
  });
}

/* ===== Auto-redirect suave (somente se n√£o cancelado) ===== */
setTimeout(() => {
  if (canceled) return;
  mode.textContent = "Abrindo painel‚Ä¶";
  window.location.assign(targetUrl);
}, 900);
</script>

</body>
</html>
