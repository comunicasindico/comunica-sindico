<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Comunica S√≠ndico ‚Äî Admin (Avisos)</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --bg1:#071725; --bg2:#0b1f33;
      --panel: rgba(10,30,50,.72);
      --line: rgba(140,200,255,.18);
      --txt: rgba(234,242,255,.94);
      --muted: rgba(234,242,255,.72);
      --shadow: 0 18px 44px rgba(0,0,0,.45);
      --radius: 18px;
      --danger: #ff3b3b;
      --ok: #44d07a;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100svh;
      color:var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, #143c5f 0%, rgba(20,60,95,0) 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      padding:16px;
    }
    .wrap{ max-width:1100px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 14px; border-radius:var(--radius);
      border:1px solid var(--line); background: rgba(8,28,46,.60);
      box-shadow: var(--shadow);
    }
    .brand{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .title{ font-weight:950; letter-spacing:.2px; font-size:18px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sub{ font-weight:850; font-size:12px; color:var(--muted); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
    .btn{
      appearance:none; border:1px solid var(--line);
      background: rgba(12,35,56,.40);
      color: var(--txt); font-weight:900;
      padding:10px 12px; border-radius:999px;
      cursor:pointer; user-select:none;
      display:inline-flex; gap:8px; align-items:center;
    }
    .btn:hover{ filter:brightness(1.08); }
    .btn:active{ transform:scale(.98); }
    .btn.ok{ border-color: rgba(68,208,122,.55); }
    .btn.danger{ border-color: rgba(255,59,59,.55); }
    .btn.small{ padding:8px 10px; font-size:12px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      font-weight:900; font-size:12px;
      color: var(--muted);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
    }
    @media (max-width: 960px){ .grid{ grid-template-columns:1fr; } }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(12,35,56,.35);
    }
    .panelTitle{ font-weight:950; letter-spacing:.3px; }
    .panelBody{ padding:12px 14px; display:flex; flex-direction:column; gap:10px; }

    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: rgba(0,0,0,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      padding:12px 12px 10px;
      display:flex; flex-direction:column; gap:8px;
    }
    .itemTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .h{
      margin:0; font-weight:950; line-height:1.12;
      overflow-wrap:anywhere;
    }
    .d{
      margin:0; color: var(--muted);
      line-height:1.20; overflow-wrap:anywhere;
    }
    .meta{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
      color: rgba(234,242,255,.82);
      font-size:12px; font-weight:900;
    }
    .tag{
      display:inline-flex; align-items:center; justify-content:center;
      padding:5px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      font-size:11px; font-weight:950;
    }
    .tag.alta{ border-color: rgba(255,59,59,.65); }
    .tag.media{ border-color: rgba(255,179,71,.65); }
    .tag.baixa{ border-color: rgba(120,190,255,.65); }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .hint{ font-size:12px; color: rgba(234,242,255,.70); line-height:1.35; }

    /* Modal */
    .modalBack{
      position:fixed; inset:0; background: rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center;
      padding:16px; z-index:9999;
    }
    .modal{
      width:min(720px, 100%);
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(8,28,46,.95);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(12,35,56,.35);
    }
    .modalTitle{ font-weight:950; }
    .modalBody{ padding:12px 14px; display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width: 720px){ .modalBody{ grid-template-columns:1fr; } }

    label{ font-size:12px; font-weight:900; color: rgba(234,242,255,.85); display:flex; flex-direction:column; gap:6px; }
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline:none;
      font-weight:800;
    }
    textarea{ min-height:120px; resize:vertical; }
    .modalFoot{
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .right{ margin-left:auto; display:flex; gap:10px; flex-wrap:wrap; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="title">Admin ‚Äî Avisos</div>
        <div class="sub">CRUD completo (criar/editar/excluir/ordenar) ‚Ä¢ preserva o resto do data.json</div>
      </div>
      <div class="row">
        <span class="pill" id="statusPill">Carregando data.json‚Ä¶</span>
        <button class="btn small" id="btnReload">üîÑ Recarregar</button>
        <button class="btn small ok" id="btnNew">‚ûï Novo aviso</button>
      </div>
    </div>

    <div class="grid">
      <!-- LISTA -->
      <div class="panel">
        <div class="panelHead">
          <div class="panelTitle">Lista de Avisos</div>
          <div class="row">
            <button class="btn small" id="btnSort">‚ÜïÔ∏è Ordenar por prioridade</button>
          </div>
        </div>
        <div class="panelBody">
          <div class="hint">
            ‚Ä¢ Use <b>‚¨ÜÔ∏è‚¨áÔ∏è</b> para ajustar ordem manual. <br/>
            ‚Ä¢ <b>Salvar</b> gera um <b>novo data.json</b> para voc√™ substituir no GitHub.
          </div>
          <div class="list" id="list"></div>
        </div>
      </div>

      <!-- A√á√ïES / SALVAR -->
      <div class="panel">
        <div class="panelHead">
          <div class="panelTitle">Salvar / Publicar</div>
        </div>
        <div class="panelBody">
          <div class="hint">
            ‚úÖ Este admin <b>n√£o muda nada sozinho</b>. <br/>
            Ele cria um <b>data.json novo</b> com os avisos atualizados.
          </div>

          <button class="btn ok" id="btnDownload">üíæ Baixar data.json novo</button>
          <button class="btn" id="btnCopy">üìã Copiar JSON para √°rea de transfer√™ncia</button>

          <div class="panel" style="box-shadow:none; background:rgba(0,0,0,.12);">
            <div class="panelHead" style="background:rgba(0,0,0,.10);">
              <div class="panelTitle">Colar data.json (opcional)</div>
            </div>
            <div class="panelBody">
              <div class="hint">
                Se o fetch falhar, cole aqui o conte√∫do do seu data.json e clique em ‚ÄúCarregar do campo‚Äù.
              </div>
              <textarea id="pasteJson" class="mono" placeholder="Cole aqui o JSON completo do data.json‚Ä¶"></textarea>
              <button class="btn small" id="btnLoadFromPaste">‚¨ÜÔ∏è Carregar do campo</button>
            </div>
          </div>

          <div class="hint">
            Depois de baixar, substitua no GitHub: <b>data.json</b> (mesmo caminho).<br/>
            A√≠ o painel da TV/PC atualiza normalmente.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div class="modalHead">
        <div class="modalTitle" id="modalTitle">Editar aviso</div>
        <button class="btn small danger" id="btnClose">‚úñ Fechar</button>
      </div>

      <div class="modalBody">
        <label>T√≠tulo
          <input id="fTitulo" maxlength="120" />
        </label>

        <label>Prioridade
          <select id="fPrioridade">
            <option>Alta</option>
            <option>M√©dia</option>
            <option>Baixa</option>
          </select>
        </label>

        <label>Tipo
          <input id="fTipo" maxlength="60" placeholder="Ex: Seguran√ßa, Servi√ßos, Informativo..." />
        </label>

        <label>Local
          <input id="fLocal" maxlength="60" placeholder="Ex: Hall, Piscina, Garagem..." />
        </label>

        <label>In√≠cio (texto)
          <input id="fInicio" maxlength="40" placeholder="Ex: 29/01/26 - 12:57" />
        </label>

        <label>Fim (texto)
          <input id="fFim" maxlength="40" placeholder="Ex: 10/02/26 - 12:57" />
        </label>

        <label style="grid-column:1 / -1;">Descri√ß√£o
          <textarea id="fDesc" maxlength="800"></textarea>
        </label>
      </div>

      <div class="modalFoot">
        <button class="btn danger" id="btnDelete">üóë Excluir</button>
        <div class="right">
          <button class="btn" id="btnCancel">Cancelar</button>
          <button class="btn ok" id="btnSave">Salvar</button>
        </div>
      </div>
    </div>
  </div>

    
  <script>

 <script>
const GITHUB_TOKEN = "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";
const GITHUB_OWNER = "comunicasindico";
const GITHUB_REPO  = "comunica-sindico";
const GITHUB_PATH = "data.json";
const GITHUB_BRANCH = "main";
</script>

    
    // =========================
    // Estado
    // =========================
    let baseData = null;     // JSON inteiro do data.json (preservado)
    let avisos = [];         // array edit√°vel
    let editingIndex = -1;

    const $ = (id)=>document.getElementById(id);

    function prioClass(p){
      const x = String(p||"").toLowerCase();
      if(x.includes("alta")) return "alta";
      if(x.includes("m")) return "media";
      return "baixa";
    }

    function safe(v){ return (v==null ? "" : String(v)); }

    function setStatus(text, ok=null){
      const el = $("statusPill");
      el.textContent = text;
      el.style.borderColor = ok===true ? "rgba(68,208,122,.55)" : ok===false ? "rgba(255,59,59,.55)" : "var(--line)";
    }

    // =========================
    // Load data.json
    // =========================
    async function loadData(){
      setStatus("Carregando data.json‚Ä¶");
      try{
        const url = "./data.json?ts=" + Date.now();
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        applyLoadedData(data);
        setStatus("OK ‚Ä¢ data.json carregado", true);
      }catch(e){
        setStatus("Falha ao carregar ‚Ä¢ cole o JSON no campo ao lado", false);
      }
    }

    function applyLoadedData(data){
      baseData = data && typeof data === "object" ? data : {};
      avisos = Array.isArray(baseData.avisos) ? baseData.avisos.map(x=>({ ...x })) : [];
      renderList();
    }

    // =========================
    // Render list
    // =========================
    function renderList(){
      const root = $("list");
      root.innerHTML = "";

      if(!avisos.length){
        root.innerHTML = `<div class="hint">Nenhum aviso cadastrado. Clique em ‚ÄúNovo aviso‚Äù.</div>`;
        return;
      }

      avisos.forEach((a, idx)=>{
        const item = document.createElement("div");
        item.className = "item";

        const titulo = safe(a.titulo || "Aviso");
        const desc = safe(a.descricao || "");
        const pr = safe(a.prioridade || "Baixa");
        const tp = safe(a.tipo || "");
        const lc = safe(a.local || "");
        const ini = safe(a.inicio || "");
        const fim = safe(a.fim || "");

        item.innerHTML = `
          <div class="itemTop">
            <p class="h">${escapeHtml(titulo)}</p>
            <div class="actions">
              <button class="btn small" data-act="up">‚¨ÜÔ∏è</button>
              <button class="btn small" data-act="down">‚¨áÔ∏è</button>
              <button class="btn small ok" data-act="edit">‚úèÔ∏è Editar</button>
            </div>
          </div>
          <p class="d">${escapeHtml(desc || "‚Äî")}</p>
          <div class="meta">
            <span class="tag ${prioClass(pr)}">‚ö° ${escapeHtml(pr)}</span>
            ${tp ? `<span class="tag">üè∑ ${escapeHtml(tp)}</span>` : ``}
            ${lc ? `<span class="tag">üìç ${escapeHtml(lc)}</span>` : ``}
            ${(ini||fim) ? `<span class="tag">üóì ${escapeHtml(ini)}${fim ? " ‚Üí " + escapeHtml(fim) : ""}</span>` : ``}
          </div>
        `;

        item.querySelector('[data-act="edit"]').onclick = ()=>openModal(idx);
        item.querySelector('[data-act="up"]').onclick = ()=>move(idx, -1);
        item.querySelector('[data-act="down"]').onclick = ()=>move(idx, +1);

        root.appendChild(item);
      });
    }

    function move(idx, dir){
      const j = idx + dir;
      if(j < 0 || j >= avisos.length) return;
      const tmp = avisos[idx];
      avisos[idx] = avisos[j];
      avisos[j] = tmp;
      renderList();
    }

    function sortByPriority(){
      const rank = { alta:3, media:2, baixa:1 };
      avisos.sort((a,b)=>{
        const pa = prioClass(a?.prioridade);
        const pb = prioClass(b?.prioridade);
        return (rank[pb]||0) - (rank[pa]||0);
      });
      renderList();
    }

    // =========================
    // Modal CRUD
    // =========================
    function openModal(idx){
      editingIndex = idx;

      const isNew = (idx < 0);
      $("modalTitle").textContent = isNew ? "Novo aviso" : "Editar aviso";

      const a = isNew ? {
        titulo:"", descricao:"", prioridade:"Baixa", tipo:"", local:"", inicio:"", fim:""
      } : (avisos[idx] || {});

      $("fTitulo").value = safe(a.titulo);
      $("fDesc").value = safe(a.descricao);
      $("fPrioridade").value = normalizePrio(safe(a.prioridade));
      $("fTipo").value = safe(a.tipo);
      $("fLocal").value = safe(a.local);
      $("fInicio").value = safe(a.inicio);
      $("fFim").value = safe(a.fim);

      $("btnDelete").style.display = isNew ? "none" : "inline-flex";

      $("modalBack").style.display = "flex";
    }

    function closeModal(){
      $("modalBack").style.display = "none";
      editingIndex = -1;
    }

    function normalizePrio(p){
      const x = String(p||"").toLowerCase();
      if(x.includes("alta")) return "Alta";
      if(x.includes("m")) return "M√©dia";
      return "Baixa";
    }

    function saveModal(){
      const obj = {
        titulo: $("fTitulo").value.trim(),
        descricao: $("fDesc").value.trim(),
        prioridade: $("fPrioridade").value,
        tipo: $("fTipo").value.trim(),
        local: $("fLocal").value.trim(),
        inicio: $("fInicio").value.trim(),
        fim: $("fFim").value.trim()
      };

      if(!obj.titulo) obj.titulo = "Aviso";
      if(!obj.descricao) obj.descricao = "‚Äî";

      if(editingIndex < 0){
        avisos.unshift(obj); // novo entra no topo
      }else{
        avisos[editingIndex] = obj;
      }
      renderList();
      closeModal();
    }

    function deleteModal(){
      if(editingIndex < 0) return;
      avisos.splice(editingIndex, 1);
      renderList();
      closeModal();
    }

    // =========================
    // Export / Download
    // =========================
    function buildFinalData(){
      const out = (baseData && typeof baseData === "object") ? structuredCloneSafe(baseData) : {};
      out.avisos = avisos.map(x=>({ ...x }));
      return out;
    }

    function structuredCloneSafe(obj){
      try{ return structuredClone(obj); }catch(e){ return JSON.parse(JSON.stringify(obj)); }
    }

    function downloadJson(){
      const finalData = buildFinalData();
      const txt = JSON.stringify(finalData, null, 2);
      const blob = new Blob([txt], { type:"application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "data.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 2500);
      setStatus("Baixado: data.json novo (substitua no GitHub)", true);
    }

    async function copyJson(){
      const finalData = buildFinalData();
      const txt = JSON.stringify(finalData, null, 2);
      try{
        await navigator.clipboard.writeText(txt);
        setStatus("JSON copiado ‚úÖ", true);
      }catch(e){
        setStatus("N√£o foi poss√≠vel copiar. Use o bot√£o de baixar.", false);
      }
    }

    // =========================
    // Paste loader
    // =========================
    function loadFromPaste(){
      const t = $("pasteJson").value.trim();
      if(!t) return;
      try{
        const j = JSON.parse(t);
        applyLoadedData(j);
        setStatus("OK ‚Ä¢ carregado do campo", true);
      }catch(e){
        setStatus("JSON inv√°lido no campo", false);
      }
    }

    // =========================
    // HTML escape
    // =========================
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    // =========================
    // Bind UI
    // =========================
    $("btnReload").onclick = loadData;
    $("btnNew").onclick = ()=>openModal(-1);
    $("btnSort").onclick = sortByPriority;

    $("btnClose").onclick = closeModal;
    $("btnCancel").onclick = closeModal;
    $("btnSave").onclick = saveModal;
    $("btnDelete").onclick = deleteModal;

    $("btnDownload").onclick = downloadJson;
    $("btnCopy").onclick = copyJson;
    $("btnLoadFromPaste").onclick = loadFromPaste;

    // Fecha modal clicando fora
    $("modalBack").addEventListener("click", (e)=>{
      if(e.target === $("modalBack")) closeModal();
    });

    // Start
    loadData();
  </script>
</body>
</html>
